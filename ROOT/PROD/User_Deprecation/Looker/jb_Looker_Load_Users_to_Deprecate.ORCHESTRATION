{"job":{"components":{"6343106":{"id":6343106,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":352,"y":-160,"width":32,"height":32,"inputConnectorIDs":[6343120,6343121,6343122,6343123],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6343118],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Failure Path"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6343107":{"id":6343107,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":720,"y":0,"width":32,"height":32,"inputConnectorIDs":[6343116],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6343108":{"id":6343108,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":142,"y":4,"width":32,"height":32,"inputConnectorIDs":[6343119],"outputSuccessConnectorIDs":[6343117],"outputFailureConnectorIDs":[6343123],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate Table"}}}},"visible":true},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${SNFLKDB_ADMIN}"}}}},"visible":true},"4":{"slot":4,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${SNFLKSCH_ADMIN}"}}}},"visible":true},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"LOOKER_DEPRECATE_USERS"}}}},"visible":true},"6":{"slot":6,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6343109":{"id":6343109,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":288,"y":0,"width":32,"height":32,"inputConnectorIDs":[6343117],"outputSuccessConnectorIDs":[6343115],"outputFailureConnectorIDs":[6343120],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Insert User Warnings"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"\"\"\n-- =============================================\n-- Author       : Sebastian Jimenez\n-- Create date  : 10/6/2025\n-- Description  : Insert into the LOOKER_DEPRECATE_USERS those users which will be deprecate in the next month.\n-- UPDATED BY\t: \n-- UPDATED ON\t:\n-- JIRA TICKET\t: CER-7745\n-- =============================================\n\"\"\"\n\ncursor = context.cursor()\nselect_query = \"\"\"\n INSERT INTO ${SNFLKDB_ADMIN}.${SNFLKSCH_ADMIN}.LOOKER_DEPRECATE_USERS \n (\n \tID,\n    EMAIL,\n    DISPLAY_NAME,\n    LAST_LOGIN,\n    DATE_JOINED,\n    REASON,\n    SHOULD_DEPRECATED,\n    DL_CREATED_DATE,\n    DL_CREATED_BY,\n    DL_JOBID\n  )\n  SELECT DISTINCT\n      ID,\n      EMAIL,\n      DISPLAY_NAME,\n      LAST_LOGIN,\n      DATE_JOINED,\n      'WARNING',\n      false,\n      CURRENT_TIMESTAMP(),\n      CURRENT_USER(),\n      ${run_history_id}\n  FROM ${SNFLKDB_ADMIN}.${SNFLKSCH_ADMIN}.LDG_LOOKER_ACTIVE_USERS\n  WHERE NOT ARRAY_CONTAINS(15, GROUP_IDS)  -- Admins\n    AND NOT ARRAY_CONTAINS(18, GROUP_IDS)  -- Whitelist\n    AND COALESCE(LAST_LOGIN, DATE_JOINED) BETWEEN DATEADD('month', -'${looker_deprecation_months}', CURRENT_TIMESTAMP())\n        AND DATEADD('month', -('${looker_deprecation_months}'-1), CURRENT_TIMESTAMP())\n    AND EMAIL NOT IN (\n                      SELECT EMAIL FROM ${SNFLKDB_ADMIN}.${SNFLKSCH_ADMIN}.LOOKER_DEPRECATE_USERS WHERE CAST(DL_CREATED_DATE AS DATE) = CURRENT_DATE()\n                      )\n  ORDER BY LAST_LOGIN, DATE_JOINED, EMAIL\n\"\"\" \ncursor.execute(select_query)\n\n\n\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6343110":{"id":6343110,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6343119],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6343111":{"id":6343111,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":576,"y":0,"width":32,"height":32,"inputConnectorIDs":[6343114],"outputSuccessConnectorIDs":[6343116],"outputFailureConnectorIDs":[6343122],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"insert User Deprecated"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"\"\"\n-- =============================================\n-- Author       : Sebastian Jimenez\n-- Create date  : 10/6/2025\n-- Description  : Insert into the LOOKER_DEPRECATE_USERS those users which will be deprecate due to 6 months w/o using the app.\n-- UPDATED BY\t: \n-- UPDATED ON\t:\n-- JIRA TICKET\t: CER-7745\n-- =============================================\n\"\"\"\n\ncursor = context.cursor()\nselect_query = \"\"\"\n INSERT INTO ${SNFLKDB_ADMIN}.${SNFLKSCH_ADMIN}.LOOKER_DEPRECATE_USERS\n (\n \tID,\n    EMAIL,\n    DISPLAY_NAME,\n    LAST_LOGIN,\n    DATE_JOINED,\n    REASON,\n    SHOULD_DEPRECATED,\n    DL_CREATED_DATE,\n    DL_CREATED_BY,\n    DL_JOBID\n  )\n  SELECT DISTINCT\n      ID,\n      EMAIL,\n      DISPLAY_NAME,\n      LAST_LOGIN,\n      DATE_JOINED,\n      'DEPRECATED',\n      true,\n      CURRENT_TIMESTAMP(),\n      CURRENT_USER(),\n      ${run_history_id}\n  FROM ${SNFLKDB_ADMIN}.${SNFLKSCH_ADMIN}.LDG_LOOKER_ACTIVE_USERS\n  WHERE NOT ARRAY_CONTAINS(15, GROUP_IDS)  -- Admins\n    AND NOT ARRAY_CONTAINS(18, GROUP_IDS)  -- Whitelist\n    AND COALESCE(LAST_LOGIN, DATE_JOINED) < DATEADD('month', -'${looker_deprecation_months}', CURRENT_TIMESTAMP())\n    AND EMAIL NOT IN (\n                      SELECT EMAIL FROM ${SNFLKDB_ADMIN}.${SNFLKSCH_ADMIN}.LOOKER_DEPRECATE_USERS WHERE CAST(DL_CREATED_DATE AS DATE) = CURRENT_DATE()\n                      )\n  ORDER BY LAST_LOGIN, DATE_JOINED, EMAIL\n\"\"\" \ncursor.execute(select_query)\n\n\n\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6343112":{"id":6343112,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":432,"y":0,"width":32,"height":32,"inputConnectorIDs":[6343115],"outputSuccessConnectorIDs":[6343114],"outputFailureConnectorIDs":[6343121],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Insert User Termination List"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"\"\"\n-- =============================================\n-- Author       : Sebastian Jimenez\n-- Create date  : 10/6/2025\n-- Description  : Insert into the LOOKER_DEPRECATE_USERS those users which will be deprecate due to they are in the termination list.\n-- UPDATED BY\t: \n-- UPDATED ON\t:\n-- JIRA TICKET\t: CER-7745\n-- =============================================\n\"\"\"\n\ncursor = context.cursor()\nselect_query = \"\"\"\n INSERT INTO ${SNFLKDB_ADMIN}.${SNFLKSCH_ADMIN}.LOOKER_DEPRECATE_USERS\n (\n \tID,\n    EMAIL,\n    DISPLAY_NAME,\n    LAST_LOGIN,\n    DATE_JOINED,\n    REASON,\n    SHOULD_DEPRECATED,\n    DL_CREATED_DATE,\n    DL_CREATED_BY,\n    DL_JOBID\n  )\n  SELECT DISTINCT\n      ID,\n      EMAIL,\n      DISPLAY_NAME,\n      LAST_LOGIN,\n      DATE_JOINED,\n      'TERMINATION LIST',\n      true,\n      CURRENT_TIMESTAMP(),\n      CURRENT_USER(),\n      ${run_history_id}\n  FROM ${SNFLKDB_ADMIN}.${SNFLKSCH_ADMIN}.LDG_LOOKER_ACTIVE_USERS\n  WHERE NOT ARRAY_CONTAINS(15, GROUP_IDS)  -- Admins\n    AND NOT ARRAY_CONTAINS(18, GROUP_IDS)  -- Whitelist\n    AND EMAIL IN (\n                    SELECT\n                    DISTINCT PRIMARY_EMAIL_ADDRESS\n                    FROM PROD_EDW.ENT.ACTIVE_DIRECTORY_DIM\n                    WHERE DW_ACTIVE_FLAG ='N'\n                    AND  DW_END_DATE > DATEADD('month', -1, CURRENT_TIMESTAMP())\n                )\n    AND EMAIL NOT IN (\n                      SELECT EMAIL FROM ${SNFLKDB_ADMIN}.${SNFLKSCH_ADMIN}.LOOKER_DEPRECATE_USERS WHERE CAST(DL_CREATED_DATE AS DATE) = CURRENT_DATE()\n                      )\n  ORDER BY LAST_LOGIN, DATE_JOINED, EMAIL\n\"\"\" \ncursor.execute(select_query)\n\n\n\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6343113":{"id":6343113,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":720,"y":-160,"width":32,"height":32,"inputConnectorIDs":[6343118],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"6343114":{"id":6343114,"sourceID":6343112,"targetID":6343111},"6343115":{"id":6343115,"sourceID":6343109,"targetID":6343112},"6343116":{"id":6343116,"sourceID":6343111,"targetID":6343107},"6343117":{"id":6343117,"sourceID":6343108,"targetID":6343109}},"failureConnectors":{"6343120":{"id":6343120,"sourceID":6343109,"targetID":6343106},"6343121":{"id":6343121,"sourceID":6343112,"targetID":6343106},"6343122":{"id":6343122,"sourceID":6343111,"targetID":6343106},"6343123":{"id":6343123,"sourceID":6343108,"targetID":6343106}},"unconditionalConnectors":{"6343118":{"id":6343118,"sourceID":6343106,"targetID":6343113},"6343119":{"id":6343119,"sourceID":6343110,"targetID":6343108}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"jb_Looker_Load_Users_to_Deprecate","description":"","type":"ORCHESTRATION","tag":"ba36ee89-5b03-410b-b896-c9335f747be1"}}