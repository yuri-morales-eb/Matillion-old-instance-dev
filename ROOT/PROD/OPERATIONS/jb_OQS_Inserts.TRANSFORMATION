{"job":{"components":{"6338287":{"id":6338287,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":832,"y":320,"width":32,"height":32,"inputConnectorIDs":[6338291],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Insert ORDER_QUALITY_SCORE"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ORDER_QUALITY_SCORE"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CDA_JOBORDERID"},"2":{"slot":2,"type":"STRING","value":"CDA_JOBORDERID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_SCORE_TOTAL"},"2":{"slot":2,"type":"STRING","value":"JOB_SCORE_ACTUAL"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_SCORE_NORMALIZED"},"2":{"slot":2,"type":"STRING","value":"JOB_SCORE_NORMALIZED"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_GRADE"},"2":{"slot":2,"type":"STRING","value":"JOB_GRADE"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"ORDER_ID"},"2":{"slot":2,"type":"STRING","value":"ORDER_ID"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE_DATE"},"2":{"slot":2,"type":"STRING","value":"CREATE_DATE"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"CUSTOMER_NAME"},"2":{"slot":2,"type":"STRING","value":"CUSTOMER_NAME"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_TITLE"},"2":{"slot":2,"type":"STRING","value":"JOB_TITLE"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"BRANCH"},"2":{"slot":2,"type":"STRING","value":"BRANCH"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"BRAND"},"2":{"slot":2,"type":"STRING","value":"BRAND"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"AREA"},"2":{"slot":2,"type":"STRING","value":"AREA"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"SKILL"},"2":{"slot":2,"type":"STRING","value":"SKILL"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"START_DATE"},"2":{"slot":2,"type":"STRING","value":"START_DATE"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_BILL_RATE"},"2":{"slot":2,"type":"STRING","value":"JOB_BILL_RATE"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_PAY_RATE"},"2":{"slot":2,"type":"STRING","value":"JOB_PAY_RATE"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_GM_PERCENT"},"2":{"slot":2,"type":"STRING","value":"JOB_GM_PERCENT"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_GM_DOLLARS"},"2":{"slot":2,"type":"STRING","value":"JOB_GM_DOLLARS"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"NUMBER_REQUIRED"},"2":{"slot":2,"type":"STRING","value":"NUMBER_REQUIRED"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"PAYMENT_TERMS_DAYS"},"2":{"slot":2,"type":"STRING","value":"PAYMENT_TERMS_DAYS"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"WC_CODE"},"2":{"slot":2,"type":"STRING","value":"WC_CODE"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"ACCOUNT_TYPE"},"2":{"slot":2,"type":"STRING","value":"ACCOUNT_TYPE"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"PAYMENT_TERMS_SCORE"},"2":{"slot":2,"type":"STRING","value":"PAYMENT_TERMS_SCORE"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"PAYMENT_TERMS_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"PAYMENT_TERMS_CATEGORY"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"SHIFT_START_TIME"},"2":{"slot":2,"type":"STRING","value":"SHIFT_START_TIME"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"SHIFT_SCORE"},"2":{"slot":2,"type":"STRING","value":"SHIFT_SCORE"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"SHIFT_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"SHIFT_CATEGORY"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"SCHEDULE_SCORE"},"2":{"slot":2,"type":"STRING","value":"SCHEDULE_SCORE"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"SCHEDULE_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"SCHEDULE_CATEGORY"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"AVG_PAYRATE"},"2":{"slot":2,"type":"STRING","value":"AVG_PAYRATE"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"PAYRATE_SCORE"},"2":{"slot":2,"type":"STRING","value":"PAYRATE_SCORE"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"PAYRATE_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"PAYRATE_CATEGORY"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"AVG_GM_PERCENT"},"2":{"slot":2,"type":"STRING","value":"AVG_GM_PERCENT"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"GM_PERCENT_SCORE"},"2":{"slot":2,"type":"STRING","value":"GM_PERCENT_SCORE"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"GM_PERCENT_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"GM_PERCENT_CATEGORY"}}},"35":{"slot":35,"values":{"1":{"slot":1,"type":"STRING","value":"DRUG_SCREEN_COUNT"},"2":{"slot":2,"type":"STRING","value":"DRUG_SCREEN_COUNT"}}},"36":{"slot":36,"values":{"1":{"slot":1,"type":"STRING","value":"ESSENTIAL_FUNCTION_COUNT"},"2":{"slot":2,"type":"STRING","value":"ESSENTIAL_FUNCTION_COUNT"}}},"37":{"slot":37,"values":{"1":{"slot":1,"type":"STRING","value":"BACKGROUND_CHECK_COUNT"},"2":{"slot":2,"type":"STRING","value":"BACKGROUND_CHECK_COUNT"}}},"38":{"slot":38,"values":{"1":{"slot":1,"type":"STRING","value":"ONBOARDING_SCORE"},"2":{"slot":2,"type":"STRING","value":"ONBOARDING_SCORE"}}},"39":{"slot":39,"values":{"1":{"slot":1,"type":"STRING","value":"ONBOARDING_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"ONBOARDING_CATEGORY"}}},"40":{"slot":40,"values":{"1":{"slot":1,"type":"STRING","value":"HAZARD_GROUP"},"2":{"slot":2,"type":"STRING","value":"HAZARD_GROUP"}}},"41":{"slot":41,"values":{"1":{"slot":1,"type":"STRING","value":"SAFETY_SCORE"},"2":{"slot":2,"type":"STRING","value":"SAFETY_SCORE"}}},"42":{"slot":42,"values":{"1":{"slot":1,"type":"STRING","value":"SAFETY_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"SAFETY_CATEGORY"}}},"43":{"slot":43,"values":{"1":{"slot":1,"type":"STRING","value":"CUST_AVG_AOA"},"2":{"slot":2,"type":"STRING","value":"CUST_AVG_AOA"}}},"44":{"slot":44,"values":{"1":{"slot":1,"type":"STRING","value":"AOA_VOLUME_SCORE"},"2":{"slot":2,"type":"STRING","value":"AOA_VOLUME_SCORE"}}},"45":{"slot":45,"values":{"1":{"slot":1,"type":"STRING","value":"AOA_VOLUME_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"AOA_VOLUME_CATEGORY"}}},"46":{"slot":46,"values":{"1":{"slot":1,"type":"STRING","value":"BSB_AVAILABLE_COUNT"},"2":{"slot":2,"type":"STRING","value":"BSB_AVAILABLE_COUNT"}}},"47":{"slot":47,"values":{"1":{"slot":1,"type":"STRING","value":"BSB_REQUIRED_COUNT"},"2":{"slot":2,"type":"STRING","value":"BSB_REQUIRED_COUNT"}}},"48":{"slot":48,"values":{"1":{"slot":1,"type":"STRING","value":"LABOR_SUPPLY_SCORE"},"2":{"slot":2,"type":"STRING","value":"LABOR_SUPPLY_SCORE"}}},"49":{"slot":49,"values":{"1":{"slot":1,"type":"STRING","value":"LABOR_SUPPLY_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"LABOR_SUPPLY_CATEGORY"}}},"50":{"slot":50,"values":{"1":{"slot":1,"type":"STRING","value":"CUST_TOTAL_AR"},"2":{"slot":2,"type":"STRING","value":"CUST_TOTAL_AR"}}},"51":{"slot":51,"values":{"1":{"slot":1,"type":"STRING","value":"CUST_PAST_DUE_AR"},"2":{"slot":2,"type":"STRING","value":"CUST_PAST_DUE_AR"}}},"52":{"slot":52,"values":{"1":{"slot":1,"type":"STRING","value":"PAST_DUE_PERC_SCORE"},"2":{"slot":2,"type":"STRING","value":"PAST_DUE_PERC_SCORE"}}},"53":{"slot":53,"values":{"1":{"slot":1,"type":"STRING","value":"PAST_DUE_PERC_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"PAST_DUE_PERC_CATEGORY"}}},"54":{"slot":54,"values":{"1":{"slot":1,"type":"STRING","value":"DAYS_BEYOND_TERMS"},"2":{"slot":2,"type":"STRING","value":"DAYS_BEYOND_TERMS"}}},"55":{"slot":55,"values":{"1":{"slot":1,"type":"STRING","value":"DAYS_BEYOND_TERMS_SCORE"},"2":{"slot":2,"type":"STRING","value":"DAYS_BEYOND_TERMS_SCORE"}}},"56":{"slot":56,"values":{"1":{"slot":1,"type":"STRING","value":"DAYS_BEYOND_TERMS_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"DAYS_BEYOND_TERMS_CATEGORY"}}},"57":{"slot":57,"values":{"1":{"slot":1,"type":"STRING","value":"DW_IS_ACTIVE"},"2":{"slot":2,"type":"STRING","value":"DW_IS_ACTIVE"}}},"58":{"slot":58,"values":{"1":{"slot":1,"type":"STRING","value":"DW_START_DATE"},"2":{"slot":2,"type":"STRING","value":"DW_START_DATE"}}},"59":{"slot":59,"values":{"1":{"slot":1,"type":"STRING","value":"DW_END_DATE"},"2":{"slot":2,"type":"STRING","value":"DW_END_DATE"}}},"60":{"slot":60,"values":{"1":{"slot":1,"type":"STRING","value":"DL_CREATED_DATE"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_DATE"}}},"61":{"slot":61,"values":{"1":{"slot":1,"type":"STRING","value":"DL_CREATED_BY"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_BY"}}},"62":{"slot":62,"values":{"1":{"slot":1,"type":"STRING","value":"DL_JOBID"},"2":{"slot":2,"type":"STRING","value":"DL_JOBID"}}},"63":{"slot":63,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_GRADE_DETAILED"},"2":{"slot":2,"type":"STRING","value":"JOB_GRADE_DETAILED"}}},"64":{"slot":64,"values":{"1":{"slot":1,"type":"STRING","value":"ACCOUNT_TYPE_SCORE"},"2":{"slot":2,"type":"STRING","value":"ACCOUNT_TYPE_SCORE"}}},"65":{"slot":65,"values":{"1":{"slot":1,"type":"STRING","value":"INTERVIEW_REQUIREMENT_SCORE"},"2":{"slot":2,"type":"STRING","value":"INTERVIEW_REQUIREMENT_SCORE"}}},"66":{"slot":66,"values":{"1":{"slot":1,"type":"STRING","value":"INTERVIEW_REQUIREMENT_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"INTERVIEW_REQUIREMENT_CATEGORY"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Sch_Enterprise}"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB_Enterprise}"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"204":{"slot":204,"name":"Order By","elements":{},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6338288":{"id":6338288,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":464,"y":320,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[6338290],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Source Query"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT (\n        (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n        (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n        (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n        (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n        (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n        (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n        (interview_requirement_weight * interview_requirement_score)\n          ) / (\n        payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n        gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n        labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n        interview_requirement_weight\n        ) AS job_score_total\n    ,100 * (\n        (\n          (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n          (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n          (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n          (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n          (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n          (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n          (interview_requirement_weight * interview_requirement_score)\n            ) / (\n          payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n          gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n          labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n          interview_requirement_weight\n        ) - 0.15\n        ) / (2.91 - 0.15) AS job_score_normalized\n    ,CASE \n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) >= 65\n            THEN 'A'\n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) >= 50\n            THEN 'B'\n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) > 0\n            THEN 'C'\n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) = 0\n            THEN 'D'\n        ELSE 'E'\n        END AS job_grade\n    ,CASE \n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) > 87.5\n            THEN 'A1'\n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) > 65\n            THEN 'A2'\n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) > 60\n            THEN 'B1'\n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) > 50\n            THEN 'B2'\n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) > 25\n            THEN 'C1'\n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) > 0\n            THEN 'C2'\n        WHEN 100 * (\n                (\n                  (payment_terms_weight * payment_terms_score ) + (shift_weight * shift_score) + \n                  (schedule_weight * schedule_score) + (payrate_weight * payrate_score) + \n                  (gm_percent_weight * gm_percent_score) + (onboarding_weight * onboarding_score) + \n                  (safety_weight * safety_score) + (aoa_volume_weight * aoa_volume_score) + \n                  (labor_supply_weight * labor_supply_score) + (past_due_perc_weight * past_due_perc_score) + \n                  (days_beyond_terms_weight * days_beyond_terms_score) + (account_type_weight * account_type_score) +\n                  (interview_requirement_weight * interview_requirement_score)\n                    ) / (\n                  payment_terms_weight + shift_weight + schedule_weight + payrate_weight + \n                  gm_percent_weight + onboarding_weight + safety_weight + aoa_volume_weight + \n                  labor_supply_weight + past_due_perc_weight + days_beyond_terms_weight + account_type_weight + \n                  interview_requirement_weight\n                ) - 0.15\n                ) / (2.91 - 0.15) = 0\n            THEN 'D'\n        ELSE 'E'\n        END AS job_grade_detailed\n    ,'Y' AS dw_is_active\n    ,current_timestamp AS dw_start_date\n    ,'9999-12-31 23:59:59.000' AS dw_end_date\n    ,score.*\nfrom (\n    select job.cda_joborderid\n        ,job.cda_jobordernumber as order_id\n        ,job.createdon as create_date\n        ,ab.name as customer_name\n        ,job.cda_jobtitle as job_title\n        ,bb.cda_name as branch\n        ,br.value as brand\n        ,arb.cda_areaid as area_id\n        ,arb.cda_name as area\n        ,sk.value as skill\n        ,job.cda_startdate as start_date\n        ,job.cda_regularbillrate as job_bill_rate\n        ,job.cda_regularpayrate as job_pay_rate\n        ,job.cda_regulargmpercent as job_gm_percent\n        ,job.cda_regulargmdollar as job_gm_dollars\n        ,job.cda_numberrequired as number_required\n        ,pt.value as payment_terms_days\n        ,wc.cda_code as wc_code\n        ,case \n            when upper(vip.account_type) in ('VIP/NPG') then 'VIP/NPG'\n            when upper(vip.account_type) in ('VIP', 'VIP/HYBRID', 'VIP/VMS') then 'VIP'\n            when upper(vip.account_type) IN ('NPG', 'HYBRID') then 'NPG'\n            else 'Retail'\n            end as account_type\n        ,case \n            when upper(vip.vip_plus) like ('%VIP+%') then 3\n            when upper(vip.account_type) in ('VIP/NPG') then 2\n            when upper(vip.account_type) in ('VIP', 'VIP/HYBRID', 'VIP/VMS') then 1\n            when upper(vip.account_type) IN ('NPG', 'HYBRID') then 1\n            else 0\n            end as account_type_score\n        ,case \n            when pt.value = 'DUR' then 3\n            when pt.value < 30 then 3\n            when pt.value < 45 then 2\n            when pt.value <= 60 then 1\n            when pt.value > 60 then 0\n            else 3\n            end as payment_terms_score\n        ,case \n            when pt.value = 'DUR' then '< 30 Days'\n            when pt.value < 30 then '< 30 Days'\n            when pt.value < 45 then '30-45 Days'\n            when pt.value <= 60 then '45-60 Days'\n            when pt.value > 60 then '> 60 Days'\n            else '< 30 Days' --default CRM terms are N10\n            end as payment_terms_category\n        ,sh.value as shift_start_time\n        ,case \n            when sh.value is null then 3\n            when right(sh.value, 2) = 'AM' and left(sh.value, 2) in ('4:', '5:', '6:', '7:', '8:', '9:', '10', '11') then 3\n            when right(sh.value, 2) = 'PM' and left(sh.value, 2) in ('12', '1:', '2:', '3:', '4:', '5:', '6:', '7:') then 2\n            else 1\n            end as shift_score\n        ,case \n            when sh.value is null then '1st Shift' --default value\n            when right(sh.value, 2) = 'AM' and left(sh.value, 2) in ('4:', '5:', '6:', '7:', '8:', '9:', '10', '11') then '1st Shift'\n            when right(sh.value, 2) = 'PM' and left(sh.value, 2) in ('12', '1:', '2:', '3:', '4:', '5:', '6:', '7:') then '2nd Shift'\n            else '3rd Shift'\n            end as shift_category\n        ,case \n            when job.cda_worksaturday or job.cda_worksunday then 1\n            else 2\n            end as schedule_score\n        ,case \n            when job.cda_worksaturday or job.cda_worksunday then 'Weekend'\n            else 'Weekday'\n            end as schedule_category\n        ,pay_bsa.avg_payrate as avg_payrate\n        ,case \n            when job.cda_regularpayrate is null then 1 --default value for payrate score\n            when job.cda_regularpayrate = 0 then 1\n            when job.cda_regularpayrate < 1.00 * pay_bsa.avg_payrate then 0\n            when job.cda_regularpayrate < 1.05 * pay_bsa.avg_payrate then 1\n            when job.cda_regularpayrate < 1.15 * pay_bsa.avg_payrate then 2\n            else 3\n            end as payrate_score\n        ,case \n            when job.cda_regularpayrate is null then 'na'\n            when job.cda_regularpayrate = 0 then 'na'\n            when job.cda_regularpayrate < 1.00 * pay_bsa.avg_payrate then 'Less than Mean'\n            when job.cda_regularpayrate < 1.05 * pay_bsa.avg_payrate then 'Less than 1.05*Mean'\n            when job.cda_regularpayrate < 1.15 * pay_bsa.avg_payrate then 'Less than 1.15*Mean'\n            else 'Greater than 1.15*Mean'\n            end as payrate_category\n        ,gm_abas.avg_gm_percent as avg_gm_percent\n        ,case \n            when job.cda_regulargmpercent is null then 1 --default score\n            when job.cda_regulargmpercent = 0 then 1\n            when job.cda_regulargmpercent < gm_abas.avg_gm_percent + 0 then 0\n            when job.cda_regulargmpercent < gm_abas.avg_gm_percent + 1 then 1\n            when job.cda_regulargmpercent < gm_abas.avg_gm_percent + 2 then 2\n            else 3\n            end as gm_percent_score\n        ,case \n            when job.cda_regulargmpercent is null then 'na'\n            when job.cda_regulargmpercent = 0 then 'na'\n            when job.cda_regulargmpercent < gm_abas.avg_gm_percent + 0 then 'Less than Mean'\n            when job.cda_regulargmpercent < gm_abas.avg_gm_percent + 1 then 'Mean + 100 bps'\n            when job.cda_regulargmpercent < gm_abas.avg_gm_percent + 2 then 'Mean + 200 bps'\n            else '> Mean + 200 bps'\n            end as gm_percent_category\n        ,onboarding.drug_screen_count\n        ,onboarding.essential_function_count\n        ,onboarding.background_check_count\n        ,onboarding.onboarding_score\n        ,onboarding.onboarding_category\n        ,ref.hazard_group\n        ,case \n            when ref.hazard_group in ('G') then 0\n            when ref.hazard_group in ('E', 'F') then 1\n            when ref.hazard_group in ('C', 'D') then 2\n            when ref.hazard_group in ('A', 'B') then 3\n            else 2 --default value is hazard group = C\n            end as safety_score\n        ,case \n            when ref.hazard_group in ('G') then 'G'\n            when ref.hazard_group in ('E', 'F') then 'E,F'\n            when ref.hazard_group in ('C', 'D') then 'C,D'\n            when ref.hazard_group in ('A', 'B') then 'A,B'\n            else 'C,D' --default value is hazard group = C\n            end as safety_category\n        ,job.cda_numbercommitted as cust_avg_aoa\n        ,case \n            when job.cda_numbercommitted is null then 0\n            when job.cda_numbercommitted = 1 then 0\n            when job.cda_numbercommitted <= 5 then 1\n            when job.cda_numbercommitted <= 10 then 2\n            else 3\n            end as aoa_volume_score\n        ,case \n            when job.cda_numbercommitted is null then null\n            when job.cda_numbercommitted = 1 then '1'\n            when job.cda_numbercommitted <= 5 then '2-5'\n            when job.cda_numbercommitted <= 10 then '6-10'\n            else '>10'\n            end as aoa_volume_category\n        ,avail.available_count as bsb_available_count\n        ,job.cda_numbercommitted as bsb_required_count\n        ,case \n            when avail.available_count is null then 0 --default value\n            when avail.available_count <= 1 * job.cda_numbercommitted then 0\n            when avail.available_count <= 2 * job.cda_numbercommitted then 1\n            when avail.available_count <= 3 * job.cda_numbercommitted then 2\n            else 3\n            end as labor_supply_score\n        ,case \n            when avail.available_count is null then '100%'\n            when avail.available_count <= 1 * job.cda_numbercommitted then '100%'\n            when avail.available_count <= 2 * job.cda_numbercommitted then '200%'\n            when avail.available_count <= 3 * job.cda_numbercommitted then '300%'\n            else '>300%'\n            end as labor_supply_category\n        ,pd.total_ar as cust_total_ar\n        ,pd.past_due_ar as cust_past_due_ar\n        ,case \n            when pd.total_ar is null then 2 --default value\n            when pd.past_due_ar >= 0.6 * pd.total_ar then 0\n            when pd.past_due_ar >= 0.4 * pd.total_ar then 1\n            when pd.past_due_ar >= 0.2 * pd.total_ar then 2\n            else 3\n            end as past_due_perc_score\n        ,case \n            when pd.total_ar is null then 'na'\n            when pd.past_due_ar >= 0.6 * pd.total_ar then '60%'\n            when pd.past_due_ar >= 0.4 * pd.total_ar then '40%'\n            when pd.past_due_ar >= 0.2 * pd.total_ar then '20%'\n            else '<20%'\n            end as past_due_perc_category\n        ,dbt.days_late as days_beyond_terms\n        ,case \n            when dbt.days_late is null then 2 --default value\n            when dbt.days_late <= 0 then 3\n            when terms.payment_terms <= 15 and dbt.days_late <= 4 then 3\n            when dbt.days_late <= 8 then 2\n            when dbt.days_late <= 15 then 1\n            else 0\n            end as days_beyond_terms_score\n        ,case \n            when dbt.days_late is null then 'na'\n            when dbt.days_late <= 0 then '0 (Terms>15), 4(Terms<= 15)'\n            when terms.payment_terms <= 15 and dbt.days_late <= 4 then '0 (Terms>15), 4(Terms<= 15)'\n            when dbt.days_late <= 8 then '8'\n            when dbt.days_late <= 15 then '15'\n            else '>15'\n            end as days_beyond_terms_category\n        ,case \n            when pb.cda_joborderid is null then 3\n            else 1\n            end as interview_requirement_score\n        ,case \n            when pb.cda_joborderid is null then 'No'\n            else 'Yes'\n            end as interview_requirement_category\n    from prod_datalake.crm_mscrm.cda_joborderbase job\n    left join prod_datalake.crm_mscrm.stringmapbase sh on sh.attributevalue = job.cda_starthour\n        and sh.attributename = 'cda_starthour'\n        and sh.objecttypecode = 10019\n    left join prod_datalake.crm_mscrm.stringmapbase br on br.attributevalue = job.cda_brand\n        and br.attributename = 'cda_brand'\n        and br.objecttypecode = 10019\n    left join prod_datalake.crm_mscrm.stringmapbase sk on sk.attributevalue = job.cda_skilllevel\n        and sk.attributename = 'cda_skilllevel'\n        and sk.objecttypecode = 10019\n    left join prod_datalake.crm_mscrm.accountbase ab on job.cda_accountid = ab.accountid\n    left join prod_datalake.crm_mscrm.stringmapbase pt on pt.attributevalue = ab.cda_paymenttermscode\n        and pt.attributename = 'cda_paymenttermscode'\n        and pt.objecttypecode = 1\n    left join prod_npg_vip.ldg.npg_vip_dl_ldg_client_master vip on vip.customer_id = ab.accountnumber\n    left join prod_datalake.crm_mscrm.cda_branchbase bb on job.cda_branchid = bb.cda_branchid\n    left join prod_datalake.crm_mscrm.cda_areabase arb on arb.cda_areaid = bb.cda_areaid\n    left join prod_datalake.crm_mscrm.cda_wccodebase wc on wc.cda_wccodeid = job.cda_wccode\n    left join prod_datalake.crm_mscrm.cda_cda_joborder_cda_placementbase pb on pb.cda_joborderid = job.cda_joborderid\n        and pb.cda_placementid = '87FBFAC2-3BAF-E911-80D5-005056910DCE'\n  \n    left join ${DB_Enterprise}.${Sch_Enterprise}.wc_classcode_ref ref on ref.class_code = wc.cda_code\n    left join (\n        select job.cda_brand as brand\n            ,job.cda_skilllevel as skill_level\n            ,bb.cda_areaid as area\n            ,avg(job.cda_regularpayrate) as avg_payrate\n        from prod_datalake.crm_mscrm.cda_joborderbase job\n        left join prod_datalake.crm_mscrm.cda_branchbase bb on job.cda_branchid = bb.cda_branchid\n        where job.cda_regularpayrate > 0\n            and job.cda_startdate >= add_months(current_date, -3)\n            and job.cda_startdate < current_date\n        group by job.cda_brand,job.cda_skilllevel,bb.cda_areaid\n        ) pay_bsa on job.cda_brand = pay_bsa.brand\n        and job.cda_skilllevel = pay_bsa.skill_level\n        and bb.cda_areaid = pay_bsa.area\n        and job.cda_skilllevel = pay_bsa.skill_level\n    left join (\n        select job.cda_brand as brand\n            ,job.cda_skilllevel as skill_level\n            ,bb.cda_areaid as area\n            ,case \n                when upper(vip.account_type) in ('VIP', 'VIP/HYBRID', 'VIP/VMS') then 'VIP'\n                when upper(vip.account_type) in ('VIP/NPG') then 'VIP/NPG'\n                when upper(vip.account_type) in ('NPG', 'HYBRID') then 'NPG'\n                else 'Retail'\n                end as account_type\n            ,avg(job.cda_regulargmpercent) as avg_gm_percent\n        from prod_datalake.crm_mscrm.cda_joborderbase job\n        left join prod_datalake.crm_mscrm.accountbase ab on ab.accountid = job.cda_accountid\n        left join prod_npg_vip.ldg.npg_vip_dl_ldg_client_master vip on vip.customer_id = ab.accountnumber//select distinct account_type from prod_npg_vip.ldg.npg_vip_dl_ldg_client_master\n        left join prod_datalake.crm_mscrm.cda_branchbase bb on job.cda_branchid = bb.cda_branchid\n        where job.cda_regulargmpercent > 0\n            and job.cda_startdate >= add_months(current_date, -6)\n            and job.cda_startdate < current_date\n        group by job.cda_brand\n            ,job.cda_skilllevel\n            ,bb.cda_areaid\n            ,case \n                when upper(vip.account_type) in ('VIP', 'VIP/HYBRID', 'VIP/VMS') then 'VIP'\n                when upper(vip.account_type) in ('VIP/NPG') then 'VIP/NPG'\n                when upper(vip.account_type) in ('NPG', 'HYBRID') then 'NPG'\n                else 'Retail'\n                end\n        ) gm_abas on gm_abas.brand = job.cda_brand\n        and gm_abas.skill_level = job.cda_skilllevel\n        and gm_abas.area = bb.cda_areaid\n        and gm_abas.account_type = case \n            when upper(vip.account_type) in ('VIP', 'VIP/HYBRID', 'VIP/VMS') then 'VIP'\n            when upper(vip.account_type) in ('VIP/NPG') then 'VIP/NPG'\n            when upper(vip.account_type) in ('NPG', 'HYBRID') then 'NPG'\n            else 'Retail'\n            end\n    left join (\n        select job.cda_joborderid\n            ,count(distinct ds.cda_drugscreentypeid) as drug_screen_count\n            ,count(distinct ef.cda_essentialfunctionid) as essential_function_count\n            ,count(distinct bc.cda_backgroundchecktypeid) as background_check_count\n            ,decode(\n                max(case when ds.cda_drugscreentypeid is not null then 1 else 0 end) + \n                max(case when ef.cda_essentialfunctionid is not null then 1 else 0 end) + \n                max(case when bc.cda_backgroundchecktypeid is not null then 1 else 0 end), \n                0, 3, 2, 1, 1, 2, 3, 0) --sum of 0 gets score of 3, sum of 1 gets score of 2, etc.\n            as onboarding_score\n            ,count(distinct ds.cda_drugscreentypeid) as drug_screen_ct\n            ,count(distinct ef.cda_essentialfunctionid) as essential_func_ct\n            ,count(distinct bc.cda_backgroundchecktypeid) as background_ct\n            ,max(case when ds.cda_drugscreentypeid is not null then 1 else 0 end) + \n                max(case when ef.cda_essentialfunctionid is not null then 1 else 0 end) + \n                max(case when bc.cda_backgroundchecktypeid is not null then 1 else 0 end) \n                as onboarding_category\n        from prod_datalake.crm_mscrm.cda_joborderbase job\n        left join prod_datalake.crm_mscrm.cda_drugscreentypebase ds on ds.cda_mapstolegacyjoborderoptionsetvalue = job.cda_drugscreeningtype\n            and ds.cda_name in ('Hair Follicle Test', 'Inhouse Urine Test', 'Accident DOT', 'Accident Non-DOT', 'Pre-Employment DOT', \n                'Pre-Employment Non-DOT', 'Reasonable Cause', 'Random DOT', 'Blood Test', 'Breathilizer Test', 'Random Non-DOT')\n        left join prod_datalake.crm_mscrm.cda_cda_joborder_cda_essentialfunctionbase jef on jef.cda_joborderid = job.cda_joborderid\n        left join prod_datalake.crm_mscrm.cda_essentialfunctionbase ef on ef.cda_essentialfunctionid = jef.cda_essentialfunctionid\n            and ef.cda_shortname in ('Lift Up to 50 lbs')\n        left join prod_datalake.crm_mscrm.cda_cda_joborder_cda_backgroundchecktypebase jbc on jbc.cda_joborderid = job.cda_joborderid\n        left join prod_datalake.crm_mscrm.cda_backgroundchecktypebase bc on bc.cda_backgroundchecktypeid = jbc.cda_backgroundchecktypeid\n            and bc.cda_name not in ('Standard Package', 'None', 'Standard Package w/ Enhanced Nationw', 'Federal Package', 'Quick Search')\n        where job.createdon > dateadd(d, - 2, current_date)\n            or (job.statecode = 0 and job.cda_numberrequired > job.cda_numberfilled)\n        group by job.cda_joborderid\n        ) onboarding on onboarding.cda_joborderid = job.cda_joborderid\n    left join (\n        select cda_brand\n            ,cda_branch\n            ,cda_brandlevel as skill_level\n            ,count(distinct cda_employeeid) as available_count\n        from sandbox_datalake_fina.oe.oe_employee_tbl\n        where active_avail = 1\n            and invalid_merged = 0\n        group by cda_branch, cda_brand, cda_brandlevel\n        ) avail on avail.cda_branch = job.cda_branchid\n        and avail.skill_level = sk.value\n        and avail.cda_brand = br.value\n    left join (\n      SELECT customer\n          , sum(open_amount) AS total_ar\n          , sum(CASE \n                  WHEN datediff(day, invoice_date, as_of_date) > cast(substr(terms, 2) AS INT)\n                      AND trans_type = 'I' THEN open_amount \n                  WHEN trans_type <> 'I' THEN open_amount \n                  ELSE 0 END) AS past_due_ar\n      FROM dev_sandbox_merilytics.datawarehouse.vw_ar_bi_collection_slide --does not have counterpart in PROD\n      WHERE as_of_date = (\n              SELECT max(as_of_date)\n              FROM dev_sandbox_merilytics.datawarehouse.vw_ar_bi_collection_slide\n              )\n      GROUP BY customer\n      HAVING sum(open_amount) > 0\n        ) pd on pd.customer = ab.accountnumber\n    left join (\n      SELECT trim(HDR.CUSTOMER) AS accountnumber\n          , MIN(DATEDIFF(DAY, HDR.INVOICE_DATE, HDR.DUE_DATE)) AS PAYMENT_TERMS --- for the latest invoice\n      FROM PROD_DATALAKE.LAWPROD.ARAPPLIED ARA\n      INNER JOIN PROD_DATALAKE.LAWPROD.ACHISTHDR HDR ON ARA.INVOICE = HDR.INVOICE\n      WHERE INVOICE_DATE = (\n              SELECT MAX(INVOICE_DATE)\n              FROM PROD_DATALAKE.LAWPROD.ACHISTHDR\n              WHERE CUSTOMER = HDR.CUSTOMER\n              )\n      GROUP BY trim(CUSTOMER)\n    ) terms on terms.accountnumber = ab.accountnumber\n    left join (\n      SELECT trim(customer) as accountnumber\n          , cast(sum(weighted_amt) / nullif(sum(appld_amt), 0) AS INT) AS days_late\n      FROM (\n          SELECT customer\n              , appld_amt\n              , datediff(dd, due_date, deposit_date) * appld_amt AS weighted_amt\n          FROM (\n              SELECT a.customer\n                  , a.max_deposit_date\n                  , cast(ara.deposit_date AS DATE) AS deposit_date\n                  , ara.appld_amt\n                  , cast(hdr.due_date AS DATE) AS due_date\n            \t  , cast(hdr.invoice_date as DATE) as invoice_date\n              FROM (\n                  SELECT hdr.customer\n                      , cast(max(ara.deposit_date) AS DATE) AS max_deposit_date\n                  FROM prod_datalake.lawprod.achisthdr hdr\n                  LEFT JOIN prod_datalake.lawprod.arapplied ara ON hdr.invoice = ara.invoice\n                  GROUP BY hdr.customer\n                  ) a\n              LEFT JOIN prod_datalake.lawprod.achisthdr hdr on hdr.customer = a.customer\n              LEFT JOIN prod_datalake.lawprod.arapplied ara ON ara.invoice = hdr.invoice\n              )\n          WHERE deposit_date >= dateadd(dd, - 90, max_deposit_date)\n          )\n      GROUP BY trim(customer)\n        ) dbt on dbt.accountnumber = ab.accountnumber\n    where job.createdon > dateadd(d, - 2, current_date)\n        or (job.statecode = 0 and job.cda_numberrequired > job.cda_numberfilled)\n    ) score \n    inner join (\n    select arb.cda_areaid as area_id\n        ,arb.cda_name as area_name\n        ,coalesce(w1.payment_terms_weight, w2.payment_terms_weight) as payment_terms_weight\n        ,coalesce(w1.shift_weight, w2.shift_weight) as shift_weight\n        ,coalesce(w1.schedule_weight, w2.schedule_weight) as schedule_weight\n        ,coalesce(w1.payrate_weight, w2.payrate_weight) as payrate_weight\n        ,coalesce(w1.gm_percent_weight, w2.gm_percent_weight) as gm_percent_weight\n        ,coalesce(w1.onboarding_weight, w2.onboarding_weight) as onboarding_weight\n        ,coalesce(w1.safety_weight, w2.safety_weight) as safety_weight\n        ,coalesce(w1.aoa_volume_weight, w2.aoa_volume_weight) as aoa_volume_weight\n        ,coalesce(w1.labor_supply_weight, w2.labor_supply_weight) as labor_supply_weight\n        ,coalesce(w1.past_due_perc_weight, w2.past_due_perc_weight) as past_due_perc_weight\n        ,coalesce(w1.days_beyond_terms_weight, w2.days_beyond_terms_weight) as days_beyond_terms_weight\n        ,coalesce(w1.account_type_weight, w2.account_type_weight) as account_type_weight\n        ,coalesce(w1.interview_requirement_weight, w2.interview_requirement_weight) as interview_requirement_weight\n    from prod_datalake.crm_mscrm.cda_areabase arb\n    left join ${DB_Enterprise}.${Sch_Enterprise}.order_quality_metric_weight w1 on w1.area_id = arb.cda_areaid and w1.dw_is_active = 'Y'\n    left join ${DB_Enterprise}.${Sch_Enterprise}.order_quality_metric_weight w2 on w2.area_id = 'DEFAULT' and w2.dw_is_active = 'Y'\n    ) weight on score.area_id = weight.area_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6338289":{"id":6338289,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":640,"y":320,"width":32,"height":32,"inputConnectorIDs":[6338290],"outputConnectorIDs":[6338291],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Add Audit Columns"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${run_history_id}"},"2":{"slot":2,"type":"STRING","value":"DL_JOBID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_TIMESTAMP()"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_DATE"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_USER()"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_BY"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"6338290":{"id":6338290,"sourceID":6338288,"targetID":6338289},"6338291":{"id":6338291,"sourceID":6338289,"targetID":6338287}},"notes":{"6338286":{"id":6338286,"x":444,"y":234,"width":117,"height":40,"text":"jb_OQS_Inserts","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"jb_OQS_Inserts","description":"","type":"TRANSFORMATION","tag":"d2fa1192-82cc-44ac-a0df-6579a29c6d01"}}