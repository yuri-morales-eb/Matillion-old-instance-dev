{"job":{"components":{"6332875":{"id":6332875,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-16,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6332880],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332876":{"id":6332876,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":109,"y":-1,"width":32,"height":32,"inputConnectorIDs":[6332880],"outputSuccessConnectorIDs":[6332879],"outputFailureConnectorIDs":[6332881],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Status","mapTo":"audit_status"},"2":{"slot":2,"fromId":null,"fromName":"Component","mapTo":"audit_component"},"3":{"slot":3,"fromId":null,"fromName":"Started At","mapTo":"audit_started"},"4":{"slot":4,"fromId":null,"fromName":"Duration","mapTo":"audit_duration"},"5":{"slot":5,"fromId":null,"fromName":"Completed At","mapTo":"audit_completed"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DIM_INVOICE"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\ncursor = context.cursor()\ncursor.execute(\"MERGE INTO ${SNFLKDB}.${SNFLKSCH}.dim_invoice t USING ( SELECT DISTINCT ahh.invoice AS invoice_num , ahh.customer AS customer_id , trans.obj_id AS src_obj_id , to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS created_dt , CURRENT_USER() AS created_by , to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS modified_dt , CURRENT_USER() AS modified_by , 'Y' AS active_status FROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.actrans trans LEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.achistdtl hdtl ON trans.obj_id=hdtl.atn_obj_id LEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.achisthdr ahh ON hdtl.obj_id=ahh.obj_id WHERE invoice_num IS NOT NULL )s ON t.src_obj_id = s.src_obj_id and t.invoice_num=s.invoice_num WHEN matched AND ( t.customer_id <> s. customer_id ) AND t.modified_dt = ( SELECT max(modified_dt) FROM ${SNFLKDB}.${SNFLKSCH}.dim_invoice WHERE invoice_num=s.invoice_num ) THEN UPDATE SET modified_dt = to_timestamp_ntz(CURRENT_TIMESTAMP(0)), modified_by = CURRENT_USER(), active_status='N' WHEN NOT matched THEN INSERT ( invoice_num , customer_id , src_obj_id , created_dt , created_by , modified_dt , modified_by , active_status ) VALUES ( s.invoice_num , s.customer_id , s.src_obj_id , s.created_dt , s.created_by , s.modified_dt , s.modified_by , s.active_status )\")\nresult = cursor.fetchone()\ncontext.updateVariable(\"audit_rowcount\", int(result[0]))\n#rowcount = result[0]\n#print \"Updated Rows Count\" \n#print  rowcount\n\ncursor.execute(\"INSERT INTO ${SNFLKDB}.${SNFLKSCH}.dim_invoice ( invoice_num , customer_id , src_obj_id , created_dt , created_by , modified_dt , modified_by , active_status ) SELECT S.* FROM ${SNFLKDB}.${SNFLKSCH}.dim_invoice t INNER JOIN ( SELECT DISTINCT ahh.invoice AS invoice_num , ahh.customer AS customer_id , trans.obj_id AS src_obj_id , to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS created_dt , CURRENT_USER() AS created_by , to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS modified_dt , CURRENT_USER() AS modified_by , 'Y' AS active_status FROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.actrans trans LEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.achistdtl hdtl ON trans.obj_id=hdtl.atn_obj_id LEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.achisthdr ahh ON ahh.obj_id=hdtl.obj_id WHERE invoice_num IS NOT NULL )s ON t.src_obj_id = s.src_obj_id AND t.invoice_num = s.invoice_num AND ( t.customer_id <> s. customer_id ) AND t.modified_dt = ( SELECT max(modified_dt) FROM ${SNFLKDB}.${SNFLKSCH}.dim_invoice WHERE invoice_num=s.invoice_num )\")\nresult = cursor.fetchone()\ncontext.updateVariable(\"audit_rowcount1\", int(result[0]))\n#rowcount = result[0]\n#print \"New Rows Count\" \n#print  rowcount"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332877":{"id":6332877,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":272,"y":-64,"width":32,"height":32,"inputConnectorIDs":[6332879],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_INVOICE_SUCCESS"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_INVOICE"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332878":{"id":6332878,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":272,"y":64,"width":32,"height":32,"inputConnectorIDs":[6332881],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_INVOICE_FAILURE"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_INVOICE"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"6332879":{"id":6332879,"sourceID":6332876,"targetID":6332877}},"failureConnectors":{"6332881":{"id":6332881,"sourceID":6332876,"targetID":6332878}},"unconditionalConnectors":{"6332880":{"id":6332880,"sourceID":6332875,"targetID":6332876}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"jb_DIM_INVOICE","description":"","type":"ORCHESTRATION","tag":"547c51c1-6d5b-4eb6-905c-c9228659b6c3"}}