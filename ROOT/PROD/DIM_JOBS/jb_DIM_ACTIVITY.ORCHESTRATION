{"job":{"components":{"6332891":{"id":6332891,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":160,"y":-16,"width":32,"height":32,"inputConnectorIDs":[6332851],"outputSuccessConnectorIDs":[6332895],"outputFailureConnectorIDs":[6332852],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Status","mapTo":"audit_status"},"2":{"slot":2,"fromId":null,"fromName":"Component","mapTo":"audit_component"},"3":{"slot":3,"fromId":null,"fromName":"Started At","mapTo":"audit_started"},"4":{"slot":4,"fromId":null,"fromName":"Duration","mapTo":"audit_duration"},"5":{"slot":5,"fromId":null,"fromName":"Completed At","mapTo":"audit_completed"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DIM_ACTIVITY"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\ncursor = context.cursor()\n#cursor.execute(\"MERGE INTO ${SNFLKDB}.${SNFLKSCH}.dim_activity t USING ( SELECT DISTINCT trans.activity AS activity_txt , act.activity_grp AS act_grp_txt , acx.mx_value AS sales_rep_nm , act.level_detail_02 AS level_detail_02 , cda_staffingsupervisorid AS staffingsupervisorid, brb.cda_brand AS assignment_brand, cda_startdate AS assignment_start_date, cda_estimatedenddate AS assignment_est_end_date, to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS created_dt , CURRENT_USER() AS created_by , to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS modified_dt , CURRENT_USER() AS modified_by , 'Y' AS active_status FROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.actrans trans LEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.acactivity act ON trans.activity=act.activity LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.acactmxval acx ON act.obj_id = acx.obj_id AND acx.matrix_cat = 'SALESREPN' LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.cda_assignmentbase a ON act.obj_id =a.cda_assignmentnumber LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.cda_branchbase brb ON act.acct_unit=brb.cda_accountingunitno ) s ON TRIM(UPPER(t.activity_txt))=TRIM(UPPER(s.activity_txt)) AND ( TRIM(UPPER(t.assignment_brand)) = TRIM(UPPER(s.assignment_brand)) OR (t.assignment_brand IS NULL AND s.assignment_brand IS NULL) ) AND t.ACTIVE_STATUS = s.ACTIVE_STATUS WHEN matched AND ( t.act_grp_txt <> s. act_grp_txt OR t.sales_rep_nm <> s.sales_rep_nm OR t.level_detail_02 <> s.level_detail_02 OR t.staffingsupervisorid <> s.staffingsupervisorid OR t.assignment_start_date <> s.assignment_start_date OR t.assignment_est_end_date <> s.assignment_est_end_date) AND t.modified_dt = ( SELECT max(modified_dt) FROM ${SNFLKDB}.${SNFLKSCH}.dim_activity WHERE activity_txt =s.activity_txt ) THEN UPDATE SET modified_dt = to_timestamp_ntz(CURRENT_TIMESTAMP(0)), modified_by = CURRENT_USER(), active_status='N' WHEN NOT matched THEN INSERT ( activity_txt, act_grp_txt, sales_rep_nm, level_detail_02, staffingsupervisorid, assignment_brand, assignment_start_date, assignment_est_end_date, created_dt, created_by, modified_dt, modified_by, active_status ) VALUES ( s.activity_txt, s.act_grp_txt, s.sales_rep_nm, s.level_detail_02, s.staffingsupervisorid, s.assignment_brand, s.assignment_start_date, s.assignment_est_end_date, s.created_dt, s.created_by, s.modified_dt, s.modified_by, s.active_status )\")\ncursor.execute(\"MERGE INTO ${SNFLKDB}.${SNFLKSCH}.dim_activity t USING (SELECT DISTINCT trans.activity AS activity_txt, act.activity_grp AS act_grp_txt, acx.mx_value AS sales_rep_nm, act.level_detail_02 AS level_detail_02, cda_staffingsupervisorid AS staffingsupervisorid, brb.cda_brand AS assignment_brand, cda_startdate AS assignment_start_date, cda_estimatedenddate AS assignment_est_end_date, to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS created_dt, CURRENT_USER() AS created_by, to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS modified_dt, CURRENT_USER() AS modified_by, 'Y' AS active_status FROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.actrans trans LEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.acactivity act ON trans.activity=act.activity LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.acactmxval acx ON act.obj_id = acx.obj_id AND acx.matrix_cat = 'SALESREPN' LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.cda_assignmentbase a ON act.obj_id =a.cda_assignmentnumber LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.cda_branchbase brb on a.cda_accountingunitid = brb.cda_branchid) s ON TRIM(UPPER(t.activity_txt))=TRIM(UPPER(s.activity_txt)) AND t.ACTIVE_STATUS = s.ACTIVE_STATUS WHEN matched AND (t.act_grp_txt IS DISTINCT FROM s. act_grp_txt OR t.assignment_brand IS DISTINCT FROM S.assignment_brand OR t.sales_rep_nm IS DISTINCT FROM s.sales_rep_nm OR t.level_detail_02 IS DISTINCT FROM s.level_detail_02 OR t.staffingsupervisorid IS DISTINCT FROM s.staffingsupervisorid OR t.assignment_start_date IS DISTINCT FROM s.assignment_start_date OR t.assignment_est_end_date IS DISTINCT FROM s.assignment_est_end_date) AND t.modified_dt = (SELECT max(modified_dt) FROM ${SNFLKDB}.${SNFLKSCH}.dim_activity WHERE activity_txt =s.activity_txt ) THEN UPDATE SET modified_dt = to_timestamp_ntz(CURRENT_TIMESTAMP(0)), modified_by = CURRENT_USER(), active_status='N' WHEN NOT matched THEN INSERT (activity_txt, act_grp_txt, sales_rep_nm, level_detail_02, staffingsupervisorid, assignment_brand, assignment_start_date, assignment_est_end_date, created_dt, created_by, modified_dt, modified_by, active_status) VALUES (s.activity_txt, s.act_grp_txt, s.sales_rep_nm, s.level_detail_02, s.staffingsupervisorid, s.assignment_brand, s.assignment_start_date, s.assignment_est_end_date, s.created_dt, s.created_by, s.modified_dt, s.modified_by, s.active_status)\")\n\nresult = cursor.fetchone()\ncontext.updateVariable(\"audit_rowcount\", int(result[0]))\n\n#rowcount = int(cursor.fetchone()[0])\n#print \"Updated Rows Count\" \n#print  rowcount\n\n#cursor.execute(\"INSERT INTO ${SNFLKDB}.${SNFLKSCH}.dim_activity ( activity_txt , act_grp_txt , sales_rep_nm , level_detail_02 , staffingsupervisorid, assignment_brand, assignment_start_date, assignment_est_end_date, created_dt , created_by , modified_dt , modified_by , active_status ) SELECT s.* FROM ${SNFLKDB}.${SNFLKSCH}.dim_activity t INNER JOIN ( SELECT DISTINCT trans.activity AS activity_txt , act.activity_grp AS act_grp_txt , acx.mx_value AS sales_rep_nm , act.level_detail_02 AS level_detail_02 , cda_staffingsupervisorid AS staffingsupervisorid, brb.cda_brand AS assignment_brand, cda_startdate AS assignment_start_date, cda_estimatedenddate AS assignment_est_end_date, to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS created_dt , CURRENT_USER() AS created_by , to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS modified_dt , CURRENT_USER() AS modified_by , 'Y' AS active_status FROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.actrans trans INNER JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.acactivity act ON trans.activity=act.activity LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.acactmxval acx ON act.obj_id = acx.obj_id AND acx.matrix_cat = 'SALESREPN' LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.cda_assignmentbase a ON a.cda_assignmentnumber=act.obj_id LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.cda_branchbase brb ON a.statecode=brb.statecode)s ON t.activity_txt=s.activity_txt AND ( TRIM(UPPER(t.assignment_brand)) = TRIM(UPPER(s.assignment_brand)) OR (t.assignment_brand IS NULL AND s.assignment_brand IS NULL) ) AND ( t.act_grp_txt <> s. act_grp_txt OR t.sales_rep_nm <> s.sales_rep_nm OR t.level_detail_02 <> s.level_detail_02 OR t.staffingsupervisorid <> s.staffingsupervisorid OR t.assignment_start_date <> s.assignment_start_date OR t.assignment_est_end_date <> s.assignment_est_end_date ) AND t.modified_dt = ( SELECT max(modified_dt) FROM ${SNFLKDB}.${SNFLKSCH}.dim_activity WHERE activity_txt =s.activity_txt)\")\ncursor.execute(\"INSERT INTO ${SNFLKDB}.${SNFLKSCH}.dim_activity (activity_txt, act_grp_txt, sales_rep_nm, level_detail_02, staffingsupervisorid, assignment_brand, assignment_start_date, assignment_est_end_date, created_dt, created_by, modified_dt, modified_by, active_status) SELECT s.* FROM ${SNFLKDB}.${SNFLKSCH}.dim_activity t INNER JOIN (SELECT DISTINCT trans.activity AS activity_txt, act.activity_grp AS act_grp_txt, acx.mx_value AS sales_rep_nm, act.level_detail_02 AS level_detail_02, cda_staffingsupervisorid AS staffingsupervisorid, brb.cda_brand AS assignment_brand, cda_startdate AS assignment_start_date, cda_estimatedenddate AS assignment_est_end_date, to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS created_dt, CURRENT_USER() AS created_by, to_timestamp_ntz(CURRENT_TIMESTAMP(0)) AS modified_dt, CURRENT_USER() AS modified_by, 'Y' AS active_status FROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.actrans trans INNER JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.acactivity act ON trans.activity=act.activity LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.acactmxval acx ON act.obj_id = acx.obj_id AND acx.matrix_cat = 'SALESREPN' LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.cda_assignmentbase a ON a.cda_assignmentnumber=act.obj_id LEFT OUTER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.cda_branchbase brb on a.cda_accountingunitid = brb.cda_branchid )s ON t.activity_txt=s.activity_txt AND (t.act_grp_txt IS DISTINCT FROM s. act_grp_txt OR t.assignment_brand IS DISTINCT FROM S.assignment_brand OR t.sales_rep_nm IS DISTINCT FROM s.sales_rep_nm OR t.level_detail_02 IS DISTINCT FROM s.level_detail_02 OR t.staffingsupervisorid IS DISTINCT FROM s.staffingsupervisorid OR t.assignment_start_date IS DISTINCT FROM s.assignment_start_date OR t.assignment_est_end_date IS DISTINCT FROM s.assignment_est_end_date) AND t.modified_dt = (SELECT max(modified_dt) FROM ${SNFLKDB}.${SNFLKSCH}.dim_activity WHERE activity_txt =s.activity_txt)\")\n\nresult = cursor.fetchone()\ncontext.updateVariable(\"audit_rowcount1\", int(result[0]))\n#rowcount = int(cursor.fetchone()[0])\n#print \"New Rows Count\" \n#print  rowcount"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332892":{"id":6332892,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":352,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6332895],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_ACTIVITY_SUCCESS"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_ACTIVITY"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332893":{"id":6332893,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-16,"y":-16,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6332851],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332894":{"id":6332894,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":352,"y":48,"width":32,"height":32,"inputConnectorIDs":[6332852],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_ACTIVITY_FAILURE"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_ACTIVITY"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"6332895":{"id":6332895,"sourceID":6332891,"targetID":6332892}},"failureConnectors":{"6332852":{"id":6332852,"sourceID":6332891,"targetID":6332894}},"unconditionalConnectors":{"6332851":{"id":6332851,"sourceID":6332893,"targetID":6332891}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"jb_DIM_ACTIVITY","description":"","type":"ORCHESTRATION","tag":"3f124b04-850b-44bf-91a2-8b54ff14252e"}}