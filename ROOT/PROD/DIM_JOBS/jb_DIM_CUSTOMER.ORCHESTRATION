{"job":{"components":{"6332982":{"id":6332982,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-32,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6332952],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332983":{"id":6332983,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":192,"y":0,"width":32,"height":32,"inputConnectorIDs":[6332989],"outputSuccessConnectorIDs":[6332990],"outputFailureConnectorIDs":[6332953],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Status","mapTo":"audit_status"},"2":{"slot":2,"fromId":null,"fromName":"Component","mapTo":"audit_component"},"3":{"slot":3,"fromId":null,"fromName":"Started At","mapTo":"audit_started"},"4":{"slot":4,"fromId":null,"fromName":"Duration","mapTo":"audit_duration"},"5":{"slot":5,"fromId":null,"fromName":"Completed At","mapTo":"audit_completed"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DIM_CUSTOMER"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\ncursor = context.cursor()\ncursor.execute(\"MERGE INTO ${SNFLKDB}.${SNFLKSCH}.DIM_CUSTOMER T USING (SELECT DISTINCT LTRIM(CUS.CUSTOMER) AS CUSTOMER,  CUS.SEARCH_NAME AS SEARCH_NAME,  CUS.COMPANY AS COMPANY,  TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(0)) AS CREATED_DT,  CURRENT_USER() AS CREATED_BY,  TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(0)) AS MODIFIED_DT,  CURRENT_USER() AS MODIFIED_BY,  'Y' AS ACTIVE_STATUS,  AB.PARENTACCOUNTID AS PARENTCLIENTNUMBER,  CM.ACCOUNT_TYPE AS ACCOUNT_TYPE  FROM PROD_DATALAKE.LAWPROD.ARCUSTOMER CUS  JOIN PROD_DATALAKE.LAWPROD.ACACTIVITY ACT ON LTRIM(CUS.CUSTOMER) = ACT.LEVEL_DETAIL_02  JOIN PROD_DATALAKE.LAWPROD.ACTRANS ACTRANS ON ACT.ACTIVITY = ACTRANS.ACTIVITY  LEFT JOIN PROD_DATALAKE.CRM_MSCRM.ACCOUNTBASE AB ON AB.ACCOUNTNUMBER=ACT.LEVEL_DETAIL_02  LEFT JOIN PROD_NPG_VIP.LDG.NPG_VIP_DL_LDG_CLIENT_MASTER CM ON CM.CUSTOMER_ID=ACT.LEVEL_DETAIL_02  )S ON LTRIM(T.CUSTOMER)=LTRIM(S.CUSTOMER) AND T.COMPANY = S.COMPANY AND T.ACTIVE_STATUS = 'Y' WHEN MATCHED AND (T.SEARCH_NAME IS DISTINCT FROM S.SEARCH_NAME  OR T.PARENTCLIENTNUMBER IS DISTINCT FROM S.PARENTCLIENTNUMBER  OR T.ACCOUNT_TYPE IS DISTINCT FROM S.ACCOUNT_TYPE) AND T.MODIFIED_DT =   (SELECT MAX(MODIFIED_DT)  FROM ${SNFLKDB}.${SNFLKSCH}.DIM_CUSTOMER  WHERE LTRIM(CUSTOMER)=LTRIM(S.CUSTOMER)) THEN UPDATE SET MODIFIED_DT = TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(0)),   MODIFIED_BY = CURRENT_USER(),   ACTIVE_STATUS='N' WHEN NOT MATCHED THEN INSERT (CUSTOMER,   SEARCH_NAME,   COMPANY,   CREATED_DT,   CREATED_BY,   MODIFIED_DT,   MODIFIED_BY,   ACTIVE_STATUS,   PARENTCLIENTNUMBER,   ACCOUNT_TYPE) VALUES (LTRIM(CUSTOMER), S.SEARCH_NAME, S.COMPANY, S.CREATED_DT, S.CREATED_BY, S.MODIFIED_DT, S.MODIFIED_BY, S.ACTIVE_STATUS, S.PARENTCLIENTNUMBER, S.ACCOUNT_TYPE)\")\nresult = cursor.fetchone()\ncontext.updateVariable(\"audit_rowcount\", int(result[0]))\n\n#rowcount = int(cursor.fetchone()[0])\n#print \"Updated Rows Count\" \n#print  rowcount\n\ncursor.execute(\"INSERT INTO ${SNFLKDB}.${SNFLKSCH}.DIM_CUSTOMER (CUSTOMER, SEARCH_NAME, COMPANY, CREATED_DT, CREATED_BY, MODIFIED_DT, MODIFIED_BY, ACTIVE_STATUS, PARENTCLIENTNUMBER, ACCOUNT_TYPE) SELECT S.* FROM ${SNFLKDB}.${SNFLKSCH}.DIM_CUSTOMER T INNER JOIN   (SELECT DISTINCT LTRIM(CUS.CUSTOMER) AS CUSTOMER,  CUS.SEARCH_NAME AS SEARCH_NAME,  CUS.COMPANY AS COMPANY,  TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(0)) AS CREATED_DT,  CURRENT_USER() AS CREATED_BY,  TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(0)) AS MODIFIED_DT,  CURRENT_USER() AS MODIFIED_BY,  'Y' AS ACTIVE_STATUS,  AB.PARENTACCOUNTID AS PARENTCLIENTNUMBER,  CM.ACCOUNT_TYPE AS ACCOUNT_TYPE  FROM PROD_DATALAKE.LAWPROD.ARCUSTOMER CUS  JOIN PROD_DATALAKE.LAWPROD.ACACTIVITY ACT ON LTRIM(CUS.CUSTOMER) = ACT.LEVEL_DETAIL_02  JOIN PROD_DATALAKE.LAWPROD.ACTRANS ACTRANS ON ACT.ACTIVITY = ACTRANS.ACTIVITY  LEFT JOIN PROD_DATALAKE.CRM_MSCRM.ACCOUNTBASE AB ON AB.ACCOUNTNUMBER=ACT.LEVEL_DETAIL_02  LEFT JOIN PROD_NPG_VIP.LDG.NPG_VIP_DL_LDG_CLIENT_MASTER CM ON CM.CUSTOMER_ID=ACT.LEVEL_DETAIL_02)S ON LTRIM(T.CUSTOMER)=LTRIM(S.CUSTOMER) AND T.COMPANY = S.COMPANY AND (T.SEARCH_NAME IS DISTINCT FROM S.SEARCH_NAME  OR T.PARENTCLIENTNUMBER IS DISTINCT FROM S.PARENTCLIENTNUMBER  OR T.ACCOUNT_TYPE IS DISTINCT FROM S.ACCOUNT_TYPE) AND T.MODIFIED_DT =   (SELECT MAX(MODIFIED_DT)  FROM ${SNFLKDB}.${SNFLKSCH}.DIM_CUSTOMER  WHERE LTRIM(CUSTOMER)=S.CUSTOMER)\")\nresult = cursor.fetchone()\ncontext.updateVariable(\"audit_rowcount1\", int(result[0]))\n\n#rowcount = int(cursor.fetchone()[0])\n#print \"New Rows Count\" \n#print  rowcount\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332984":{"id":6332984,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":512,"y":-64,"width":32,"height":32,"inputConnectorIDs":[6332951],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332985":{"id":6332985,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":352,"y":-64,"width":32,"height":32,"inputConnectorIDs":[6332990],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6332951],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit Success"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"_Audit_Datalake_Public_End"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"audit_job_name"},"2":{"slot":2,"type":"STRING","value":"${job_name}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"audit_status"},"2":{"slot":2,"type":"STRING","value":"SUCCESS"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332986":{"id":6332986,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":80,"y":0,"width":32,"height":32,"inputConnectorIDs":[6332952],"outputSuccessConnectorIDs":[6332989],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit Begin"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"_Audit_Datalake_Public_Begin"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"audit_job_name"},"2":{"slot":2,"type":"STRING","value":"${job_name}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"audit_status"},"2":{"slot":2,"type":"STRING","value":"RUNNING"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332987":{"id":6332987,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":512,"y":80,"width":32,"height":32,"inputConnectorIDs":[6332991],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332988":{"id":6332988,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":352,"y":80,"width":32,"height":32,"inputConnectorIDs":[6332953],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6332991],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit Failure"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"_Audit_Datalake_Public_End"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"audit_job_name"},"2":{"slot":2,"type":"STRING","value":"${job_name}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"audit_status"},"2":{"slot":2,"type":"STRING","value":"FAILURE"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"audit_rowcount"},"2":{"slot":2,"type":"STRING","value":"0"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"6332989":{"id":6332989,"sourceID":6332986,"targetID":6332983},"6332990":{"id":6332990,"sourceID":6332983,"targetID":6332985}},"failureConnectors":{"6332953":{"id":6332953,"sourceID":6332983,"targetID":6332988}},"unconditionalConnectors":{"6332951":{"id":6332951,"sourceID":6332985,"targetID":6332984},"6332952":{"id":6332952,"sourceID":6332982,"targetID":6332986},"6332991":{"id":6332991,"sourceID":6332988,"targetID":6332987}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"jb_DIM_CUSTOMER","description":"","type":"ORCHESTRATION","tag":"3c9f48cd-1dc4-4395-a553-100aad538e62"}}