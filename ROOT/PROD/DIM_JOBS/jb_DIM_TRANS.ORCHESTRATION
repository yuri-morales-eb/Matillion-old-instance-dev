{"job":{"components":{"6332955":{"id":6332955,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-240,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6333039,6333040,6333041],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6333037],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Failure"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332956":{"id":6332956,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-528,"y":80,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6333035],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332957":{"id":6332957,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":128,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6333036],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6333034],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit Failure"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"_Audit_Datalake_Public_End"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"audit_job_name"},"2":{"slot":2,"type":"STRING","value":"${job_name}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"audit_status"},"2":{"slot":2,"type":"STRING","value":"FAILURE"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332958":{"id":6332958,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-384,"y":80,"width":32,"height":32,"inputConnectorIDs":[6333035],"outputSuccessConnectorIDs":[6333030],"outputFailureConnectorIDs":[6333039],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit Begin"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"_Audit_Datalake_Public_Begin"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"audit_job_name"},"2":{"slot":2,"type":"STRING","value":"${job_name}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"audit_status"},"2":{"slot":2,"type":"STRING","value":"RUNNING"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332959":{"id":6332959,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-248,"y":82,"width":32,"height":32,"inputConnectorIDs":[6333030],"outputSuccessConnectorIDs":[6333032],"outputFailureConnectorIDs":[6333041],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Merge"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MERGE INTO ${SNFLKDB}.${SNFLKSCH}.DIM_TRANS T\nUSING (\n\tSELECT DISTINCT TRANS.ACTIVITY AS ACTIVITY\n\t\t,TRANS.OBJ_ID AS SRC_OBJ_ID\n\t\t,TRANS.ACCT_UNIT AS ACCT_UNIT_TXT\n\t\t,TRANS.ACCOUNT AS ACCOUNT_NM\n\t\t,TRANS.ACCT_CATEGORY AS ACCT_CAT_CD\n\t\t,TRANS.POSTING_DATE AS POSTING_DT\n\t\t,CASE \n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 7\n\t\t\t\tTHEN DATEADD(DAY, 1, TRANS.POSTING_DATE)\n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 6\n\t\t\t\tTHEN DATEADD(DAY, 2, TRANS.POSTING_DATE)\n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 5\n\t\t\t\tTHEN DATEADD(DAY, 3, TRANS.POSTING_DATE)\n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 4\n\t\t\t\tTHEN DATEADD(DAY, 4, TRANS.POSTING_DATE)\n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 3\n\t\t\t\tTHEN DATEADD(DAY, 5, TRANS.POSTING_DATE)\n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 2\n\t\t\t\tTHEN DATEADD(DAY, 6, TRANS.POSTING_DATE)\n\t\t\tELSE TRANS.POSTING_DATE\n\t\t\tEND AS NORM_POSTING_DT\n\t\t,COALESCE(PRD.TR_DATE, TRANS.TRAN_DATE) AS TRAN_DT\n\t\t,COALESCE(CASE \n\t\t\t\tWHEN TRANS.ACCOUNT IN (\n\t\t\t\t\t\t5100\n\t\t\t\t\t\t,5200\n\t\t\t\t\t\t,5310\n\t\t\t\t\t\t,5320\n\t\t\t\t\t\t,5330\n\t\t\t\t\t\t,5340\n\t\t\t\t\t\t,5400\n\t\t\t\t\t\t,5500\n\t\t\t\t\t\t,5501\n\t\t\t\t\t\t,5515\n\t\t\t\t\t\t,5520\n\t\t\t\t\t\t,5525\n\t\t\t\t\t\t,5530\n\t\t\t\t\t\t,5800\n\t\t\t\t\t\t)\n\t\t\t\t\tTHEN PRD.DIST_AMT\n\t\t\t\tELSE TRANS.TRAN_AMOUNT\n\t\t\t\tEND, 0.0) AS TRAN_AMT\n\t\t,TRANS.REFERENCE AS REF_TXT\n\t\t,TRANS.DESCRIPTION AS DESC_TXT\n\t\t,TRANS.RESOURCE_CODE AS RESOURCE_CD\n\t\t,TRANS.BILLABLE_UNIT AS BILLABLE_UNIT\n\t\t,COALESCE(PRD.HOURS, 0.0) AS UNITS_AMOUNT\n\t\t,TRANS.GLT_OBJ_ID AS GL_OBJ_ID\n\t\t,COALESCE(HIST.RESOURCE_CODE, '') AS ACH_RESOURCE_CD\n\t\t,TRANS.BILLABLE_AMT AS BILLABLE_AMT\n\t\t,TRANS.ACTIVITY_GRP AS ACTIVITY_GRP\n\t\t,TRANS.TRANS_TYPE AS TRANS_TYPE\n\t\t,TRANS.COMPANY AS COMPANY\n\t\t,TRANS.VAR_LEVELS AS VAR_LEVELS\n\t\t,TRANS.STATUS AS STATUS\n\t\t,TRANS.SYSTEM AS SYSTEM\n\t\t,TRANS.SOURCE_CODE AS SOURCE_CODE\n\t\t,TRANS.CAPITALIZE_FLG AS CAPITALIZE_FLG\n\t\t,TRANS.PERIOD AS PERIOD\n\t\t,TRANS.FISCAL_YEAR AS FISCAL_YEAR\n\t\t,TRANS.EXPENSE_CODE AS EXPENSE_CODE\n\t\t,TRANS.AP_PAID AS AP_PAID\n\t\t,TRANS.CAPITALIZABLE AS CAPITALIZABLE\n\t\t,TRANS.CATEGORY_TYPE AS CATEGORY_TYPE\n\t\t,TRANS.CONTROL_GROUP AS CONTROL_GROUP\n\t\t,TRANS.RUN_DATE AS RUN_DATE\n\t\t,TRANS.RUN_TIME AS RUN_TIME\n\t\t,TRANS.SEQUENCE_NBR AS SEQUENCE_NBR\n\t\t,TRANS.SUB_ACCOUNT AS SUB_ACCOUNT\n\t\t,TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(0)) AS CREATED_DT\n\t\t,CURRENT_USER() AS CREATED_BY\n\t\t,TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(0)) AS MODIFIED_DT\n\t\t,CURRENT_USER() AS MODIFIED_BY\n\t\t,'Y' AS ACTIVE_STATUS\n\t\t,ZPY.TIMEENTRY_ID AS TIMEENTRY_ID\n\t\t,PRT.JOB_CODE AS JOB_CODE\n\tFROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.ACTRANS TRANS\n\tLEFT JOIN (\n\t\tSELECT DISTINCT ATN_OBJ_ID\n\t\t\t,RESOURCE_CODE\n\t\tFROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.ACHISTDTL\n\t\t) HIST ON TRANS.OBJ_ID = HIST.ATN_OBJ_ID\n\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.ZPYBLMATCH ZPY ON TRANS.OBJ_ID = ZPY.ATN_OBJ_ID\n\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PRTIME PRT ON ZPY.TIME_SEQ = PRT.TIME_SEQ\n\t\tAND ZPY.EMPLOYEE = PRT.EMPLOYEE\n\tLEFT JOIN (\n\t\tSELECT PRD.ATN_OBJ_ID\n\t\t\t,PRD.TR_DATE\n\t\t\t,SUM(PRD.DIST_AMT) DIST_AMT\n\t\t\t,SUM(PRD.HOURS) HOURS\n\t\tFROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PRDISTRIB PRD\n\t\tGROUP BY PRD.ATN_OBJ_ID\n\t\t\t,PRD.TR_DATE\n\t\t) PRD ON PRD.ATN_OBJ_ID = TRANS.OBJ_ID\n\t) S\n\tON (\n\t\t\tT.ACTIVITY = S.ACTIVITY\n\t\t\tAND T.ACCT_UNIT_TXT = S.ACCT_UNIT_TXT\n\t\t\tAND T.POSTING_DT = S.POSTING_DT\n\t\t\tAND T.SRC_OBJ_ID = S.SRC_OBJ_ID\n\t\t\tAND T.TRAN_DT = S.TRAN_DT\n\t\t\tAND T.ACTIVE_STATUS = 'Y'\n\t\t\t)\nWHEN MATCHED\n\tAND (\n\t\tT.ACCOUNT_NM IS DISTINCT FROM S.ACCOUNT_NM\n\t\t\tOR T.ACCT_CAT_CD IS DISTINCT\n\t\tFROM S.ACCT_CAT_CD\n\t\t\tOR T.NORM_POSTING_DT IS DISTINCT\n\t\tFROM S.NORM_POSTING_DT\n\t\t\tOR T.TRAN_AMT IS DISTINCT\n\t\tFROM S.TRAN_AMT\n\t\t\tOR T.REF_TXT IS DISTINCT\n\t\tFROM S.REF_TXT\n\t\t\tOR T.DESC_TXT IS DISTINCT\n\t\tFROM S.DESC_TXT\n\t\t\tOR T.RESOURCE_CD IS DISTINCT\n\t\tFROM S.RESOURCE_CD\n\t\t\tOR T.BILLABLE_UNIT IS DISTINCT\n\t\tFROM S.BILLABLE_UNIT\n\t\t\tOR T.UNITS_AMOUNT IS DISTINCT\n\t\tFROM S.UNITS_AMOUNT\n\t\t\tOR T.GL_OBJ_ID IS DISTINCT\n\t\tFROM S.GL_OBJ_ID\n\t\t\tOR T.ACH_RESOURCE_CD IS DISTINCT\n\t\tFROM S.ACH_RESOURCE_CD\n\t\t\tOR T.BILLABLE_AMT IS DISTINCT\n\t\tFROM S.BILLABLE_AMT\n\t\t\tOR T.ACTIVITY_GRP IS DISTINCT\n\t\tFROM S.ACTIVITY_GRP\n\t\t\tOR T.TRANS_TYPE IS DISTINCT\n\t\tFROM S.TRANS_TYPE\n\t\t\tOR T.COMPANY IS DISTINCT\n\t\tFROM S.COMPANY\n\t\t\tOR T.VAR_LEVELS IS DISTINCT\n\t\tFROM S.VAR_LEVELS\n\t\t\tOR T.STATUS IS DISTINCT\n\t\tFROM S.STATUS\n\t\t\tOR T.SYSTEM IS DISTINCT\n\t\tFROM S.SYSTEM\n\t\t\tOR T.SOURCE_CODE IS DISTINCT\n\t\tFROM S.SOURCE_CODE\n\t\t\tOR T.CAPITALIZE_FLG IS DISTINCT\n\t\tFROM S.CAPITALIZE_FLG\n\t\t\tOR T.PERIOD IS DISTINCT\n\t\tFROM S.PERIOD\n\t\t\tOR T.FISCAL_YEAR IS DISTINCT\n\t\tFROM S.FISCAL_YEAR\n\t\t\tOR T.EXPENSE_CODE IS DISTINCT\n\t\tFROM S.EXPENSE_CODE\n\t\t\tOR T.AP_PAID IS DISTINCT\n\t\tFROM S.AP_PAID\n\t\t\tOR T.CAPITALIZABLE IS DISTINCT\n\t\tFROM S.CAPITALIZABLE\n\t\t\tOR T.CATEGORY_TYPE IS DISTINCT\n\t\tFROM S.CATEGORY_TYPE\n\t\t\tOR T.CONTROL_GROUP IS DISTINCT\n\t\tFROM S.CONTROL_GROUP\n\t\t\tOR T.RUN_DATE IS DISTINCT\n\t\tFROM S.RUN_DATE\n\t\t\tOR T.RUN_TIME IS DISTINCT\n\t\tFROM S.RUN_TIME\n\t\t\tOR T.SEQUENCE_NBR IS DISTINCT\n\t\tFROM S.SEQUENCE_NBR\n\t\t\tOR T.SUB_ACCOUNT IS DISTINCT\n\t\tFROM S.SUB_ACCOUNT\n\t\t\tOR T.JOB_CODE IS DISTINCT\n\t\tFROM S.JOB_CODE\n\t\t\tOR T.TIMEENTRY_ID IS DISTINCT\n\t\tFROM S.TIMEENTRY_ID\n\t\t)\n\t/*AND T.MODIFIED_DT = (\n\t\tSELECT MAX(MODIFIED_DT)\n\t\tFROM ${SNFLKDB}.${SNFLKSCH}.DIM_TRANS\n\t\tWHERE ACTIVITY = S.ACTIVITY\n\t\t\tAND ACCT_UNIT_TXT = S.ACCT_UNIT_TXT\n\t\t\tAND POSTING_DT = S.POSTING_DT\n\t\t\tAND SRC_OBJ_ID = S.SRC_OBJ_ID\n\t\t\tAND TRAN_DT = S.TRAN_DT\n\t\t)*/\n\tTHEN\n\t\tUPDATE\n\t\tSET MODIFIED_DT = TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(0))\n\t\t\t,MODIFIED_BY = CURRENT_USER()\n\t\t\t,ACTIVE_STATUS = 'N'\nWHEN NOT MATCHED\n\tTHEN\n\t\tINSERT (\n\t\t\tACTIVITY\n\t\t\t,SRC_OBJ_ID\n\t\t\t,ACCT_UNIT_TXT\n\t\t\t,ACCOUNT_NM\n\t\t\t,ACCT_CAT_CD\n\t\t\t,POSTING_DT\n\t\t\t,NORM_POSTING_DT\n\t\t\t,TRAN_DT\n\t\t\t,TRAN_AMT\n\t\t\t,REF_TXT\n\t\t\t,DESC_TXT\n\t\t\t,RESOURCE_CD\n\t\t\t,BILLABLE_UNIT\n\t\t\t,UNITS_AMOUNT\n\t\t\t,GL_OBJ_ID\n\t\t\t,ACH_RESOURCE_CD\n\t\t\t,BILLABLE_AMT\n\t\t\t,ACTIVITY_GRP\n\t\t\t,TRANS_TYPE\n\t\t\t,COMPANY\n\t\t\t,VAR_LEVELS\n\t\t\t,STATUS\n\t\t\t,SYSTEM\n\t\t\t,SOURCE_CODE\n\t\t\t,CAPITALIZE_FLG\n\t\t\t,PERIOD\n\t\t\t,FISCAL_YEAR\n\t\t\t,EXPENSE_CODE\n\t\t\t,AP_PAID\n\t\t\t,CAPITALIZABLE\n\t\t\t,CATEGORY_TYPE\n\t\t\t,CONTROL_GROUP\n\t\t\t,RUN_DATE\n\t\t\t,RUN_TIME\n\t\t\t,SEQUENCE_NBR\n\t\t\t,SUB_ACCOUNT\n\t\t\t,CREATED_DT\n\t\t\t,CREATED_BY\n\t\t\t,MODIFIED_DT\n\t\t\t,MODIFIED_BY\n\t\t\t,ACTIVE_STATUS\n\t\t\t,TIMEENTRY_ID\n\t\t\t,JOB_CODE\n\t\t\t)\n\t\tVALUES (\n\t\t\tS.ACTIVITY\n\t\t\t,S.SRC_OBJ_ID\n\t\t\t,S.ACCT_UNIT_TXT\n\t\t\t,S.ACCOUNT_NM\n\t\t\t,S.ACCT_CAT_CD\n\t\t\t,S.POSTING_DT\n\t\t\t,S.NORM_POSTING_DT\n\t\t\t,S.TRAN_DT\n\t\t\t,S.TRAN_AMT\n\t\t\t,S.REF_TXT\n\t\t\t,S.DESC_TXT\n\t\t\t,S.RESOURCE_CD\n\t\t\t,S.BILLABLE_UNIT\n\t\t\t,S.UNITS_AMOUNT\n\t\t\t,S.GL_OBJ_ID\n\t\t\t,S.ACH_RESOURCE_CD\n\t\t\t,S.BILLABLE_AMT\n\t\t\t,S.ACTIVITY_GRP\n\t\t\t,S.TRANS_TYPE\n\t\t\t,S.COMPANY\n\t\t\t,S.VAR_LEVELS\n\t\t\t,S.STATUS\n\t\t\t,S.SYSTEM\n\t\t\t,S.SOURCE_CODE\n\t\t\t,S.CAPITALIZE_FLG\n\t\t\t,S.PERIOD\n\t\t\t,S.FISCAL_YEAR\n\t\t\t,S.EXPENSE_CODE\n\t\t\t,S.AP_PAID\n\t\t\t,S.CAPITALIZABLE\n\t\t\t,S.CATEGORY_TYPE\n\t\t\t,S.CONTROL_GROUP\n\t\t\t,S.RUN_DATE\n\t\t\t,S.RUN_TIME\n\t\t\t,S.SEQUENCE_NBR\n\t\t\t,S.SUB_ACCOUNT\n\t\t\t,S.CREATED_DT\n\t\t\t,S.CREATED_BY\n\t\t\t,S.MODIFIED_DT\n\t\t\t,S.MODIFIED_BY\n\t\t\t,S.ACTIVE_STATUS\n\t\t\t,S.TIMEENTRY_ID\n\t\t\t,S.JOB_CODE\n\t\t\t)"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6333024":{"id":6333024,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-91,"y":85,"width":32,"height":32,"inputConnectorIDs":[6333032],"outputSuccessConnectorIDs":[6333031],"outputFailureConnectorIDs":[6333040],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Insert"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO ${ SNFLKDB}.${ SNFLKSCH}.DIM_TRANS (\n\tACTIVITY\n\t,SRC_OBJ_ID\n\t,ACCT_UNIT_TXT\n\t,ACCOUNT_NM\n\t,ACCT_CAT_CD\n\t,POSTING_DT\n\t,NORM_POSTING_DT\n\t,TRAN_DT\n\t,TRAN_AMT\n\t,REF_TXT\n\t,DESC_TXT\n\t,RESOURCE_CD\n\t,BILLABLE_UNIT\n\t,UNITS_AMOUNT\n\t,GL_OBJ_ID\n\t,ACH_RESOURCE_CD\n\t,BILLABLE_AMT\n\t,ACTIVITY_GRP\n\t,TRANS_TYPE\n\t,COMPANY\n\t,VAR_LEVELS\n\t,STATUS\n\t,SYSTEM\n\t,SOURCE_CODE\n\t,CAPITALIZE_FLG\n\t,PERIOD\n\t,FISCAL_YEAR\n\t,EXPENSE_CODE\n\t,AP_PAID\n\t,CAPITALIZABLE\n\t,CATEGORY_TYPE\n\t,CONTROL_GROUP\n\t,RUN_DATE\n\t,RUN_TIME\n\t,SEQUENCE_NBR\n\t,SUB_ACCOUNT\n\t,CREATED_DT\n\t,CREATED_BY\n\t,MODIFIED_DT\n\t,MODIFIED_BY\n\t,ACTIVE_STATUS\n\t,TIMEENTRY_ID\n\t,JOB_CODE\n\t)\nSELECT SRC.*\nFROM (\n\tSELECT DISTINCT TRANS.ACTIVITY AS ACTIVITY\n\t\t,TRANS.OBJ_ID AS SRC_OBJ_ID\n\t\t,TRANS.ACCT_UNIT AS ACCT_UNIT_TXT\n\t\t,TRANS.ACCOUNT AS ACCOUNT_NM\n\t\t,TRANS.ACCT_CATEGORY AS ACCT_CAT_CD\n\t\t,TRANS.POSTING_DATE AS POSTING_DT\n\t\t,CASE \n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 7\n\t\t\t\tTHEN DATEADD(DAY, 1, TRANS.POSTING_DATE)\n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 6\n\t\t\t\tTHEN DATEADD(DAY, 2, TRANS.POSTING_DATE)\n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 5\n\t\t\t\tTHEN DATEADD(DAY, 3, TRANS.POSTING_DATE)\n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 4\n\t\t\t\tTHEN DATEADD(DAY, 4, TRANS.POSTING_DATE)\n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 3\n\t\t\t\tTHEN DATEADD(DAY, 5, TRANS.POSTING_DATE)\n\t\t\tWHEN DATE_PART(dw, TRANS.POSTING_DATE) + 1 = 2\n\t\t\t\tTHEN DATEADD(DAY, 6, TRANS.POSTING_DATE)\n\t\t\tELSE TRANS.POSTING_DATE\n\t\t\tEND AS NORM_POSTING_DT\n\t\t,COALESCE(PRD.TR_DATE, TRANS.TRAN_DATE) AS TRAN_DT\n\t\t,COALESCE(CASE \n\t\t\t\tWHEN TRANS.ACCOUNT IN (\n\t\t\t\t\t\t5100\n\t\t\t\t\t\t,5200\n\t\t\t\t\t\t,5310\n\t\t\t\t\t\t,5320\n\t\t\t\t\t\t,5330\n\t\t\t\t\t\t,5340\n\t\t\t\t\t\t,5400\n\t\t\t\t\t\t,5500\n\t\t\t\t\t\t,5501\n\t\t\t\t\t\t,5515\n\t\t\t\t\t\t,5520\n\t\t\t\t\t\t,5525\n\t\t\t\t\t\t,5530\n\t\t\t\t\t\t,5800\n\t\t\t\t\t\t)\n\t\t\t\t\tTHEN PRD.DIST_AMT\n\t\t\t\tELSE TRANS.TRAN_AMOUNT\n\t\t\t\tEND, 0.0) AS TRAN_AMT\n\t\t,TRANS.REFERENCE AS REF_TXT\n\t\t,TRANS.DESCRIPTION AS DESC_TXT\n\t\t,TRANS.RESOURCE_CODE AS RESOURCE_CD\n\t\t,TRANS.BILLABLE_UNIT AS BILLABLE_UNIT\n\t\t,COALESCE(PRD.HOURS, 0.0) AS UNITS_AMOUNT\n\t\t,TRANS.GLT_OBJ_ID AS GL_OBJ_ID\n\t\t,COALESCE(HIST.RESOURCE_CODE, '') AS ACH_RESOURCE_CD\n\t\t,TRANS.BILLABLE_AMT AS BILLABLE_AMT\n\t\t,TRANS.ACTIVITY_GRP AS ACTIVITY_GRP\n\t\t,TRANS.TRANS_TYPE AS TRANS_TYPE\n\t\t,TRANS.COMPANY AS COMPANY\n\t\t,TRANS.VAR_LEVELS AS VAR_LEVELS\n\t\t,TRANS.STATUS AS STATUS\n\t\t,TRANS.SYSTEM AS SYSTEM\n\t\t,TRANS.SOURCE_CODE AS SOURCE_CODE\n\t\t,TRANS.CAPITALIZE_FLG AS CAPITALIZE_FLG\n\t\t,TRANS.PERIOD AS PERIOD\n\t\t,TRANS.FISCAL_YEAR AS FISCAL_YEAR\n\t\t,TRANS.EXPENSE_CODE AS EXPENSE_CODE\n\t\t,TRANS.AP_PAID AS AP_PAID\n\t\t,TRANS.CAPITALIZABLE AS CAPITALIZABLE\n\t\t,TRANS.CATEGORY_TYPE AS CATEGORY_TYPE\n\t\t,TRANS.CONTROL_GROUP AS CONTROL_GROUP\n\t\t,TRANS.RUN_DATE AS RUN_DATE\n\t\t,TRANS.RUN_TIME AS RUN_TIME\n\t\t,TRANS.SEQUENCE_NBR AS SEQUENCE_NBR\n\t\t,TRANS.SUB_ACCOUNT AS SUB_ACCOUNT\n\t\t,TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(0)) AS CREATED_DT\n\t\t,CURRENT_USER() AS CREATED_BY\n\t\t,TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(0)) AS MODIFIED_DT\n\t\t,CURRENT_USER() AS MODIFIED_BY\n\t\t,'Y' AS ACTIVE_STATUS\n\t\t,ZPY.TIMEENTRY_ID AS TIMEENTRY_ID\n\t\t,PRT.JOB_CODE AS JOB_CODE\n\tFROM ${ SFDBPROD_DATALAKE}.${ SFSCHLAWPROD}.ACTRANS TRANS\n\tLEFT JOIN (\n\t\tSELECT DISTINCT ATN_OBJ_ID\n\t\t\t,RESOURCE_CODE\n\t\tFROM ${ SFDBPROD_DATALAKE}.${ SFSCHLAWPROD}.ACHISTDTL\n\t\t) HIST ON TRANS.OBJ_ID = HIST.ATN_OBJ_ID\n\tLEFT JOIN ${ SFDBPROD_DATALAKE}.${ SFSCHLAWPROD}.ZPYBLMATCH ZPY ON TRANS.OBJ_ID = ZPY.ATN_OBJ_ID\n\tLEFT JOIN ${ SFDBPROD_DATALAKE}.${ SFSCHLAWPROD}.PRTIME PRT ON ZPY.TIME_SEQ = PRT.TIME_SEQ\n\t\tAND ZPY.EMPLOYEE = PRT.EMPLOYEE\n\tLEFT JOIN (\n\t\tSELECT PRD.ATN_OBJ_ID\n\t\t\t,PRD.TR_DATE\n\t\t\t,SUM(PRD.DIST_AMT) DIST_AMT\n\t\t\t,SUM(PRD.HOURS) HOURS\n\t\tFROM ${ SFDBPROD_DATALAKE}.${ SFSCHLAWPROD}.PRDISTRIB PRD\n\t\tGROUP BY PRD.ATN_OBJ_ID\n\t\t\t,PRD.TR_DATE\n\t\t) PRD ON PRD.ATN_OBJ_ID = TRANS.OBJ_ID\n\t) SRC\nWHERE NOT EXISTS (\n\t\tSELECT ACTIVITY\n\t\t\t,SRC_OBJ_ID\n\t\t\t,ACCT_UNIT_TXT\n\t\t\t,ACCOUNT_NM\n\t\t\t,ACCT_CAT_CD\n\t\t\t,POSTING_DT\n\t\t\t,NORM_POSTING_DT\n\t\t\t,TRAN_DT\n\t\t\t,TRAN_AMT\n\t\t\t,REF_TXT\n\t\t\t,DESC_TXT\n\t\t\t,RESOURCE_CD\n\t\t\t,BILLABLE_UNIT\n\t\t\t,UNITS_AMOUNT\n\t\t\t,GL_OBJ_ID\n\t\t\t,ACH_RESOURCE_CD\n\t\t\t,BILLABLE_AMT\n\t\t\t,ACTIVITY_GRP\n\t\t\t,TRANS_TYPE\n\t\t\t,COMPANY\n\t\t\t,VAR_LEVELS\n\t\t\t,STATUS\n\t\t\t,SYSTEM\n\t\t\t,SOURCE_CODE\n\t\t\t,CAPITALIZE_FLG\n\t\t\t,PERIOD\n\t\t\t,FISCAL_YEAR\n\t\t\t,EXPENSE_CODE\n\t\t\t,AP_PAID\n\t\t\t,CAPITALIZABLE\n\t\t\t,CATEGORY_TYPE\n\t\t\t,CONTROL_GROUP\n\t\t\t,RUN_DATE\n\t\t\t,RUN_TIME\n\t\t\t,SEQUENCE_NBR\n\t\t\t,SUB_ACCOUNT\t\t\t\n\t\t\t,TIMEENTRY_ID\n\t\t\t,JOB_CODE\n\t\tFROM ${ SNFLKDB}.${ SNFLKSCH}.DIM_TRANS TGT\n\t\tWHERE TGT.ACTIVITY = SRC.ACTIVITY\n\t\t\tAND TGT.ACCT_UNIT_TXT = SRC.ACCT_UNIT_TXT\n\t\t\tAND TGT.POSTING_DT = SRC.POSTING_DT\n\t\t\tAND TGT.SRC_OBJ_ID = SRC.SRC_OBJ_ID\n\t\t\tAND TGT.TRAN_DT = SRC.TRAN_DT\n  \t\t\tAND TGT.ACTIVE_STATUS = 'Y'\n\t\t)"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6333025":{"id":6333025,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":285,"y":-76,"width":32,"height":32,"inputConnectorIDs":[6333034],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6333026":{"id":6333026,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":-41,"y":-77,"width":32,"height":32,"inputConnectorIDs":[6333037],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6333036],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Prep Audit Failure"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select count(*) as rows_modified\nfrom ${SNFLKDB}.${SNFLKSCH}.dim_trans\nwhere modified_dt >= current_date()"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"audit_rowcount"},"2":{"slot":2,"type":"STRING","value":"ROWS_MODIFIED"}}}},"visible":true},"4":{"slot":4,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Table Columns","elements":{},"visible":false},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"11":{"slot":11,"name":"Order By","elements":{},"visible":false},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":false},"13":{"slot":13,"name":"Filter Conditions","elements":{},"visible":false},"14":{"slot":14,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":false},"20":{"slot":20,"name":"Basic / Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6333027":{"id":6333027,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":64,"y":80,"width":32,"height":32,"inputConnectorIDs":[6333031],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6333033],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Prep Audit Success"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select count(*) as rows_modified\nfrom ${SNFLKDB}.${SNFLKSCH}.dim_trans\nwhere modified_dt >= current_date()"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"audit_rowcount"},"2":{"slot":2,"type":"STRING","value":"ROWS_MODIFIED"}}}},"visible":true},"4":{"slot":4,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Table Columns","elements":{},"visible":false},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"10":{"slot":10,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"11":{"slot":11,"name":"Order By","elements":{},"visible":false},"12":{"slot":12,"name":"Sort","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ascending"}}}},"visible":false},"13":{"slot":13,"name":"Filter Conditions","elements":{},"visible":false},"14":{"slot":14,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":false},"20":{"slot":20,"name":"Basic / Advanced","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6333028":{"id":6333028,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":208,"y":80,"width":32,"height":32,"inputConnectorIDs":[6333033],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6333038],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit Success"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"_Audit_Datalake_Public_End"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"audit_job_name"},"2":{"slot":2,"type":"STRING","value":"${job_name}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"audit_status"},"2":{"slot":2,"type":"STRING","value":"SUCCESS"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6333029":{"id":6333029,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":352,"y":80,"width":32,"height":32,"inputConnectorIDs":[6333038],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"6333030":{"id":6333030,"sourceID":6332958,"targetID":6332959},"6333031":{"id":6333031,"sourceID":6333024,"targetID":6333027},"6333032":{"id":6333032,"sourceID":6332959,"targetID":6333024}},"failureConnectors":{"6333039":{"id":6333039,"sourceID":6332958,"targetID":6332955},"6333040":{"id":6333040,"sourceID":6333024,"targetID":6332955},"6333041":{"id":6333041,"sourceID":6332959,"targetID":6332955}},"unconditionalConnectors":{"6333033":{"id":6333033,"sourceID":6333027,"targetID":6333028},"6333034":{"id":6333034,"sourceID":6332957,"targetID":6333025},"6333035":{"id":6333035,"sourceID":6332956,"targetID":6332958},"6333036":{"id":6333036,"sourceID":6333026,"targetID":6332957},"6333037":{"id":6333037,"sourceID":6332955,"targetID":6333026},"6333038":{"id":6333038,"sourceID":6333028,"targetID":6333029}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"jb_DIM_TRANS","description":"","type":"ORCHESTRATION","tag":"598adb3c-004e-4e90-9401-02ad510fb441"}}