{"job":{"components":{"6341406":{"id":6341406,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":512,"y":48,"width":32,"height":32,"inputConnectorIDs":[6341490],"outputSuccessConnectorIDs":[6341485],"outputFailureConnectorIDs":[6341452],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Archive Files"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\n\ns3_client = boto3.Session()\ns3 = s3_client.resource('s3')\ns3_bucket_name= s3_URL.replace(\"s3:\", '').strip('/')\nbucket = s3.Bucket(s3_bucket_name)\ns3_resource = boto3.resource('s3')\n\nsource_folder = 'BH_Synch'\narchive_folder = 'BH_Synch/Archive'\n\ntime_now = datetime.datetime.now().strftime('_%Y%m%d')\n\n\nfor obj in bucket.objects.filter(Prefix=source_folder):\n\ttry:\n\t\tif not obj.key.startswith('BH_Synch/Archive'):\n\t\t\tsrc_file = os.path.basename(obj.key)\n\t\t\tname, extension = os.path.splitext(obj.key)\n\t\t\tif extension =='.csv' and src_file == bh_synch_filename:\n\t\t\t\ts3_src_file_path = source_folder +'/'+ src_file\n\t\t\t\tdest_file = src_file[:-4] + time_now + '.csv'\n\t\t\t\tprint('Archiving File:  ' + name)\n\t\t\t\n\t\t\t\ts3_dest_file_path = archive_folder +'/'+ dest_file\n\n\n\t\t\t\tobj_data = obj.get()['Body'].read()\n\n\n\t\t\t\td = boto3.Session()\n\t\t\t\ta = d.client('s3')\n\t\t\t\tres = a.put_object(Bucket=s3_bucket_name, Body=obj_data, Key=s3_dest_file_path)\n\t\t\t\tprint('Successfully Archived... ')\n\n            \n\texcept:\n\t\tprint('Error Archiving file : ' + src_file)\n\nprint('\\n****File successfully archived...!')\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341407":{"id":6341407,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-672,"y":48,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6341495],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341472":{"id":6341472,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":208,"y":-96,"width":32,"height":32,"inputConnectorIDs":[6341451,6341452,6341497,6341498,6341499,6341500],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6341494],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Failurepath 1"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341473":{"id":6341473,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-400,"y":192,"width":32,"height":32,"inputConnectorIDs":[6341492],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6341496],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SucessPath"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341474":{"id":6341474,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":662,"y":189,"width":32,"height":32,"inputConnectorIDs":[6341489,6341496],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6341493],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SucessPath 1"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341475":{"id":6341475,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":-400,"y":48,"width":32,"height":32,"inputConnectorIDs":[6341484],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[6341491],"outputFalseConnectorIDs":[6341492],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"If new file is available"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"counted_objects"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than"},"4":{"slot":4,"type":"STRING","value":"0"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341476":{"id":6341476,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":-544,"y":48,"width":32,"height":32,"inputConnectorIDs":[6341495],"outputSuccessConnectorIDs":[6341484],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Count files"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\n\"\"\"\n    Counts the number of .csv files in a specified S3 folder (excluding the 'Archive' subfolder)\n    and updates a context variable with the count.\n\n    Args:\n        source_folder (str): The S3 folder to search for .csv files.\n        s3_url (str): The S3 URL of the bucket to search within.\n\n    Returns:\n        int: The count of .csv files found in the specified folder (excluding the 'Archive' subfolder).\n    \n    Example:\n        count_csv_files_in_s3('essbase/UKG FTE Titles Mapping', 's3://your-bucket-name/')\n\"\"\"\ns3_client = boto3.Session()\ns3 = s3_client.resource('s3')\ns3_bucket_name= s3_URL.replace(\"s3:\", '').strip('/')\nbucket = s3.Bucket(s3_bucket_name)\nsource_folder = 'BH_Synch'\n\ncounted_objects = 0\nfor obj in bucket.objects.filter(Prefix=source_folder):\n    #print(obj)\n    if obj.key.endswith('.csv') and obj.key.find(f'{source_folder}/Archive/') == -1:\n        counted_objects = counted_objects + 1\n      \nprint(counted_objects)\n# Check if the list is empty\ncontext.updateVariable('counted_objects', counted_objects)\nif counted_objects == 0:\n    print(\"No files found.\")\n    # You can set a variable or exit with a specific code to finish the job\nelse:\n    print(\"Files found.\")\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341477":{"id":6341477,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":208,"y":48,"width":32,"height":32,"inputConnectorIDs":[6341488],"outputSuccessConnectorIDs":[6341486],"outputFailureConnectorIDs":[6341497],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate BH_Synch Table"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TRUNCATE TABLE ${SNFLKDB_ENT}.BH_SYNCH.DAILY_SYNC"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341478":{"id":6341478,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":352,"y":48,"width":32,"height":32,"inputConnectorIDs":[6341486],"outputSuccessConnectorIDs":[6341490],"outputFailureConnectorIDs":[6341498],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Insert NULL JOB ID"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INSERT INTO ${SNFLKDB_ENT}.BH_SYNCH.DAILY_SYNC (\n    CLASIFICATION, STATUS, CATEGORY, DATE_ADDED, OPNENINGS, JOB_TITLE, JOB_ID,\n    EXTERNAL_ID, COMPANY_NAME, COMPANY_ID, PAY_RATE, CLIENT_BILL_RATE,\n    EMPLOYMENT_TYPE, START_DATE, SCHEDULED_END, ADDRESS, CITY, STATE_OR_PROVINCE,\n    COUNTRY, JOB_DESCRIPTION, SHIFT, START_TIME, END_TIME, EDUCATION_REQUIREMENTS,\n    LOCATION_REQUIREMENTS, HOURS_PER_WEEK, PUBLISHING_STATUS, LAST_UPDATED, LAST_MODIFY_STATUS\n)\nSELECT\n    t.CLASIFICATION, t.STATUS, t.CATEGORY, t.DATE_ADDED, t.OPNENINGS, t.JOB_TITLE, t.JOB_ID,\n    t.EXTERNAL_ID, t.COMPANY_NAME, t.COMPANY_ID, t.PAY_RATE, t.CLIENT_BILL_RATE,\n    t.EMPLOYMENT_TYPE, t.START_DATE, t.SCHEDULED_END, t.ADDRESS, t.CITY, t.STATE_OR_PROVINCE,\n    t.COUNTRY, t.JOB_DESCRIPTION, t.SHIFT, t.START_TIME, t.END_TIME, t.EDUCATION_REQUIREMENTS,\n    t.LOCATION_REQUIREMENTS, t.HOURS_PER_WEEK, t.PUBLISHING_STATUS, t.LAST_UPDATED,\n    CURRENT_TIMESTAMP\nFROM ${SNFLKDB_ENT}.BH_SYNCH.LDG_CSV_SYNC AS t"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341479":{"id":6341479,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-112,"y":48,"width":32,"height":32,"inputConnectorIDs":[6341491],"outputSuccessConnectorIDs":[6341487],"outputFailureConnectorIDs":[6341500],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate LDG"}}}},"visible":true},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${SNFLKDB_ENT}"}}}},"visible":true},"4":{"slot":4,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BH_SYNCH"}}}},"visible":true},"5":{"slot":5,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"LDG_CSV_SYNC"}}}},"visible":true},"6":{"slot":6,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341480":{"id":6341480,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":773867971,"x":48,"y":48,"width":32,"height":32,"inputConnectorIDs":[6341487],"outputSuccessConnectorIDs":[6341488],"outputFailureConnectorIDs":[6341451],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Load from S3 to Snowflake"}}}},"visible":true},"4":{"slot":4,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://etld1/"}}}},"visible":true},"5":{"slot":5,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${SNFLKDB_ENT}"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BH_SYNCH"}}}},"visible":true},"8":{"slot":8,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"LDG_CSV_SYNC"}}}},"visible":true},"9":{"slot":9,"name":"Load Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CLASIFICATION"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"STATUS"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"CATEGORY"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"DATE_ADDED"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"OPNENINGS"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_TITLE"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_ID"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"EXTERNAL_ID"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"COMPANY_NAME"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"COMPANY_ID"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"PAY_RATE"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"CLIENT_BILL_RATE"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"EMPLOYMENT_TYPE"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"START_DATE"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"SCHEDULED_END"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"ADDRESS"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"CITY"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"STATE_OR_PROVINCE"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"COUNTRY"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"JOB_DESCRIPTION"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"SHIFT"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"START_TIME"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"END_TIME"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"EDUCATION_REQUIREMENTS"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"LOCATION_REQUIREMENTS"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"HOURS_PER_WEEK"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"PUBLISHING_STATUS"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"LAST_UPDATED"}}}},"visible":true},"10":{"slot":10,"name":"Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Custom]"}}}},"visible":true},"11":{"slot":11,"name":"File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSV"}}}},"visible":true},"12":{"slot":12,"name":"Compression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AUTO"}}}},"visible":true},"20":{"slot":20,"name":"Record Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\\n"}}}},"visible":true},"21":{"slot":21,"name":"Field Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":","}}}},"visible":true},"22":{"slot":22,"name":"Skip Header","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1"}}}},"visible":true},"23":{"slot":23,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"YYYY-MM-DD"}}}},"visible":true},"24":{"slot":24,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"25":{"slot":25,"name":"Timestamp Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"28":{"slot":28,"name":"Escape Unenclosed Field","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR_OR_ESCAPE_SEQUENCE","value":""}}}},"visible":true},"29":{"slot":29,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"30":{"slot":30,"name":"Field Optionally Enclosed","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\""}}}},"visible":true},"31":{"slot":31,"name":"Null If","elements":{},"visible":true},"32":{"slot":32,"name":"Error On Column Count Mismatch","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"33":{"slot":33,"name":"Empty Field as Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"True"}}}},"visible":true},"34":{"slot":34,"name":"Encoding Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":true},"35":{"slot":35,"name":"Skip Blank Lines","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"36":{"slot":36,"name":"Replace Invalid Characters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"40":{"slot":40,"name":"Enable Octal","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"41":{"slot":41,"name":"Allow Duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"42":{"slot":42,"name":"Strip Outer Array","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"43":{"slot":43,"name":"Strip Null Values","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"44":{"slot":44,"name":"Ignore UTF8 Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"45":{"slot":45,"name":"Nest Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"46":{"slot":46,"name":"Null If","elements":{},"visible":false},"47":{"slot":47,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"50":{"slot":50,"name":"Null If","elements":{},"visible":false},"51":{"slot":51,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"60":{"slot":60,"name":"Ignore UTF8 Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"61":{"slot":61,"name":"Preserve Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"62":{"slot":62,"name":"Strip Outer Element","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"63":{"slot":63,"name":"Disable Snowflake Data","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"64":{"slot":64,"name":"Disable Auto Convert","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"66":{"slot":66,"name":"Null If","elements":{},"visible":false},"67":{"slot":67,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"70":{"slot":70,"name":"Null If","elements":{},"visible":false},"71":{"slot":71,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"120":{"slot":120,"name":"On Error","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Abort Statement"}}}},"visible":true},"121":{"slot":121,"name":"n","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":false},"122":{"slot":122,"name":"Size Limit (B)","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true},"123":{"slot":123,"name":"Purge Files","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"124":{"slot":124,"name":"Truncate Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"125":{"slot":125,"name":"Force Load","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"126":{"slot":126,"name":"Match By Column Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":false},"140":{"slot":140,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"141":{"slot":141,"name":"Master Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"142":{"slot":142,"name":"KMS Key Id","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"143":{"slot":143,"name":"Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Credentials"}}}},"visible":true},"144":{"slot":144,"name":"Storage Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"200":{"slot":200,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Custom]"}}}},"visible":true},"201":{"slot":201,"name":"Pattern","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BH_Synch/${bh_synch_filename}"}}}},"visible":true},"203":{"slot":203,"name":"Metadata Fields","elements":{},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341481":{"id":6341481,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":656,"y":48,"width":32,"height":32,"inputConnectorIDs":[6341485],"outputSuccessConnectorIDs":[6341489],"outputFailureConnectorIDs":[6341499],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Completed At","mapTo":"audit_completed"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Delete from S3"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import boto3\nfrom datetime import datetime, timedelta\n\ns3_session = boto3.Session()\ns3_resource = s3_session.resource('s3')\ns3_client = s3_session.client('s3')\n\ns3_bucket_name= s3_URL.replace(\"s3:\", '').strip('/')\nbucket = s3_resource.Bucket(s3_bucket_name)\n\nsource_folder = 'BH_Synch'\n\ndrop_date = (datetime.today() - timedelta(days=0)).strftime('%Y%m%d')\nprint('Drop input path date is ', drop_date)\n\nkept_days = 365\ndrop_archive_date = (datetime.today() - timedelta(days=kept_days)).strftime('%Y%m%d')\nprint('Drop archive path date is ', drop_archive_date)\n\nfor obj in bucket.objects.filter(Prefix=source_folder):\n#\tprint(obj.key)\n    try:\n        if obj.key.endswith('.csv'): \n            src_file = os.path.basename(obj.key)\n      \t\t# This conditional is to remove files moved to the archive folder\n            if not obj.key.endswith('BH_Synch/Archive/'):\n                if src_file == bh_synch_filename:\n                    name, extension = os.path.splitext(obj.key)\n                    src_source_file_path = source_folder +'/'+ src_file\n                    s3_client.delete_object(Bucket=s3_bucket_name, Key=src_source_file_path)\n                    print('Successfully Deleted: ', obj.key)    \n            # This conditional is to purge in the archive folder files older than 365 days\n            else:\n                file_date = obj.last_modified.strftime('%Y%m%d')\n                if len(src_file) > 0 and file_date <= drop_archive_date:\n                    s3_client.delete_object(Bucket=s3_bucket_name, Key=obj.key)\n                    print(f'\\n****Archived file {src_file} with more than {kept_days} days old deleted...!')\n    except:\n        print('Error Deleting file : ' + src_file)\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341482":{"id":6341482,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":800,"y":192,"width":32,"height":32,"inputConnectorIDs":[6341493],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6341483":{"id":6341483,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":800,"y":-96,"width":32,"height":32,"inputConnectorIDs":[6341494],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"6341484":{"id":6341484,"sourceID":6341476,"targetID":6341475},"6341485":{"id":6341485,"sourceID":6341406,"targetID":6341481},"6341486":{"id":6341486,"sourceID":6341477,"targetID":6341478},"6341487":{"id":6341487,"sourceID":6341479,"targetID":6341480},"6341488":{"id":6341488,"sourceID":6341480,"targetID":6341477},"6341489":{"id":6341489,"sourceID":6341481,"targetID":6341474},"6341490":{"id":6341490,"sourceID":6341478,"targetID":6341406}},"failureConnectors":{"6341451":{"id":6341451,"sourceID":6341480,"targetID":6341472},"6341452":{"id":6341452,"sourceID":6341406,"targetID":6341472},"6341497":{"id":6341497,"sourceID":6341477,"targetID":6341472},"6341498":{"id":6341498,"sourceID":6341478,"targetID":6341472},"6341499":{"id":6341499,"sourceID":6341481,"targetID":6341472},"6341500":{"id":6341500,"sourceID":6341479,"targetID":6341472}},"unconditionalConnectors":{"6341493":{"id":6341493,"sourceID":6341474,"targetID":6341482},"6341494":{"id":6341494,"sourceID":6341472,"targetID":6341483},"6341495":{"id":6341495,"sourceID":6341407,"targetID":6341476},"6341496":{"id":6341496,"sourceID":6341473,"targetID":6341474}},"trueConnectors":{"6341491":{"id":6341491,"sourceID":6341475,"targetID":6341479}},"falseConnectors":{"6341492":{"id":6341492,"sourceID":6341475,"targetID":6341473}},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"counted_objects":{"definition":{"name":"counted_objects","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"0"}},"grids":{}},"info":{"name":"jb_BH_Synch_File","description":"","type":"ORCHESTRATION","tag":"c1f0bd44-603b-444a-893c-515db3ad48df"}}