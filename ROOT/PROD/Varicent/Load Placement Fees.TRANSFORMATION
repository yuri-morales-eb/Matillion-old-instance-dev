{"job":{"components":{"6342955":{"id":6342955,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":-290,"y":204,"width":32,"height":32,"inputConnectorIDs":[6342961],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PLACEMENT_FEES"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PLACEMENT_FEES"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"INVOICE_ID"},"2":{"slot":2,"type":"STRING","value":"INVOICE_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"CUSTOMER_ID"},"2":{"slot":2,"type":"STRING","value":"CUSTOMER_ID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"CUSTOMER_NAME"},"2":{"slot":2,"type":"STRING","value":"CUSTOMER_NAME"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"BILLED"},"2":{"slot":2,"type":"STRING","value":"BILLED"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"EVENT_AMOUNT"},"2":{"slot":2,"type":"STRING","value":"EVENT_AMOUNT"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"EVENT_DATE"},"2":{"slot":2,"type":"STRING","value":"EVENT_DATE"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"EVENT_TYPE"},"2":{"slot":2,"type":"STRING","value":"EVENT_TYPE"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"PAYEE_ID"},"2":{"slot":2,"type":"STRING","value":"PAYEE_ID"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"PAYEE_NAME"},"2":{"slot":2,"type":"STRING","value":"PAYEE_NAME"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"ACCT_UNIT"},"2":{"slot":2,"type":"STRING","value":"ACCT_UNIT"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"SYSUID"},"2":{"slot":2,"type":"STRING","value":"SYSUID"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"DL_CREATED_DATE"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_DATE"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"DL_CREATED_BY"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_BY"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"DL_JOBID"},"2":{"slot":2,"type":"STRING","value":"DL_JOBID"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${SNFLKSCH_VARICENT}"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB_Enterprise}"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"204":{"slot":204,"name":"Order By","elements":{},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6342956":{"id":6342956,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-416,"y":208,"width":32,"height":32,"inputConnectorIDs":[6342960],"outputConnectorIDs":[6342961],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ROW_ID"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Null"},"4":{"slot":4,"type":"STRING","value":""}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6342957":{"id":6342957,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-704,"y":128,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[6342963],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ldg_PF_Query"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"(SELECT\n        INVOICE_ID,\n        CUSTOMER_ID,\n        CUSTOMER_NAME,\n        SUM(DIRECT_HIRE+QH_FEES) AS BILLED,\n            case when SUM(DIRECT_HIRE+QH_FEES) is not null and MAX(APPLD_AMT) is null or MAX(ADJ_AMT) is null or MAX(CR_AMT) is null then BILLED\n            when COALESCE(MAX(APPLD_AMT), 0.0) is not null then MAX(APPLD_AMT)\n            when COALESCE(MAX(ADJ_AMT), 0.0) is not null  then MAX(ADJ_AMT)\n            when COALESCE(MAX(CR_AMT), 0.0) is not null then MAX(CR_AMT)\n                else '0'\n                    end as EVENT_AMOUNT, \n            case when MAX(GL_DATE) is not null then MAX(GL_DATE)\n            when MAX(BILL_DATE) is not null then MAX(BILL_DATE)\n                else '0'\n                    end as EVENT_DATE,\n            case when SUM(DIRECT_HIRE+QH_FEES) is not null and MAX(APPLD_AMT) is null or MAX(ADJ_AMT) is null or MAX(CR_AMT) is null then 'BILLED'\n            when MAX(APPLD_AMT) <> 0  and MAX(GL_DATE) is not null then 'PAYMENT'\n            when MAX(ADJ_AMT) <> 0  and MAX(GL_DATE) is not null then 'ADJ' \n            when MAX(CR_AMT) <> 0  and MAX(GL_DATE) is not null then 'CREDIT'\n                else 'NULL'\n                     end as EVENT_TYPE,\n        PAYEE_ID,\n        PAYEE_NAME,\n \t\tACCT_UNIT,\n        SYSUID,\n\t\tDL_CREATED_DATE,\n        DL_CREATED_BY,\n        DL_JOBID\n   FROM\n            (SELECT DISTINCT HDR.COMPANY,\n                    FIRST_VALUE(TRANS.ACCT_UNIT) OVER (PARTITION BY HDR.INVOICE\n                    ORDER BY LINE_NBR NULLS LAST) ACCOUNTING_UNIT,\n            HDR.CUSTOMER CUSTOMER_ID,\n            ARC.SEARCH_NAME CUSTOMER_NAME,\n            DTL.LINE_NBR,\n            DTL.DESCRIPTION,\n            HDR.INVOICE INVOICE_ID,\n            TRANS.TRAN_DATE,\n            TRANS.BILL_DATE,\n            DTL.UNITS_AMOUNT,\n            DTL.INVC_AMT,   \n                CASE WHEN TRANS.ACCT_CATEGORY IN ('590DH', '590RF') THEN DTL.INVC_AMT ELSE 0.00 END DIRECT_HIRE,\n                CASE WHEN TRANS.ACCT_CATEGORY IN ('590QH') THEN DTL.INVC_AMT ELSE 0.00 END QH_FEES,\n            TRANS.ACTIVITY,\n            TRANS.ACCT_CATEGORY,\n            ARA.GL_DATE,\n            ARA.APPLD_AMT,\n            ARA.ADJ_AMT,\n            ARA_CUS.CR_AMT,\n            UKG.EMPLOYEE_NUMBER PAYEE_ID,\n            concat(UD.first_name,' ', UD.last_name) PAYEE_NAME,\n            trans.acct_unit,\n            SUB.SYSTEMUSERID SYSUID,\n            CURRENT_TIMESTAMP AS DL_CREATED_DATE,\n\t\t\tCAST('${environment_username}' as  VARCHAR(50)) AS DL_CREATED_BY,\n\t\t\tCAST('${run_history_id}' as VARCHAR(50)) AS DL_JOBID         \n        FROM ${DB_Datalake}.${Sch_Lawprod}.ACHISTHDR HDR\n      INNER JOIN ${DB_Datalake}.${Sch_Lawprod}.ACHISTDTL DTL ON HDR.OBJ_ID = DTL.OBJ_ID\n      INNER JOIN ${DB_Datalake}.${Sch_Lawprod}.ARCUSTOMER ARC ON HDR.COMPANY = ARC.COMPANY\n      AND LTRIM(HDR.CUSTOMER)= TRIM(ARC.CUSTOMER)\n      INNER JOIN ${DB_Datalake}.${Sch_Lawprod}.ACTRANS TRANS ON DTL.ATN_OBJ_ID = TRANS.OBJ_ID\n      INNER JOIN ${DB_Datalake}.${Sch_Lawprod}.ARPROCLEVL ARP ON ARC.COMPANY = ARP.COMPANY\n      AND ARC.DEFAULT_CODE = ARP.PROCESS_LEVEL\n      INNER JOIN ${DB_Datalake}.${Sch_Lawprod}.ACACTIVITY ACA ON ACA.ACTIVITY = TRANS.ACTIVITY\n      LEFT JOIN\n            (SELECT DISTINCT COMPANY,\n                         INVOICE,\n                         TRANS_TYPE,\n                         MAX(GL_DATE) GL_DATE,\n                         COALESCE(SUM(CASE WHEN CR_TYPE = 'P' THEN APPLD_AMT ELSE 0.0 END), 0.0) APPLD_AMT,\n                         COALESCE(SUM(ADJ_AMT), 0.0) ADJ_AMT\n            FROM ${DB_Datalake}.${Sch_Lawprod}.ARAPPLIED\n         GROUP BY COMPANY,\n                  INVOICE,\n                  TRANS_TYPE) ARA ON ARA.COMPANY = HDR.COMPANY\n      AND ARA.INVOICE = HDR.INVOICE\n      AND ARA.TRANS_TYPE = HDR.INVOICE_TYPE\n      LEFT JOIN\n        (SELECT DISTINCT COMPANY,\n                         INVOICE,\n                         TRANS_TYPE,\n                         COALESCE(SUM(CASE WHEN CR_TYPE = 'C' THEN CR_APP_AMT ELSE 0.0 END), 0.0) CR_AMT\n          FROM ${DB_Datalake}.${Sch_Lawprod}.ARAPPLIED\n         GROUP BY COMPANY,\n                  INVOICE,\n                  TRANS_TYPE) ARA_CUS ON ARA_CUS.COMPANY = HDR.COMPANY\n        AND ARA_CUS.INVOICE = HDR.INVOICE\n        AND ARA_CUS.TRANS_TYPE = HDR.INVOICE_TYPE\n        LEFT JOIN ${DB_Datalake}.${Sch_Lawprod}.ACACTMXVAL AMX_SALESREP ON AMX_SALESREP.OBJ_ID = ACA.OBJ_ID\n              AND AMX_SALESREP.MATRIX_CAT = 'SALESREP'\n        left join ${DB_Datalake}.${SNFLKSCH_CRM}.systemuserbase sub on sub.cda_usernumber = AMX_SALESREP.MX_VALUE\n        left join ${SNFLEDWDB}.${SNFLEDWSCH}.SYSTEM_USERS_DIM UD on sub.SYSTEMUSERID = UD.user_id\n        left join ${SNFLEDWDB}.${SNFLEDWSCH}.UKG_USER_DIM UKG ON LOWER(UD.SAM_ACCOUNT) = LOWER(SUBSTRING(UKG.UPN,1,CHARINDEX('@',UKG.UPN)-1))\n                   WHERE TRANS.ACCOUNT = 5900\n                and TRANS.ACCT_UNIT not between '07000' and '07999'\n\t\t\t\tand TRANS.BILL_DATE>'2021-12-27'\n        AND TRANS.ACCT_CATEGORY IN ('590DH','590QH', '590RF') ) \n  \n   GROUP BY \n        INVOICE_ID,\n        CUSTOMER_ID,\n        CUSTOMER_NAME,\n        PAYEE_ID,\n        PAYEE_NAME,\n\t\tACCT_UNIT,\n\t\tSYSUID,\n\t\tDL_CREATED_DATE,\n\t\tDL_CREATED_BY,\n\t\tDL_JOBID)"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6342958":{"id":6342958,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-704,"y":272,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[6342962],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"src_PF Table"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PLACEMENT_FEES"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ROW_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"INVOICE_ID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"CUSTOMER_ID"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"CUSTOMER_NAME"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"BILLED"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"EVENT_AMOUNT"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"EVENT_DATE"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"EVENT_TYPE"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"PAYEE_ID"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"PAYEE_NAME"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"ACCT_UNIT"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"SYSUID"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"DL_CREATED_DATE"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"DL_CREATED_BY"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"DL_JOBID"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${SNFLKSCH_VARICENT}"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB_Enterprise}"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6342959":{"id":6342959,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-544,"y":208,"width":32,"height":32,"inputConnectorIDs":[6342962,6342963],"outputConnectorIDs":[6342960],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Left Join vs Target"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ldg_PF_Query"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ldg"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"src_PF Table"},"2":{"slot":2,"type":"STRING","value":"tgt"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"tgt\".\"INVOICE_ID\" = \"ldg\".\"INVOICE_ID\" \nAND \"tgt\".\"CUSTOMER_ID\" = \"ldg\".\"CUSTOMER_ID\" \nAND \"tgt\".\"CUSTOMER_NAME\" = \"ldg\".\"CUSTOMER_NAME\" \nAND \"tgt\".\"BILLED\" = \"ldg\".\"BILLED\" \nAND \"tgt\".\"EVENT_AMOUNT\" = \"ldg\".\"EVENT_AMOUNT\" \nAND \"tgt\".\"EVENT_DATE\" = \"ldg\".\"EVENT_DATE\" \nAND \"tgt\".\"EVENT_TYPE\" = \"ldg\".\"EVENT_TYPE\" "},"2":{"slot":2,"type":"STRING","value":"ldg_Left_tgt"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.INVOICE_ID"},"2":{"slot":2,"type":"STRING","value":"INVOICE_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.CUSTOMER_ID"},"2":{"slot":2,"type":"STRING","value":"CUSTOMER_ID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.CUSTOMER_NAME"},"2":{"slot":2,"type":"STRING","value":"CUSTOMER_NAME"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.BILLED"},"2":{"slot":2,"type":"STRING","value":"BILLED"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.EVENT_AMOUNT"},"2":{"slot":2,"type":"STRING","value":"EVENT_AMOUNT"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.EVENT_DATE"},"2":{"slot":2,"type":"STRING","value":"EVENT_DATE"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.EVENT_TYPE"},"2":{"slot":2,"type":"STRING","value":"EVENT_TYPE"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.PAYEE_ID"},"2":{"slot":2,"type":"STRING","value":"PAYEE_ID"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.PAYEE_NAME"},"2":{"slot":2,"type":"STRING","value":"PAYEE_NAME"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.ACCT_UNIT"},"2":{"slot":2,"type":"STRING","value":"ACCT_UNIT"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.SYSUID"},"2":{"slot":2,"type":"STRING","value":"SYSUID"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.DL_CREATED_DATE"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_DATE"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.DL_CREATED_BY"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_BY"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"ldg.DL_JOBID"},"2":{"slot":2,"type":"STRING","value":"DL_JOBID"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"tgt.ROW_ID"},"2":{"slot":2,"type":"STRING","value":"ROW_ID"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"6342960":{"id":6342960,"sourceID":6342959,"targetID":6342956},"6342961":{"id":6342961,"sourceID":6342956,"targetID":6342955},"6342962":{"id":6342962,"sourceID":6342958,"targetID":6342959},"6342963":{"id":6342963,"sourceID":6342957,"targetID":6342959}},"notes":{},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"Load Placement Fees","description":"","type":"TRANSFORMATION","tag":"1a902e15-5d7b-419e-8755-89e77edb08cd"}}