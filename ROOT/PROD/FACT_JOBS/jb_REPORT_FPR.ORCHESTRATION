{"job":{"components":{"6332605":{"id":6332605,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":304,"y":32,"width":32,"height":32,"inputConnectorIDs":[6332654],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_REPORT_FPR_FAILURE"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_REPORT_FPR"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332606":{"id":6332606,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":304,"y":-64,"width":32,"height":32,"inputConnectorIDs":[6332652],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_REPORT_FPR_SUCCESS"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_REPORT_FPR"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332607":{"id":6332607,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":0,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6332653],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6332651":{"id":6332651,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":176,"y":0,"width":32,"height":32,"inputConnectorIDs":[6332653],"outputSuccessConnectorIDs":[6332652],"outputFailureConnectorIDs":[6332654],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Status","mapTo":"audit_status"},"2":{"slot":2,"fromId":null,"fromName":"Component","mapTo":"audit_component"},"3":{"slot":3,"fromId":null,"fromName":"Started At","mapTo":"audit_started"},"4":{"slot":4,"fromId":null,"fromName":"Duration","mapTo":"audit_duration"},"5":{"slot":5,"fromId":null,"fromName":"Completed At","mapTo":"audit_completed"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"REPORT_FPR"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\ncursor = context.cursor()\ncursor.execute(\"DELETE FROM ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR\")\ncursor.execute('''/* Title: REPORT_DIMENSIONS_TEMP\n\n    Date: 05/19/2025\n    Author: pablo.aguilar@employbridge.com\n    Summary: Populates Report_fpr table with data from DIM_MEASURE_SUMMARY_A_TEMP and ACTIV_B_TEMP tables.\n    Ticket information: https://ebpp.atlassian.net/browse/CER-6646\n\n    Modifications:\n    05/19/2025 PA: Added a sub-query to the main SELECT statement to join with the DIM_EMPLOYEE table. This propagates the resource_cd to activities that have records with empty resource_cd.\n    If activity A1 has a record with resource_cd = 1234, and the same activity in another row has no resource_cd, the second row will have access to the resouce_cd and src_emp_id, last_name and first_name will be populated.\n\n */\n\nINSERT INTO ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR (BRANCH, REGION, CUST_ID, CUST_NAME, INVOICE, WORK_STATE, ASSIGNMENT,\n                                               EMPL_ID, LAST, FIRST, ORDER_TYPE, JOB_CODE, NORM_POSTING_DATE, TRAN_DATE,\n                                               WC_CODE, GL_ACCOUNT, WAGE_CODE, WAGE_CODE_DESCRIPTION, BILL_HRS,\n                                               BILL_RATE, BILL_AMT, PAY_HRS, PAY_RATE, PAY_AMT, FICA, FICA_PERCENT,\n                                               FUTA, FUTA_PERCENT, SUI, SUI_PERCENT, WORK_COMP, WC_BY_100, GLI_EPLI,\n                                               ACA, OTHER, OTHER_PERCENT, GM, GM_PERCENT, FILLEDBY, SUPERVISOR,\n                                               SALES_REP)\nSELECT DISTINCT A.ACCT_UNIT                                                       AS BRANCH,\n                A.REGION                                                          AS REGION,\n                A.CUST_ID                                                         AS CUST_ID,\n                A.CUST_NAME                                                       AS CUST_NAME,\n                A.INVOICE                                                         AS INVOICE,\n                A.WORK_STATE                                                      AS WORK_STATE,\n                A.ACTIVITY                                                        AS ASSIGNMENT,\n                --------------------------------------Added by PA 5/19/2025-------------------------------------------------------------\n                coalesce(A.SRC_EMP_ID, fill.SRC_EMP_ID)                           AS EMPL_ID,\n                coalesce(A.LAST, fill.LAST_NAME)                                  AS LAST,\n                coalesce(A.FIRST, fill.FIRST_NAME)                                AS FIRST,\n                --------------------------------------Added by PA 5/19/2025-------------------------------------------------------------\n                A.ORDER_TYPE                                                      AS ORDER_TYPE,\n                A.JOB_CODE                                                        AS JOB_CODE,\n                A.NORM_POSTING_DATE                                               AS NORM_POSTING_DATE,\n                A.TRAN_DATE                                                       AS TRAN_DATE,\n                A.WC_CODE                                                         AS WC_CODE,\n                CASE WHEN A.ACCT_CATEGORY2_A = 'BILLD' THEN A.ACCOUNT ELSE '' END AS GL_ACCOUNT,\n                A.ACCT_CATEGORY2_A                                                AS WAGE_CODE,\n                A.WAGE_CODE_DESCRIPTION                                           AS WAGE_CODE_DESCRIPTION,\n                A.BILLABLE_UNIT                                                   AS BILL_HRS,\n                A.BILL_RATE                                                       AS BILL_RATE,\n                A.BILLABLE_AMT                                                    AS BILL_AMT,\n                A.PAY_HRS                                                         AS PAY_HRS,\n                CAST(A.PAY_RATE AS NUMBER(18, 2))                                 AS PAY_RATE,\n                A.PAY_AMT                                                         AS PAY_AMT,\n                A.FICA                                                            AS FICA,\n                A.FICA_PERCENT                                                    AS FICA_PERCENT,\n                A.FUTA                                                            AS FUTA,\n                A.FUTA_PERCENT                                                    AS FUTA_PERCENT,\n                A.SUI                                                             AS SUI,\n                A.SUI_PERCENT                                                     AS SUI_PERCENT,\n                A.WORK_COMP                                                       AS WORK_COMP,\n                A.WC_BY_100,\n                A.GLI_EPLI                                                        AS GLI_EPLI,\n                A.ACA                                                             AS ACA,\n                A.OTHER                                                           AS OTHER,\n                A.OTHER_PERCENT                                                   AS OTHER_PERCENT,\n                A.GM                                                              AS GM,\n                A.GM_PERCENT                                                      AS GM_PERCENT,\n                A.FILLEDBY                                                        AS FILLEDBY,\n                A.SUPERVISOR                                                      AS SUPERVISOR,\n                A.SALES_REP                                                       AS SALES_REP\nFROM (SELECT A.*,\n             CASE\n                 WHEN ACCT_CATEGORY2 IS NULL\n                     AND BILLABLE_AMT = 0\n                     AND (\n                          BILLABLE_UNIT = 0\n                              OR BILLABLE_UNIT IS NULL\n                          )\n                     AND (\n                          PAY_HRS = 0\n                              OR PAY_HRS IS NULL\n                          )\n                     AND PAY_AMT = 0\n                     AND (\n                          OTHER <> 0\n                              OR GLI_EPLI <> 0\n                              OR ACA <> 0\n                          ) THEN 'PDSP'\n                 ELSE ACCT_CATEGORY2 END AS ACCT_CATEGORY2_A,\n             B.BRANCH_ID\n      FROM ${SNFLKDB}.${SNFLKSCH}.DIM_MEASURE_SUMMARY_A_TEMP A\n               LEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_BRANCH B ON A.ACCT_UNIT = B.BRANCH_NM\n          AND B.ACTIVE_STATUS = 'Y') A\n--------------------------------------Added by PA 5/19/2025-------------------------------------------------------------\nleft join (SELECT prefill.*\nFROM (\n    SELECT DISTINCT\n        tran.activity,\n        tran.resource_cd,\n        dimemp.first_name,\n        dimemp.last_name,\n        dimemp.src_emp_id\n    FROM ${SNFLKDB}.${SNFLKSCH}.DIM_TRANS tran\n    LEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_EMPLOYEE dimemp\n        ON tran.resource_cd = dimemp.resource_cd\n    WHERE substr(tran.activity, 1, 1) = 'A'\n        AND dimemp.src_emp_id IS NOT NULL\n        AND dimemp.active_status = 'Y'\n) prefill\nLEFT JOIN (\n    SELECT\n        activity\n    FROM (\n        SELECT DISTINCT\n            tran.activity,\n            tran.resource_cd,\n            dimemp.first_name,\n            dimemp.last_name,\n            dimemp.src_emp_id\n        FROM ${SNFLKDB}.${SNFLKSCH}.DIM_TRANS tran\n        LEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_EMPLOYEE dimemp\n            ON tran.resource_cd = dimemp.resource_cd\n        WHERE substr(tran.activity, 1, 1) = 'A'\n            AND dimemp.src_emp_id IS NOT NULL\n            AND dimemp.active_status = 'Y'\n    )\n    GROUP BY activity\n    HAVING COUNT(1) > 1\n) dupes\n    ON prefill.activity = dupes.activity\nWHERE dupes.activity IS NULL) fill\n  on fill.activity = A.activity\n--------------------------------------Added by PA 5/19/2025-------------------------------------------------------------\n\nUNION ALL\n\nSELECT B.WBS_ACCT_UNIT                                                      AS BRANCH,\n       ''                                                                   AS REGION,\n       B.CUSTOMER                                                           AS CUST_ID,\n       B.SEARCH_NAME                                                        AS CUST_NAME,\n       B.INVOICE                                                            AS INVOICE,\n       ''                                                                   AS WORK_STATE,\n       B.WBS_ACTIVITY                                                       AS ASSIGNMENT,\n       ''                                                                   AS EMPL_ID,\n       B.DESCRIPTION                                                        AS LAST,\n       ''                                                                   AS FIRST,\n       ''                                                                   AS ORDER_TYPE,\n       ''                                                                   AS JOB_CODE,\n       B.WBS_NORM_POSTING_DATE,\n       B.WBS_TRAN_DATE,\n       ''                                                                   AS WC_CODE,\n       CASE WHEN B.WBS_ACCT_CATEGORY = 'BILLD' THEN WBS_ACCOUNT ELSE '' END AS GL_ACCOUNT,\n       B.WBS_ACCT_CATEGORY                                                  AS WAGE_CODE,\n       ''                                                                   AS WAGE_CODE_DESCRIPTION,\n       0.00                                                                 AS BILL_HRS,\n       0.00                                                                 AS BILL_RATE,\n       B.WBS_TRAN_AMOUNT                                                    AS BILL_AMT,\n       0.00                                                                 AS PAY_HRS,\n       0.00                                                                 AS PAY_RATE,\n       0.00                                                                 AS PAY_AMT,\n       0.00                                                                 AS FICA,\n       0.00                                                                 AS FICA_PERCENT,\n       0.00                                                                 AS FUTA,\n       0.00                                                                 AS FUTA_PERCENT,\n       0.00                                                                 AS SUI,\n       0.00                                                                 AS SUI_PERCENT,\n       0.00                                                                 AS WORK_COMP,\n       0.00                                                                 AS WC_BY_100,\n       0.00                                                                 AS GLI_EPLI,\n       0.00                                                                 AS ACA,\n       B.WBS_OTHER                                                          AS OTHER,\n       0.00                                                                 AS OTHER_PERCENT,\n       (B.WBS_TRAN_AMOUNT - B.WBS_OTHER)                                    AS GM,\n       0.00                                                                 AS GM_PERCENT,\n       ''                                                                   AS FILLEDBY,\n       ''                                                                   AS SUPERVISOR,\n       ''                                                                   AS SALES_REP\nFROM ${SNFLKDB}.${SNFLKSCH}.ACTIV_B_TEMP B''')\n\ncursor.execute(\"\"\"/* Title: REPORT_DIMENSIONS_TEMP\n\n    Date: 05/19/2025\n    Author: pablo.aguilar@employbridge.com\n    Summary: Populates Report_fpr table with data from DIM_MEASURE_SUMMARY_A_TEMP and ACTIV_B_TEMP tables.\n    Ticket information: https://ebpp.atlassian.net/browse/CER-6646\n\n    Modifications:\n    05/19/2025 PA: Added a sub-query to the main SELECT statement to join with the DIM_EMPLOYEE table. This propagates the resource_cd to activities that have records with empty resource_cd.\n    If activity A1 has a record with resource_cd = 1234, and the same activity in another row has no resource_cd, the second row will have access to the resouce_cd and src_emp_id, last_name and first_name will be populated.\n\n */\n\nINSERT INTO ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR (BRANCH, REGION, CUST_ID, CUST_NAME, INVOICE, WORK_STATE, ASSIGNMENT,\n                                               EMPL_ID, LAST, FIRST, ORDER_TYPE, JOB_CODE, NORM_POSTING_DATE, TRAN_DATE,\n                                               WC_CODE, GL_ACCOUNT, WAGE_CODE, WAGE_CODE_DESCRIPTION, BILL_HRS,\n                                               BILL_RATE, BILL_AMT, PAY_HRS, PAY_RATE, PAY_AMT, FICA, FICA_PERCENT,\n                                               FUTA, FUTA_PERCENT, SUI, SUI_PERCENT, WORK_COMP, WC_BY_100, GLI_EPLI,\n                                               ACA, OTHER, OTHER_PERCENT, GM, GM_PERCENT, FILLEDBY, SUPERVISOR,\n                                               SALES_REP)\nSELECT DISTINCT TRANS.ACCT_UNIT_TXT                                                            BRANCH,\n                REGION.MX_VALUE                                                                REGION,\n                CUST.CUSTOMER,\n                CUST.SEARCH_NAME,\n                INV.INVOICE_NUM                                                                INVOICE,\n                PR.WORK_STATE                                                                  WORK_STATE,\n                TRANS.ACTIVITY                                                                 ASSIGNMENT,\n                --------------------------------------Added by PA 5/19/2025-------------------------------------------------------------\n                coalesce(EMP.SRC_EMP_ID, fill.SRC_EMP_ID)                         AS           EMPL_ID,\n                coalesce(EMP.LAST_NAME, fill.LAST_NAME)                           AS           LAST,\n                coalesce(EMP.FIRST_NAME, fill.FIRST_NAME)                         AS           FIRST,\n                --------------------------------------Added by PA 5/19/2025-------------------------------------------------------------\n                JO.JOB_ORD_TYP                                                                 ORDER_TYPE,\n                JO.JOB_CD_NM                                                                   JOB_CODE,\n                DATEADD(DAY, (7 - DATE_PART(WEEKDAY, TRANS.POSTING_DT)) % 7, TRANS.POSTING_DT) NORM_POSTING_DATE,\n                TRANS.TRAN_DT                                                                  TRAN_DATE,\n                COALESCE(TRANS.JOB_CODE, CWC.CDA_CODE) AS                                      WC_CODE,\n                ''                                                                             GL_ACCOUNT,\n                TRANS.ACCT_CAT_CD                                                              WAGE_CODE,\n                WC.WAGE_CD_DESC_TXT                                                            WAGE_CODE_DESCRIPTION,\n                SUM(TRANS.UNITS_AMOUNT)                                                        BILL_HRS,\n                0.00                                                                           BILL_RATE,\n                0.00                                                                           BILL_AMT,\n                PR.HOURS                               AS                                      PAY_HRS,\n                0.00                                                                           PAY_RATE,\n                CASE\n                    WHEN (TRANS.ACCOUNT_NM IN (5100, 5950, 5525, 6120, 5520, 5515) OR\n                          (TRANS.ACCOUNT_NM IN (5900) AND SUM(TRANS.UNITS_AMOUNT) <> 0)) THEN SUM(TRANS.TRAN_AMT)\n                    ELSE 0.00 END                      AS                                      PAY_AMT,\n                0.00                                                                           FICA,\n                0.00                                                                           FICA_PERCENT,\n                0.00                                                                           FUTA,\n                0.00                                                                           FUTA_PERCENT,\n                0.00                                                                           SUI,\n                0.00                                                                           SUI_PERCENT,\n                0.00                                                                           WORK_COMP,\n                0.00                                                                           WC_BY_100,\n                0.00                                                                           GLI_EPLI,\n                0.00                                                                           ACA,\n                0.00                                                                           OTHER,\n                0.00                                                                           OTHER_PERCENT,\n                0.00                                                                           GM,\n                0.00                                                                           GM_PERCENT,\n                ASGN.FILLED_BY_ID_NAME                                                         FILLED_BY_ID_NAME,\n                ASGN.REPORTS_TO_ID_NM                                                          SUPERVISOR,\n                ACT.SALES_REP_NM                                                               SALES_REP_NM\nFROM ${SNFLKDB}.${SNFLKSCH}.DIM_TRANS TRANS\nLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_INVOICE INV\n        ON TRANS.SRC_OBJ_ID = INV.SRC_OBJ_ID AND INV.ACTIVE_STATUS = 'Y'\nLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_PAYRATE_TRANS PR\n        ON PR.ATN_OBJ_ID = TRANS.SRC_OBJ_ID AND PR.ACTIVE_STATUS = 'Y'\nLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_ACTIVITY ACT\n        ON TRANS.ACTIVITY = ACT.ACTIVITY_TXT AND ACT.ACTIVE_STATUS = 'Y'\nLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_WAGE_CODE WC ON WC.WAGE_CD = TRANS.ACCT_CAT_CD AND WC.ACTIVE_STATUS = 'Y'\nLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_ASSIGNMENT ASGN\n        ON SUBSTR(TRANS.ACTIVITY, 2) = ASGN.ASSIGN_NUM AND ASGN.ACTIVE_STATUS = 'Y'\nLEFT JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_ASSIGNMENTBASE LASGN\n        ON ASGN.ASSIGN_NUM = LASGN.CDA_ASSIGNMENTNUMBER\nLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_JOB_ORDER JO\n        ON JO.SRC_JOB_ORD_ID = LASGN.CDA_JOBORDER AND JO.ACTIVE_STATUS = 'Y'\nLEFT JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_WCCODEBASE CWC ON LASGN.CDA_WCCODE = CWC.CDA_WCCODEID\nLEFT JOIN (SELECT CUS.*, ACT.ACTIVITY_TXT\n        FROM ${SNFLKDB}.${SNFLKSCH}.DIM_CUSTOMER CUS\n                    JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_ACTIVITY ACT\n                        ON CUS.CUSTOMER = ACT.LEVEL_DETAIL_02 AND ACT.ACTIVE_STATUS = 'Y'\n        WHERE CUS.ACTIVE_STATUS = 'Y') CUST ON TRANS.ACTIVITY = CUST.ACTIVITY_TXT\nLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_EMPLOYEE EMP\n        ON EMP.RESOURCE_CD = TRY_TO_NUMBER(TRANS.RESOURCE_CD) AND EMP.ACTIVE_STATUS = 'Y'\nLEFT JOIN (SELECT DISTINCT MX_VALUE, ACT.ACTIVITY_TXT, REGION_ID\n    FROM ${SNFLKDB}.${SNFLKSCH}.DIM_ACTIVITY ACT\n                LEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.ARCUSTOMER ARC\n                        ON LTRIM(ARC.CUSTOMER) = ACT.LEVEL_DETAIL_02\n                INNER JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.ARCSTMXVAL ARMX ON ARMX.OBJ_ID = ARC.OBJ_ID\n                INNER JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_REGION RE\n                        ON RE.REGION_NM = ARMX.MX_VALUE AND RE.ACTIVE_STATUS = 'Y' AND\n                            ARMX.MATRIX_CAT LIKE 'REGN'\n    WHERE ACT.ACTIVE_STATUS = 'Y') REGION ON REGION.ACTIVITY_TXT = ACT.ACTIVITY_TXT\n--------------------------------------Added by PA 5/19/2025-------------------------------------------------------------\nleft join (SELECT prefill.*\nFROM (\n    SELECT DISTINCT\n        tran.activity,\n        tran.resource_cd,\n        dimemp.first_name,\n        dimemp.last_name,\n        dimemp.src_emp_id\n    FROM ${SNFLKDB}.${SNFLKSCH}.DIM_TRANS tran\n    LEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_EMPLOYEE dimemp\n        ON tran.resource_cd = dimemp.resource_cd\n    WHERE substr(tran.activity, 1, 1) = 'A'\n        AND dimemp.src_emp_id IS NOT NULL\n        AND dimemp.active_status = 'Y'\n) prefill\nLEFT JOIN (\n    SELECT\n        activity\n    FROM (\n        SELECT DISTINCT\n            tran.activity,\n            tran.resource_cd,\n            dimemp.first_name,\n            dimemp.last_name,\n            dimemp.src_emp_id\n        FROM ${SNFLKDB}.${SNFLKSCH}.DIM_TRANS tran\n        LEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_EMPLOYEE dimemp\n            ON tran.resource_cd = dimemp.resource_cd\n        WHERE substr(tran.activity, 1, 1) = 'A'\n            AND dimemp.src_emp_id IS NOT NULL\n            AND dimemp.active_status = 'Y'\n    )\n    GROUP BY activity\n    HAVING COUNT(1) > 1\n) dupes\n    ON prefill.activity = dupes.activity\nWHERE dupes.activity IS NULL) fill\n  on fill.activity = trans.activity\n--------------------------------------Added by PA 5/19/2025-------------------------------------------------------------\nWHERE TRANS.ACTIVE_STATUS = 'Y'\n  AND TRANS.ACCT_CAT_CD = '51RW'\nGROUP BY TRANS.ACCT_UNIT_TXT, REGION.MX_VALUE, TRANS.ACTIVITY, JO.JOB_ORD_TYP, INV.INVOICE_NUM, CUST.CUSTOMER,\n         CUST.SEARCH_NAME, ASGN.FILLED_BY_ID_NAME, ASGN.REPORTS_TO_ID_NM, ACT.SALES_REP_NM, TRANS.POSTING_DT,\n         TRANS.TRAN_DT, JO.JOB_CD_NM, TRANS.ACCT_CAT_CD, TRANS.ACCOUNT_NM, CWC.CDA_CODE, TRANS.JOB_CODE, PR.WORK_STATE,\n         PR.HOURS, WC.WAGE_CD_DESC_TXT, EMP.SRC_EMP_ID, EMP.FIRST_NAME, EMP.LAST_NAME\n--------------------------------------Added by PA 5/19/2025-------------------------------------------------------------\n\t\t, fill.src_emp_id, fill.first_name, fill.last_name\n--------------------------------------Added by PA 5/19/2025-------------------------------------------------------------\n         \"\"\")\n\ncursor.execute('''UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\nSET FPR.CLIENT_BRAND = CLIENT_BRAND.MX_VALUE\nFROM (\n\tSELECT DISTINCT MX_VALUE, ACT.ACTIVITY_TXT\n\tFROM ${SNFLKDB}.${SNFLKSCH}.DIM_ACTIVITY ACT\n\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.ARCUSTOMER ARC ON LTRIM(ARC.CUSTOMER) = ACT.LEVEL_DETAIL_02\n\tINNER JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.ARCSTMXVAL ARMX ON ARMX.OBJ_ID = ARC.OBJ_ID\n\t\tAND ARMX.MATRIX_CAT LIKE 'BRAND'\n\tWHERE ACT.ACTIVE_STATUS = 'Y'\n\t) CLIENT_BRAND\nWHERE FPR.ASSIGNMENT = CLIENT_BRAND.ACTIVITY_TXT''')\ncursor.execute('''UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\nSET FPR.TIMEENTRY_ID = TEEID.TIMEENTRY_ID\nFROM (\n\tSELECT INV.INVOICE_NUM, TRANS.NORM_POSTING_DT, MAX(TRANS.TIMEENTRY_ID) AS TIMEENTRY_ID\n\tFROM ${SNFLKDB}.${SNFLKSCH}.DIM_TRANS TRANS\n\tLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_INVOICE INV ON INV.SRC_OBJ_ID = TRANS.SRC_OBJ_ID\n\tWHERE INV.ACTIVE_STATUS = 'Y'\n\t\tAND TRANS.ACTIVE_STATUS = 'Y'\n\tGROUP BY INV.INVOICE_NUM, TRANS.NORM_POSTING_DT\n\t) TEEID\nWHERE FPR.INVOICE = TEEID.INVOICE_NUM\n\tAND FPR.NORM_POSTING_DATE = TEEID.NORM_POSTING_DT''')\ncursor.execute('''UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\nSET FPR.WORK_COMP = COALESCE(WC.FINAL_WORK_COMP, 0.0), FPR.WC_BY_100 = WC.WC_BY_100\nFROM (\n\tSELECT DISTINCT BRANCH, ASSIGNMENT, NORM_POSTING_DATE, TRAN_DATE, WAGE_CODE, CASE WHEN TOTAL_WC_YES_PAY_HRS <> 0 THEN (WC_YES_PAY_HRS / TOTAL_WC_YES_PAY_HRS) * TOTAL_WORK_COMP ELSE 0 END AS FINAL_WORK_COMP, CASE WHEN TOTAL_WC_YES_PAY_HRS <> 0\n\t\t\t\tAND PAY_AMT <> 0 THEN CAST((((WC_YES_PAY_HRS / TOTAL_WC_YES_PAY_HRS) * TOTAL_WORK_COMP) / PAY_AMT) * 100 AS NUMBER(18, 4)) ELSE 0.0 END AS WC_BY_100\n\tFROM (\n\t\tSELECT DISTINCT BRANCH, ASSIGNMENT, NORM_POSTING_DATE, TRAN_DATE, WAGE_CODE, WC_YES_PAY_HRS, PAY_AMT, SUM(WC_YES_PAY_HRS) OVER (\n\t\t\t\tPARTITION BY BRANCH, ASSIGNMENT, NORM_POSTING_DATE, TRAN_DATE ORDER BY BRANCH, ASSIGNMENT, NORM_POSTING_DATE, TRAN_DATE\n\t\t\t\t) AS TOTAL_WC_YES_PAY_HRS, TOTAL_WORK_COMP\n\t\tFROM (\n\t\t\tSELECT DISTINCT BRANCH, ASSIGNMENT, NORM_POSTING_DATE, TRAN_DATE, WAGE_CODE, PAY_HRS AS WC_YES_PAY_HRS, PAY_AMT, PTM.WORK_COMP AS TOTAL_WORK_COMP\n\t\t\tFROM ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\n\t\t\tLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.PAY_TRAN_MEASURES_TEMP PTM ON PTM.ACTIVITY = FPR.ASSIGNMENT\n\t\t\t\tAND PTM.ACCT_UNIT_TXT = FPR.BRANCH\n\t\t\t\tAND PTM.NORM_POSTING_DT = FPR.NORM_POSTING_DATE\n\t\t\t\tAND PTM.NORM_TRAN_DT = FPR.TRAN_DATE\n\t\t\tWHERE FPR.WAGE_CODE IN (\n\t\t\t\t\tSELECT PAY_CODE\n\t\t\t\t\tFROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PRPAYCODE CD\n\t\t\t\t\tJOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PSGRELATE WCL ON CD.COMPANY = WCL.COMPANY\n\t\t\t\t\t\tAND CD.PAY_SUM_GRP = WCL.PAY_SUM_GRP\n\t\t\t\t\t\tAND WCL.PAY_CLASS = 'WC'\n\t\t\t\t\t)\n\t\t\t)\n\t\t)\n\t) WC\nWHERE FPR.BRANCH = WC.BRANCH\n\tAND FPR.ASSIGNMENT = WC.ASSIGNMENT\n\tAND FPR.NORM_POSTING_DATE = WC.NORM_POSTING_DATE\n\tAND FPR.TRAN_DATE = WC.TRAN_DATE\n\tAND FPR.WAGE_CODE = WC.WAGE_CODE''')\ncursor.execute('''UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\nSET WORK_COMP = 0, WC_BY_100 = 0.0\nWHERE WAGE_CODE NOT IN (\n\t\tSELECT PAY_CODE\n\t\tFROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PRPAYCODE CD\n\t\tJOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PSGRELATE WCL ON CD.COMPANY = WCL.COMPANY\n\t\t\tAND CD.PAY_SUM_GRP = WCL.PAY_SUM_GRP\n\t\t\tAND WCL.PAY_CLASS = 'WC'\n\t\tORDER BY PAY_CODE\n\t\t)''')\ncursor.execute('''UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\nSET FPR.FINALIZED_BY_NAME = DTLS.FINALIZED_BY_NAME, FPR.SUPERVISOR = DTLS.SUPERVISOR, FPR.BRAND_DESCRIPTION = DTLS.BRAND_DESCRIPTION, FPR.PARENT_CLIENT_NUMBER = DTLS.ACCOUNTNUMBER, FPR.ACCOUNT_TYPE = DTLS.ACCOUNT_TYPE, FPR.CONVERTED_BILL_HOURS_WORKED = DTLS.CONVERTED_BILL_HOURS_WORKED, FPR.TOTAL_COST_OF_SALES = DTLS.TOTAL_COST_OF_SALES\nFROM (\n\tSELECT FPR.EMPL_ID, CUS.CUSTOMER, FPR.ASSIGNMENT, FPR.NORM_POSTING_DATE, FPR.TRAN_DATE, EMP.FULLNAME AS FINALIZED_BY_NAME, AST.FULLNAME AS SUPERVISOR, BRD.BRAND_DESC AS BRAND_DESCRIPTION, CUS.ACCOUNTNUMBER, CUS.ACCOUNT_TYPE, FPR.WAGE_CODE, CBC.CONV_WCODE, FPR.BILL_HRS, FPR.BILL_AMT, CASE WHEN (\n\t\t\t\t\tCBC.CONV_WCODE IS NULL\n\t\t\t\t\tOR CBC.CONV_WCODE = ''\n\t\t\t\t\t) THEN 0.0 WHEN UPPER(CBC.CONVERSION_FACTOR) = 'NONE' THEN to_number(FPR.BILL_HRS, 15, 2) WHEN REPLACE(UPPER(CBC.CONVERSION_FACTOR), ' ', '') = REPLACE('BILLABLE_UNIT / 55', ' ', '') THEN to_number(FPR.BILL_HRS / 55, 15, 2) WHEN REPLACE(UPPER(CBC.CONVERSION_FACTOR), ' ', '') = REPLACE('BILLABLE_AMT / 25', ' ', '') THEN to_number(FPR.BILL_AMT / 25, 15, 2) WHEN REPLACE(UPPER(CBC.CONVERSION_FACTOR), ' ', '') = REPLACE('BILLABLE_UNIT * 8', ' ', '') THEN to_number(FPR.BILL_HRS * 8, 15, 2) END AS CONVERTED_BILL_HOURS_WORKED, FPR.PAY_AMT + FPR.FICA + FPR.FUTA + FPR.SUI + FPR.WORK_COMP + FPR.GLI_EPLI + FPR.ACA + FPR.OTHER AS TOTAL_COST_OF_SALES\n\tFROM ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\n\tLEFT JOIN (\n\t\tSELECT EMP.SRC_EMP_ID, SB.FULLNAME\n\t\tFROM ${SNFLKDB}.${SNFLKSCH}.DIM_EMPLOYEE EMP\n\t\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.SYSTEMUSERBASE SB ON EMP.FINALIZEDBY = SB.SYSTEMUSERID\n\t\tWHERE EMP.ACTIVE_STATUS = 'Y'\n\t\t) EMP ON FPR.EMPL_ID = EMP.SRC_EMP_ID\n\tLEFT JOIN (\n\t\tSELECT AST.ASSIGN_NUM, SB.FULLNAME\n\t\tFROM ${SNFLKDB}.${SNFLKSCH}.DIM_ASSIGNMENT AST\n\t\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.SYSTEMUSERBASE SB ON AST.CDA_STAFFINGSUPERVISORID = SB.SYSTEMUSERID\n\t\tWHERE AST.ACTIVE_STATUS = 'Y'\n\t\t) AST ON AST.ASSIGN_NUM = REGEXP_REPLACE(FPR.ASSIGNMENT, '^[A-Z]', '')\n\tLEFT JOIN (\n\t\tSELECT DISTINCT TRANS.ACTIVITY, TRANS.NORM_POSTING_DT, BRAND.BRAND_VAL_DESC_TXT AS BRAND_DESC\n\t\tFROM ${SNFLKDB}.${SNFLKSCH}.DIM_TRANS TRANS\n\t\tLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_ACTIVITY ACT ON ACT.ACTIVITY_TXT = TRANS.ACTIVITY\n\t\tLEFT JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_BRAND BRAND ON BRAND.ACTIVITY_TXT = ACT.ACTIVITY_TXT\n\t\tWHERE (\n\t\t\t\tBRAND.VALID_TO_DT >= IFF(DATEADD('DAY', 7, TRANS.NORM_POSTING_DT) < '2019-06-30', '2019-06-30', DATEADD('DAY', 7, TRANS.NORM_POSTING_DT))\n\t\t\t\tOR BRAND.VALID_TO_DT IS NULL\n\t\t\t\t)\n\t\t\tAND (\n\t\t\t\tBRAND.VALID_FRM_DT < IFF(DATEADD('DAY', 7, TRANS.NORM_POSTING_DT) < '2019-06-30', '2019-06-30', DATEADD('DAY', 7, TRANS.NORM_POSTING_DT))\n\t\t\t\tOR BRAND.VALID_FRM_DT IS NULL\n\t\t\t\t)\n\t\t\tAND TRANS.ACTIVE_STATUS = 'Y'\n\t\t\tAND ACT.ACTIVE_STATUS = 'Y'\n\t\t) BRD ON BRD.ACTIVITY = FPR.ASSIGNMENT\n\t\tAND BRD.NORM_POSTING_DT = FPR.NORM_POSTING_DATE\n\tLEFT JOIN (\n\t\tSELECT CUS.CUSTOMER, AB.ACCOUNTNUMBER, CM.ACCOUNT_TYPE\n\t\tFROM ${SNFLKDB}.${SNFLKSCH}.DIM_CUSTOMER CUS\n\t\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.ACCOUNTBASE AB ON AB.ACCOUNTID = CUS.PARENTCLIENTNUMBER\n\t\tLEFT JOIN ${NPG_ENV_DB}.${NPG_ENV_SCH}.NPG_VIP_DL_LDG_CLIENT_MASTER CM ON CM.CUSTOMER_ID = CUS.CUSTOMER\n\t\tWHERE CUS.ACTIVE_STATUS = 'Y'\n\t\t) CUS ON CUS.CUSTOMER = FPR.CUST_ID\n\tLEFT JOIN (\n\t\tSELECT DISTINCT ACCOUNT_CATEGORY, REPLACE(ACCOUNT_CATEGORY, '0', '') CONV_WCODE, DESCRIPTION, CONVERSION_FACTOR\n\t\tFROM ${SNFLKDB}.${SNFLKSCH}.LAWSON_DL_LDG_CONV_BILLED_CODES\n\t\t) CBC ON CBC.CONV_WCODE = FPR.WAGE_CODE\n\t) DTLS\nWHERE FPR.EMPL_ID IS NOT DISTINCT\nFROM DTLS.EMPL_ID\n\tAND FPR.ASSIGNMENT IS NOT DISTINCT\nFROM DTLS.ASSIGNMENT\n\tAND FPR.NORM_POSTING_DATE = DTLS.NORM_POSTING_DATE\n\tAND FPR.TRAN_DATE = DTLS.TRAN_DATE\n\tAND FPR.WAGE_CODE IS NOT DISTINCT\nFROM DTLS.WAGE_CODE\n\tAND FPR.BILL_HRS IS NOT DISTINCT\nFROM DTLS.BILL_HRS\n\tAND FPR.BILL_AMT IS NOT DISTINCT\nFROM DTLS.BILL_AMT''')\n\ncursor.execute(\"UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR SET FPR.WAGE_CODE = CASE WHEN FPR.WAGE_CODE LIKE '8%' THEN CONCAT(REPLACE(LEFT(FPR.WAGE_CODE, 1), '8', '9'), RIGHT(RTRIM(FPR.WAGE_CODE), LENGTH(RTRIM(FPR.WAGE_CODE))-1)) ELSE FPR.WAGE_CODE END, FPR.WORK_STATE = CASE WHEN FPR.WORK_STATE = '' THEN NULL ELSE FPR.WORK_STATE END\")\ncursor.execute('''UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\nSET FPR.EMPL_ID = TO_VARCHAR(COALESCE(EMP.SRC_EMP_ID, CASE WHEN FPR.EMPL_ID = '' THEN NULL ELSE FPR.EMPL_ID END, NULL)), \nFPR.LAST = COALESCE(EMP.LAST, FPR.LAST, NULL), \nFPR.FIRST = COALESCE(EMP.FIRST, FPR.FIRST, NULL), \nFPR.WC_CODE = COALESCE(EMP.CDA_CODE, EMP.JOB_CODE)\nfrom (\n    select distinct\n        asgn.activity,\n        EMP.SRC_EMP_ID, \n        LPEMP.NICK_NAME AS LAST, \n        LPEMP.NICK_NAME AS FIRST, \n        PR.WORK_STATE, \n        PRP.PAY_CODE, \n        CWC.CDA_CODE CDA_CODE, \n        PR.JOB_CODE JOB_CODE\n\tFROM (\n\t\tselect distinct\n            activity,\n            resource_cd\n        from ${SNFLKDB}.${SNFLKSCH}.dim_trans\n        where substr(activity, 1, 1) = 'A'\n\t\t) ASGN\n\tINNER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_ASSIGNMENTBASE LASGN \n        ON substr(ASGN.activity, 2) = LASGN.CDA_ASSIGNMENTNUMBER\n\tINNER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_EMPLOYEEBASE CEB ON LASGN.CDA_EMPLOYEEID = CEB.CDA_EMPLOYEEID\n\tINNER JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_EMPLOYEE EMP \n        ON EMP.resource_cd = asgn.resource_cd\n\t\tAND EMP.ACTIVE_STATUS = 'Y'\n\tINNER JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.EMPLOYEE LPEMP ON LPEMP.EMPLOYEE = CEB.CDA_EMPLOYEENUMBER\n\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PRTIME PRT ON PRT.COMPANY = LPEMP.COMPANY\n\t\tAND PRT.EMPLOYEE = LPEMP.EMPLOYEE\n\t\tAND PRT.PROCESS_LEVEL = LPEMP.PROCESS_LEVEL\n\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PRPAYCODE PRP ON PRP.SEQ_NBR = PRT.PCD_SEQ_NBR\n\tLEFT JOIN (\n\t\tSELECT DISTINCT EMPLOYEE, WORK_STATE, JOB_CODE\n\t\tFROM ${SNFLKDB}.${SNFLKSCH}.DIM_PAYRATE_TRANS PR\n\t\tWHERE PR.ACTIVE_STATUS = 'Y'\n\t\t) PR ON PR.EMPLOYEE = LPEMP.EMPLOYEE\n\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_WCCODEBASE CWC ON LASGN.CDA_WCCODE = CWC.CDA_WCCODEID\n\tWHERE PRP.PAY_CODE LIKE '99%'\n\t) EMP\nWHERE FPR.ASSIGNMENT = EMP.activity''')\n\ncursor.execute('''UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\nSET FPR.EMPL_ID = TO_VARCHAR(COALESCE(CASE WHEN FPR.EMPL_ID = '' THEN NULL ELSE FPR.EMPL_ID END, EMP.SRC_EMP_ID, NULL)), \n    FPR.LAST = COALESCE(FPR.LAST, EMP.LAST, NULL), \n    FPR.FIRST = COALESCE(FPR.FIRST, EMP.FIRST, NULL), \n    FPR.WC_CODE = COALESCE(FPR.WC_CODE, EMP.CDA_CODE, EMP.JOB_CODE)\nFROM (\n\tSELECT DISTINCT\n  asgn.activity,\n  EMP.SRC_EMP_ID, \n  EMP.LAST_NAME AS LAST, \n  EMP.FIRST_NAME AS FIRST, \n  PR.WORK_STATE, \n  PRP.PAY_CODE, \n  CWC.CDA_CODE CDA_CODE, \n  PR.JOB_CODE JOB_CODE\n\tFROM (\n\t\tselect distinct\n            activity,\n            resource_cd\n        from ${SNFLKDB}.${SNFLKSCH}.dim_trans\n        where substr(activity, 1, 1) = 'A'\n\t\t) ASGN\n\tINNER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_ASSIGNMENTBASE LASGN \n\t\tON substr(ASGN.activity, 2) = LASGN.CDA_ASSIGNMENTNUMBER\n\tINNER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_EMPLOYEEBASE CEB ON LASGN.CDA_EMPLOYEEID = CEB.CDA_EMPLOYEEID\n\tINNER JOIN ${SNFLKDB}.${SNFLKSCH}.DIM_EMPLOYEE EMP ON EMP.SRC_EMP_ID = CEB.CDA_EMPLOYEENUMBER\n\t\tAND EMP.ACTIVE_STATUS = 'Y'\n\tINNER JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.EMPLOYEE LPEMP ON LPEMP.EMPLOYEE = CEB.CDA_EMPLOYEENUMBER\n\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PRTIME PRT ON PRT.COMPANY = LPEMP.COMPANY\n\t\tAND PRT.EMPLOYEE = LPEMP.EMPLOYEE\n\t\tAND PRT.PROCESS_LEVEL = LPEMP.PROCESS_LEVEL\n\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PRPAYCODE PRP ON PRP.SEQ_NBR = PRT.PCD_SEQ_NBR\n\tLEFT JOIN (\n\t\tSELECT DISTINCT EMPLOYEE, WORK_STATE, JOB_CODE\n\t\tFROM ${SNFLKDB}.${SNFLKSCH}.DIM_PAYRATE_TRANS PR\n\t\tWHERE PR.ACTIVE_STATUS = 'Y'\n\t\t) PR ON PR.EMPLOYEE = LPEMP.EMPLOYEE\n\tLEFT JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_WCCODEBASE CWC ON LASGN.CDA_WCCODE = CWC.CDA_WCCODEID\n\tWHERE PRP.PAY_CODE NOT LIKE '99%'\n\t) EMP\nWHERE FPR.ASSIGNMENT = EMP.activity''')\n\ncursor.execute(\"UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR SET FPR.TOTAL_COST_OF_SALES = FPR.PAY_AMT + FPR.FICA + FPR.FUTA + FPR.SUI + FPR.WORK_COMP + FPR.GLI_EPLI + FPR.ACA + FPR.OTHER\")\n\n# Update work_state\ncursor.execute('''UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\nSET FPR.WORK_STATE = SRC.WORK_STATE\nFROM (\n\tSELECT ACTIVITY, WORK_STATE, CNT\n\tFROM (\n\t\tSELECT DISTINCT ACTIVITY, WORK_STATE, COUNT(DISTINCT WORK_STATE) OVER (PARTITION BY ACTIVITY) AS CNT\n\t\tFROM ${SFDBPROD_DATALAKE}.${SFSCHLAWPROD}.PRTIME\n\t\t)\n\tWHERE CNT = 1\n\t) SRC\nWHERE SRC.ACTIVITY = FPR.ASSIGNMENT\n\tAND FPR.WORK_STATE IS NULL''')\ncursor.execute('''UPDATE ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR FPR\nSET FPR.WORK_STATE = SRC.WORK_STATE\nFROM (\n\tSELECT DISTINCT ASGN.CDA_ASSIGNMENTNUMBER, SMB.VALUE AS WORK_STATE\n\tFROM ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_ASSIGNMENTBASE ASGN\n\tINNER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_JOBORDERBASE JBODR ON ASGN.CDA_JOBORDER = JBODR.CDA_JOBORDERID\n\tINNER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.CDA_LOCATIONBASE LCTN ON LCTN.CDA_LOCATIONID = JBODR.CDA_WORKLOCATION\n\tINNER JOIN ${SFDBPROD_DATALAKE}.${SNFLKSCH_CRM}.STRINGMAPBASE SMB ON SMB.ATTRIBUTEVALUE = LCTN.CDA_ADDRESSSTATE\n\t\tAND OBJECTTYPECODE = '10023'\n\t\tAND ATTRIBUTENAME = 'cda_addressstate'\n\tWHERE CDA_ASSIGNMENTNUMBER IS NOT NULL\n\t) SRC\nWHERE SRC.CDA_ASSIGNMENTNUMBER = REPLACE(FPR.ASSIGNMENT, 'A', '')\n\tAND FPR.WORK_STATE IS NULL''')\n\ncursor.execute('select count(*) from ${SNFLKDB}.${SNFLKSCH}.REPORT_FPR')\nresult = cursor.fetchone()\ncontext.updateVariable(\"audit_rowcount\", int(result[0]))\nrowcount = result[0]\nprint(rowcount)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"6332652":{"id":6332652,"sourceID":6332651,"targetID":6332606}},"failureConnectors":{"6332654":{"id":6332654,"sourceID":6332651,"targetID":6332605}},"unconditionalConnectors":{"6332653":{"id":6332653,"sourceID":6332607,"targetID":6332651}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"jb_REPORT_FPR","description":"","type":"ORCHESTRATION","tag":"e71af433-0a4f-4855-8b84-cd98e037a561"}}