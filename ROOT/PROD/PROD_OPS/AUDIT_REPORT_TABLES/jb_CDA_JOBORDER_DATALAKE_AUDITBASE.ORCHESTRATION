{"job":{"components":{"6335764":{"id":6335764,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-544,"y":-80,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6335775],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6335765":{"id":6335765,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-240,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6335771],"outputSuccessConnectorIDs":[6335774],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Transpose Records"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\ncursor = context.cursor()\ncursor.execute(\"DELETE FROM ${SNFLKDB}.${SNFLKSCH}.CDA_JOBORDER_AUDITBASE_TEMP1\")\ncursor.execute(\"INSERT INTO ${SNFLKDB}.${SNFLKSCH}.CDA_JOBORDER_AUDITBASE_TEMP1 ( ATTRIBUTEMASK_DR, CHANGEDATA_DR, ATTRIBUTEMASK, TRANSACTIONID, ACTION, OBJECTID, OBJECTIDNAME, USERID, CHANGEDATA, CREATEDON, OPERATION, AUDITID, CALLINGUSERID, OBJECTTYPECODE ) SELECT DISTINCT ATTRIBUTEMASK_DR, CHANGEDATA_DR, ATTRIBUTEMASK, TRANSACTIONID, ACTION, OBJECTID, OBJECTIDNAME, USERID, CHANGEDATA, CREATEDON, OPERATION, AUDITID, CALLINGUSERID, OBJECTTYPECODE FROM ( SELECT X.ATTRIBUTEMASK1 AS ATTRIBUTEMASK_DR, Y.CHANGEDATA1 AS CHANGEDATA_DR, X.ATTRIBUTEMASK, X.TRANSACTIONID, X.ACTION, X.OBJECTID, X.OBJECTIDNAME, X.USERID, X.CHANGEDATA, X.CREATEDON, X.OPERATION, X.AUDITID, X.CALLINGUSERID, X.OBJECTTYPECODE FROM ( SELECT B.VALUE AS ATTRIBUTEMASK1, B.INDEX, A.* FROM ${SNFLKDB}.${SNFLKSCH}.CRM_DL_LDG_AUDITBASE A, LATERAL SPLIT_TO_TABLE( SUBSTR( ATTRIBUTEMASK, 2, LENGTH(ATTRIBUTEMASK)-2 ), ',' ) B WHERE A.OBJECTTYPECODE = '10019' AND A.DL_CREATED_DATE > ( SELECT MAX(VALID_FRM_DT) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE WHERE OBJECTTYPECODE = '10019' ) AND A.CREATEDON > ( SELECT MAX(CREATEDON) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE WHERE OBJECTTYPECODE = '10019' ) AND A.ATTRIBUTEMASK <> '' ) X LEFT JOIN ( SELECT B.VALUE AS CHANGEDATA1, B.INDEX, A.* FROM ${SNFLKDB}.${SNFLKSCH}.CRM_DL_LDG_AUDITBASE A, LATERAL SPLIT_TO_TABLE(A.CHANGEDATA, '~') B WHERE A.OBJECTTYPECODE = '10019' AND A.DL_CREATED_DATE > ( SELECT MAX(VALID_FRM_DT) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE WHERE OBJECTTYPECODE = '10019' ) AND A.CREATEDON > ( SELECT MAX(CREATEDON) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE WHERE OBJECTTYPECODE = '10019' ) ) Y ON X.INDEX = Y.INDEX AND X.OBJECTID = Y.OBJECTID AND X.TRANSACTIONID = Y.TRANSACTIONID UNION ALL SELECT COALESCE(X.ATTRIBUTEMASK1, '') AS ATTRIBUTEMASK_DR, Y.CHANGEDATA1 AS CHANGEDATA_DR, Y.ATTRIBUTEMASK, Y.TRANSACTIONID, Y.ACTION, Y.OBJECTID, Y.OBJECTIDNAME, Y.USERID, Y.CHANGEDATA, Y.CREATEDON, Y.OPERATION, Y.AUDITID, Y.CALLINGUSERID, Y.OBJECTTYPECODE FROM ( SELECT B.VALUE AS ATTRIBUTEMASK1, B.INDEX, A.* FROM ${SNFLKDB}.${SNFLKSCH}.CRM_DL_LDG_AUDITBASE A, LATERAL SPLIT_TO_TABLE( SUBSTR( ATTRIBUTEMASK, 2, LENGTH(ATTRIBUTEMASK)-2 ), ',' ) B WHERE A.OBJECTTYPECODE = '10019' AND A.DL_CREATED_DATE > ( SELECT MAX(VALID_FRM_DT) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE WHERE OBJECTTYPECODE = '10019' ) AND A.CREATEDON > ( SELECT MAX(CREATEDON) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE WHERE OBJECTTYPECODE = '10019' ) ) X RIGHT JOIN ( SELECT B.VALUE AS CHANGEDATA1, B.INDEX, A.* FROM ${SNFLKDB}.${SNFLKSCH}.CRM_DL_LDG_AUDITBASE A, LATERAL SPLIT_TO_TABLE(A.CHANGEDATA, '~') B WHERE A.OBJECTTYPECODE = '10019' AND A.DL_CREATED_DATE> ( SELECT MAX(VALID_FRM_DT) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE WHERE OBJECTTYPECODE = '10019' ) AND A.CREATEDON > ( SELECT MAX(CREATEDON) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE WHERE OBJECTTYPECODE = '10019' ) AND A.CHANGEDATA <> '' ) Y ON X.INDEX = Y.INDEX AND X.OBJECTID = Y.OBJECTID AND X.TRANSACTIONID = Y.TRANSACTIONID )\" )\ncursor.execute(\"DELETE FROM ${SNFLKDB}.${SNFLKSCH}.CDA_JOBORDER_AUDITBASE_TEMP2\")\ncursor.execute(\"INSERT INTO ${SNFLKDB}.${SNFLKSCH}.CDA_JOBORDER_AUDITBASE_TEMP2 ( OLDVALUEID, OLDVALUE, NEWVALUEID, NEWVALUE, ATTRIBUTEMASK_DR, CHANGEDATA_DR, ATTRIBUTEMASK, TRANSACTIONID, ACTION, OBJECTID, OBJECTIDNAME, USERID, CHANGEDATA, CREATEDON, OPERATION, AUDITID, CALLINGUSERID, OBJECTTYPECODE ) SELECT * FROM ( SELECT CHANGEDATA_DR AS OLDVALUEID, NULL AS OLDVALUE, CASE WHEN COALESCE(ATTRIBUTEMASK_DR,'')='' THEN NULL ELSE LEAD(CHANGEDATA_DR) OVER(PARTITION BY ATTRIBUTEMASK_DR,OBJECTID,OBJECTTYPECODE ORDER BY CREATEDON,AUDITID) END AS NEWVALUEID, NULL AS NEWVALUE, ATTRIBUTEMASK_DR, CHANGEDATA_DR, ATTRIBUTEMASK, TRANSACTIONID, ACTION, OBJECTID, OBJECTIDNAME, USERID, CHANGEDATA, CREATEDON, OPERATION, AUDITID, CALLINGUSERID, OBJECTTYPECODE FROM ( SELECT DISTINCT X.ATTRIBUTEMASK_DR, X.CHANGEDATA_DR, X.ATTRIBUTEMASK, X.TRANSACTIONID, X.ACTION, X.OBJECTID, X.OBJECTIDNAME, X.USERID, X.CHANGEDATA, X.CREATEDON, X.OPERATION, X.AUDITID, X.CALLINGUSERID, X.OBJECTTYPECODE FROM ${SNFLKDB}.${SNFLKSCH}.CDA_JOBORDER_AUDITBASE_TEMP1 X UNION select DISTINCT ATTRIBUTEMASK_DR, CHANGEDATA_DR, ATTRIBUTEMASK, TRANSACTIONID, ACTION, OBJECTID, OBJECTIDNAME, USERID, CHANGEDATA, CREATEDON, OPERATION, AUDITID, CALLINGUSERID, OBJECTTYPECODE from ( SELECT DISTINCT Y.ATTRIBUTEMASK AS ATTRIBUTEMASK_DR, Y.NEWVALUEID AS CHANGEDATA_DR, 'DEFAULTING' AS ATTRIBUTEMASK, Y.TRANSACTIONID, Y.ACTION, Y.OBJECTID, NULL AS OBJECTIDNAME, Y.USERID, NULL AS CHANGEDATA, Y.CREATEDON, Y.OPERATION, Y.AUDITID, Y.CALLINGUSERID, Y.OBJECTTYPECODE FROM ${SNFLKDB}.${SNFLKSCH}.CDA_JOBORDER_AUDITBASE_TEMP1 X JOIN ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE Y ON X.ATTRIBUTEMASK_DR = Y.ATTRIBUTEMASK AND X.OBJECTID = Y.OBJECTID AND Y.CREATEDON = ( SELECT MAX(CREATEDON) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE A WHERE A.ATTRIBUTEMASK = Y.ATTRIBUTEMASK AND A.OBJECTID = Y.OBJECTID AND Y.OBJECTTYPECODE = '10019' ) AND Y.OBJECTTYPECODE = '10019' ) Z Where Z.AUDITID = ( SELECT MAX(AUDITID) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE A WHERE A.ATTRIBUTEMASK = Z.ATTRIBUTEMASK_DR AND A.OBJECTID = Z.OBJECTID and A.CREATEDON = Z.CREATEDON AND A.OBJECTTYPECODE = '10019' ) ) )\")"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6335766":{"id":6335766,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":256,"y":-192,"width":32,"height":32,"inputConnectorIDs":[6335773],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_JOBORDER_DATALAKE_AUDITBASE_SUCCESS"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_JOBORDER_DATALAKE_AUDITBASE"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6335767":{"id":6335767,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":260,"y":11,"width":32,"height":32,"inputConnectorIDs":[6335840],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_JOBORDER_DATALAKE_AUDITBASE_FAILURE"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Audit_JOBORDER_DATALAKE_AUDITBASE"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6335768":{"id":6335768,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-96,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6335774],"outputSuccessConnectorIDs":[6335772],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Target Insert"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\ncursor = context.cursor()\ncursor.execute(\"INSERT INTO ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE ( OBJECTTYPECODE, ATTRIBUTEMASK, ATTRIBUTENAME, OLDVALUEID, OLDVALUENAME, NEWVALUEID, NEWVALUENAME, CREATEDON, OPERATION, ACTION, AUDITID, TRANSACTIONID, OBJECTID, USERID, CALLINGUSERID, VALID_FRM_DT, VALID_TO_DT, CREATED_DT, CREATED_BY, MODIFIED_DT, MODIFIED_BY ) SELECT AM1.OBJECTTYPECODE, AM1.ATTRIBUTEMASK_DR AS ATTRIBUTEMASK, AM.TABLECOLUMNNAME as ATTRIBUTENAME, AM1.OLDVALUEID, COALESCE(SM_OLD.VALUE, AM1.OLDVALUEID) AS OLDVALUENAME, AM1.NEWVALUEID, COALESCE(SM_NEW.VALUE, AM1.NEWVALUEID) AS NEWVALUENAME, AM1.CREATEDON, AM1.OPERATION, AM1.ACTION, AM1.AUDITID, AM1.TRANSACTIONID, AM1.OBJECTID, AM1.USERID, AM1.CALLINGUSERID, TO_TIMESTAMP_NTZ( CURRENT_TIMESTAMP(0) ) AS VALID_FRM_DT, TO_TIMESTAMP_NTZ('9999-12-31') AS VALID_TO_DT, TO_TIMESTAMP_NTZ( CURRENT_TIMESTAMP(0) ) AS CREATED_DT, CURRENT_USER AS CREATED_BY, TO_TIMESTAMP_NTZ( CURRENT_TIMESTAMP(0) ) AS MODIFIED_DT, CURRENT_USER AS MODIFIED_BY FROM ${SNFLKDB}.${SNFLKSCH}.CDA_JOBORDER_AUDITBASE_TEMP2 AM1 LEFT JOIN ${SNFLKDB}.${SNFLKSCH}.ATTRIBUTEMASKMAPPING AM on AM1.ATTRIBUTEMASK_DR = AM.ATTRIBUTEMASK and AM1.OBJECTTYPECODE = AM.OBJECTTYPECODE LEFT JOIN ${SNFLKDB}.${SNFLKSCH}.CRM_DL_LDG_STRINGMAPBASE SM_NEW ON SM_NEW.OBJECTTYPECODE = AM1.OBJECTTYPECODE AND SM_NEW.OBJECTTYPECODE = AM.OBJECTTYPECODE AND SM_NEW.ATTRIBUTENAME = AM.LOGICALNAME AND CAST(SM_NEW.ATTRIBUTEVALUE AS VARCHAR)=( case when AM1.NEWVALUEID = 'False' then '0' when AM1.NEWVALUEID = 'True' then '1' else CAST(AM1.NEWVALUEID AS VARCHAR) end ) LEFT JOIN ${SNFLKDB}.${SNFLKSCH}.CRM_DL_LDG_STRINGMAPBASE SM_OLD ON SM_OLD.OBJECTTYPECODE = AM1.OBJECTTYPECODE AND SM_OLD.OBJECTTYPECODE = AM.OBJECTTYPECODE AND SM_OLD.ATTRIBUTENAME = AM.LOGICALNAME AND CAST (SM_OLD.ATTRIBUTEVALUE AS VARCHAR)=( case when AM1.OLDVALUEID = 'False' then '0' when AM1.OLDVALUEID = 'True' then '1' else CAST(AM1.OLDVALUEID AS VARCHAR) end ) WHERE AM1.OBJECTTYPECODE = '10019' AND AM1.ATTRIBUTEMASK <> 'DEFAULTING'\")\nresult = cursor.fetchone()\ncontext.updateVariable(\"audit_rowcount\", int(result[0]))\ncursor.execute(\"UPDATE ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE T SET NEWVALUEID = S.NEWVALUEID, NEWVALUENAME = S.NEWVALUENAME, MODIFIED_DT = TO_TIMESTAMP_NTZ( CURRENT_TIMESTAMP(0) ) FROM ( SELECT AM1.OBJECTTYPECODE, AM1.ATTRIBUTEMASK_DR AS ATTRIBUTEMASK, AM.TABLECOLUMNNAME AS ATTRIBUTENAME, AM1.NEWVALUEID, COALESCE(SM_NEW.VALUE, AM1.NEWVALUEID) AS NEWVALUENAME, AM1.CREATEDON, AM1.OPERATION, AM1.ACTION, AM1.AUDITID, AM1.TRANSACTIONID, AM1.OBJECTID, AM1.USERID, AM1.CALLINGUSERID FROM ${SNFLKDB}.${SNFLKSCH}.CDA_JOBORDER_AUDITBASE_TEMP2 AM1 LEFT JOIN ${SNFLKDB}.${SNFLKSCH}.ATTRIBUTEMASKMAPPING AM ON AM1.ATTRIBUTEMASK_DR = AM.ATTRIBUTEMASK AND AM1.OBJECTTYPECODE = AM.OBJECTTYPECODE LEFT JOIN ${SNFLKDB}.${SNFLKSCH}.CRM_DL_LDG_STRINGMAPBASE SM_NEW ON SM_NEW.OBJECTTYPECODE = AM1.OBJECTTYPECODE AND SM_NEW.OBJECTTYPECODE = AM.OBJECTTYPECODE AND SM_NEW.ATTRIBUTENAME = AM.LOGICALNAME AND CAST(SM_NEW.ATTRIBUTEVALUE AS VARCHAR)=( case when AM1.NEWVALUEID = 'False' then '0' when AM1.NEWVALUEID = 'True' then '1' else CAST(AM1.NEWVALUEID AS VARCHAR) end ) WHERE AM1.OBJECTTYPECODE = '10019' AND AM1.ATTRIBUTEMASK = 'DEFAULTING' ) S WHERE T.AUDITID = S.AUDITID AND T.ATTRIBUTEMASK = S.ATTRIBUTEMASK AND T.OBJECTID = S.OBJECTID AND T.CREATEDON = S.CREATEDON AND T.OBJECTTYPECODE = S.OBJECTTYPECODE\")"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6335769":{"id":6335769,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":96,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6335772],"outputSuccessConnectorIDs":[6335773],"outputFailureConnectorIDs":[6335840],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Status","mapTo":"audit_status"},"2":{"slot":2,"fromId":null,"fromName":"Component","mapTo":"audit_component"},"3":{"slot":3,"fromId":null,"fromName":"Duration","mapTo":"audit_duration"},"4":{"slot":4,"fromId":null,"fromName":"Completed At","mapTo":"audit_completed"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CDA_JOBORDER_DATALAKE_AUDITBASE"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\ncursor = context.cursor()\ncursor.execute(\"INSERT INTO ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE ( OBJECTTYPECODE, ATTRIBUTEMASK, ATTRIBUTENAME, OLDVALUEID, OLDVALUENAME, NEWVALUEID, NEWVALUENAME, CREATEDON, OPERATION, ACTION, AUDITID, TRANSACTIONID, OBJECTID, USERID, CALLINGUSERID, VALID_FRM_DT, VALID_TO_DT, CREATED_DT, CREATED_BY, MODIFIED_DT, MODIFIED_BY ) SELECT AM1.OBJECTTYPECODE, AM1.ATTRIBUTEMASK AS ATTRIBUTEMASK, NULL AS ATTRIBUTENAME, NULL AS OLDVALUEID, NULL AS OLDVALUENAME, AM1.CHANGEDATA AS NEWVALUEID, COALESCE(NULL, AM1.CHANGEDATA) AS NEWVALUENAME, AM1.CREATEDON, AM1.OPERATION, AM1.ACTION, AM1.AUDITID, AM1.TRANSACTIONID, AM1.OBJECTID, AM1.USERID, AM1.CALLINGUSERID, TO_TIMESTAMP_NTZ( CURRENT_TIMESTAMP(0) ) AS VALID_FRM_DT, TO_TIMESTAMP_NTZ('9999-12-31') AS VALID_TO_DT, TO_TIMESTAMP_NTZ( CURRENT_TIMESTAMP(0) ) AS CREATED_DT, CURRENT_USER AS CREATED_BY, TO_TIMESTAMP_NTZ( CURRENT_TIMESTAMP(0) ) AS MODIFIED_DT, CURRENT_USER AS MODIFIED_BY FROM ${SNFLKDB}.${SNFLKSCH}.CRM_DL_LDG_AUDITBASE AM1 WHERE AM1.OBJECTTYPECODE = '10019' AND ( ATTRIBUTEMASK = '' AND CHANGEDATA = '' ) AND AM1.DL_CREATED_DATE > '${MXDATE_TGT_VALID_FRM_DT}' AND AM1.CREATEDON > '${MXDATE_TGT_CREATEDON}'\")\nresult = cursor.fetchone()\ncontext.updateVariable(\"audit_rowcount1\", int(result[0]))"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6335770":{"id":6335770,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-400,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6335775],"outputSuccessConnectorIDs":[6335771],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Started At","mapTo":"audit_started"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"FetchMaxValue"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\ncursor = context.cursor()\ncursor.execute(\" SELECT  MAX(VALID_FRM_DT) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE WHERE OBJECTTYPECODE = '10019' \")\nresult = cursor.fetchone()\ncontext.updateVariable(\"MXDATE_TGT_VALID_FRM_DT\", (result[0]))\n\ncursor.execute(\"SELECT MAX(CREATEDON) FROM ${SNFLKDB}.${SNFLKSCH}.DATALAKE_AUDITBASE WHERE OBJECTTYPECODE = '10019'\")\nresult = cursor.fetchone()\ncontext.updateVariable(\"MXDATE_TGT_CREATEDON\", (result[0]))\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"6335771":{"id":6335771,"sourceID":6335770,"targetID":6335765},"6335772":{"id":6335772,"sourceID":6335768,"targetID":6335769},"6335773":{"id":6335773,"sourceID":6335769,"targetID":6335766},"6335774":{"id":6335774,"sourceID":6335765,"targetID":6335768}},"failureConnectors":{"6335840":{"id":6335840,"sourceID":6335769,"targetID":6335767}},"unconditionalConnectors":{"6335775":{"id":6335775,"sourceID":6335764,"targetID":6335770}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"jb_CDA_JOBORDER_DATALAKE_AUDITBASE","description":"","type":"ORCHESTRATION","tag":"1387ce86-5ec2-4786-8223-32bb59c21aef"}}