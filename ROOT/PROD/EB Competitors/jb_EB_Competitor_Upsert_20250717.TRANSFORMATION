{"job":{"components":{"6340414":{"id":6340414,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":480,"y":80,"width":32,"height":32,"inputConnectorIDs":[6340453],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"EB_COMPETITORS"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"EB_COMPETITORS"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ACCOUNT_CLIENT_NAME"},"2":{"slot":2,"type":"STRING","value":"ACCT_CLIENT_NAME"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"ACCOUNT_NUMBER"},"2":{"slot":2,"type":"STRING","value":"ACCOUNT_NUMBER"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"ACCOUNT_TYPE"},"2":{"slot":2,"type":"STRING","value":"ACCOUNT_TYPE"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"BRANCH_NAME"},"2":{"slot":2,"type":"STRING","value":"BRANCH_NAME"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"DIVISION"},"2":{"slot":2,"type":"STRING","value":"DIVISION"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"REGION"},"2":{"slot":2,"type":"STRING","value":"REGION"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"MARKET_AREA"},"2":{"slot":2,"type":"STRING","value":"MARKET_AREA"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"CUSTOMER_CITY"},"2":{"slot":2,"type":"STRING","value":"CITY"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"EB_AOA_COUNT"},"2":{"slot":2,"type":"STRING","value":"EB_AOA_CT"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"COMPETITOR_NAME"},"2":{"slot":2,"type":"STRING","value":"COMPETITOR_NAME"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"COMPETITOR_AOA_COUNT"},"2":{"slot":2,"type":"STRING","value":"COMPETITOR_AOA_CT"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"CREATED_DATE"},"2":{"slot":2,"type":"STRING","value":"CREATED_DATE"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"CREATED_BY"},"2":{"slot":2,"type":"STRING","value":"CREATED_BY"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"DL_CREATED_DATE"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_DATE"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"DL_CREATED_BY"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_BY"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"DL_JOBID"},"2":{"slot":2,"type":"STRING","value":"DL_JOBID"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Sch_Sales}"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB_Enterprise}"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"204":{"slot":204,"name":"Order By","elements":{},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6340415":{"id":6340415,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":320,"y":80,"width":32,"height":32,"inputConnectorIDs":[6340452],"outputConnectorIDs":[6340453],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Add audit columns"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_TIMESTAMP"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_DATE"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_USER"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_BY"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"${run_history_id}"},"2":{"slot":2,"type":"STRING","value":"DL_JOBID"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6340451":{"id":6340451,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":160,"y":80,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[6340452],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"LDG_EB_COMPETITORS"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select b.customer_name as account_client_name\n    , a.account_number\n    , coalesce(d.account_type, 'Retail/SMB') as account_type\n    , c.branch_name as branch_name\n    , e.division_name as division\n    , e.region_name as region\n    , e.budget_area_name as market_area\n    , g.city as customer_city\n    , f.ct_aoa as eb_aoa_count\n    , a.competitor_name\n    , a.competitor_aoa_count\n    , a.created_date\n    , a.created_by --select count(*)\nfrom (\n  select to_number(regexp_replace(\"Account Number\", '[^0-9]', '')) as account_number\n    , \"Competitor Name\" as competitor_name\n    , \"Created\"::date as created_date\n    , \"AOA Count\" as competitor_aoa_count\n    , \"Created by\" as created_by\n  from ${DB_Enterprise}.${Sch_Sales}.ldg_eb_competitors\n     ) a\nleft join prod_edw.ent.customer_dim b on b.dw_active_flag = 'Y'\n    and b.dw_data_source_key = 1\n    and to_number(b.customer_number) = a.account_number\nleft join prod_edw.ent.branch_dim c on c.dw_active_flag = 'Y'\n    and c.dw_data_source_key = 1\n    and c.branch_id = b.branch_id\nleft join prod_npg_vip.ldg.npg_vip_dl_ldg_client_master d on a.account_number = d.customer_id\nleft join prod_edw.ent.accounting_unit_hierarchy_dim e on e.dw_active_flag = 'Y'\n    and e.account_unit_code = c.accounting_unit\nleft join prod_edw.ent.turnover_customer_fact f on f.roll_up_frequency = 'WEEKLY'\n    and f.customer_number = a.account_number\n    and f.sunday_date between dateadd('d', -14, a.created_date) and dateadd('d', -8, a.created_date)\nleft join prod_datalake.crm_mscrm.customeraddressbase g on g.parentid = b.customer_id\n    and g.addressnumber = 1\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"6340452":{"id":6340452,"sourceID":6340451,"targetID":6340415},"6340453":{"id":6340453,"sourceID":6340415,"targetID":6340414}},"notes":{},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"jb_EB_Competitor_Upsert_20250717","description":"","type":"TRANSFORMATION","tag":"0b87cc11-0f6a-462b-a116-0c050f39c323"}}