{"job":{"components":{"6336674":{"id":6336674,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-624,"y":-80,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6336677],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6336675":{"id":6336675,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-432,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6336677],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[6336678],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Status","mapTo":"audit_status"},"2":{"slot":2,"fromId":null,"fromName":"Component","mapTo":"audit_component"},"3":{"slot":3,"fromId":null,"fromName":"Started At","mapTo":"audit_started"},"4":{"slot":4,"fromId":null,"fromName":"Duration","mapTo":"audit_duration"},"5":{"slot":5,"fromId":null,"fromName":"Completed At","mapTo":"audit_completed"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"FACT_ASSIGNMENT_INVOICE"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"from datetime import datetime\nfrom pytz import timezone\n\n\njob_name = 'DW_FACT_ASSIGNMENT_INVOICE'\ncontext.updateVariable(\"Job_Name\",job_name)\n\nfmt = \"%Y-%m-%d %H:%M:%S\"\nCurrentTime = datetime.now(timezone(snowflake_timezone))\ncontext.updateVariable(\"Job_StartTimeStamp\",CurrentTime.strftime(fmt))\n\ncursor = context.cursor()\ncursor.execute(\"use warehouse ${SNFLKWH_FACT};\")\ncursor.execute(\"alter warehouse ${SNFLKWH_FACT} resume if suspended;\")\ncursor.execute(\"alter warehouse ${SNFLKWH_FACT} set warehouse_size='X-LARGE';\")\ncursor.execute(\"TRUNCATE TABLE ${SNFLDWHDB}.${SNFLDWHSCH}.FACT_ASSIGNMENT_INVOICE;\")\n\ncursor.execute(\"CREATE OR REPLACE TEMPORARY TABLE ${SNFLDWHDB}.${SNFLDWHSCH}.temp1 (ASSIGNMENTID VARCHAR(50),DEPT VARCHAR(300),JOB_TITLE VARCHAR(300),SUPERVISOR VARCHAR(300),AS_DEPT_USE VARCHAR(300),BADGE_NUMBER VARCHAR(300),DEPT_ORDERING VARCHAR(300),JOB_NUMBER VARCHAR(300),PO_NUMBER VARCHAR(300),SHIFT VARCHAR(300));\")\ncursor.execute(\"INSERT INTO ${SNFLDWHDB}.${SNFLDWHSCH}.temp1 WITH CTE AS( SELECT DISTINCT L.LABELVALUE, C.CUSTOMERFIELDVALUE, C.ASSIGNMENTID FROM ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_CUSTOMERFIELD C LEFT OUTER JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_LABEL L ON C.CUSTOMERFIELDNAME = L.ATTRIBUTEVALUE WHERE L.ATTRIBUTENAME = 'cda_customerfieldname' AND L.TABLENAME = 'cda_customerfieldvalue') SELECT * FROM CTE pivot(MAX(CUSTOMERFIELDVALUE) for LABELVALUE in ('Dept', 'Job_Title','Supervisor','AS_Dept_Use','Badge_#','Dept_Ordering','Job_#','PO_#','Shift')) as P (ASSIGNMENTID,DEPT,JOB_TITLE,SUPERVISOR,AS_DEPT_USE,BADGE_NUMBER,DEPT_ORDERING,JOB_NUMBER,PO_NUMBER,SHIFT);\")\ncursor.execute(\"MERGE INTO ${SNFLDWHDB}.${SNFLDWHSCH}.FACT_ASSIGNMENT_INVOICE MGE USING ( SELECT DISTINCT NVL(LDG.ASSIGNMENTID,FCT.ASSIGNMENTID) COMB_ID, LDG.ASSIGNMENTID,LDG.INVOICEOBJID,LDG.INVOICENUMBER,LDG.BRANDID,LDG.CUSTOMERID,LDG.CUSTOMERNUMBER,LDG.EMPLOYEEID,LDG.EMPLOYEENUMBER,LDG.PONUMBER,LDG.ACCTUNITID,LDG.BRANCH_NUMBER,LDG.INVOICEPROCESSLEVEL,LDG.SHIFTID,LDG.JOBTITLE,LDG.DEPARTMENTID,LDG.INVOICEDATE,LDG.BADGENUMBER,LDG.INVOICEPOSTINGDATE,LDG.APPROVERID,LDG.WORKSITELOCATIONID,LDG.WORKSITENAME,LDG.WORKSITEADDRESS1,LDG.WORKSITEADDRESS2,LDG.WORKSITECITY,LDG.WORKSITESTATE,LDG.WORKSITEZIP,LDG.BILLTOLOCATIONID,LDG.BILLTOLOCATIONNAME,LDG.BILLTOADDRESS1,LDG.BILLTOADDRESS2,LDG.BILLTOCITY,LDG.BILLTOSTATE,LDG.BILLTOZIP,LDG.DEPT,LDG.JOB_TITLE,LDG.SUPERVISOR,LDG.AS_DEPT_USE,LDG.BADGE_NUMBER,LDG.DEPT_ORDERING,LDG.JOB_NUMBER,LDG.PO_NUMBER,LDG.SHIFT,LDG.WAGECODEID,LDG.BILLRATE,LDG.BILLABLEAMOUNT,LDG.BILLABLEUNIT,LDG.SALESTAXAMOUNT,LDG.TAXABLEAMOUNT,LDG.HOURGROUPTYPE,LDG.ASSIGNMENTTYPE,LDG.JOBCODEID,LDG.CREDITSTATUS,LDG.BUDGETAREANAME,LDG.REGIONNAME,LDG.CRMPARENTCUSTOMERID,LDG.LAWSONPARENTCUSTOMERID,LDG.INVOICEFORMNAME,LDG.DUEDATE,LDG.WEEKENDINGDATE,LDG.TRANSACTIONDATE,LDG.DEFAULTPAYTYPE,LDG.DIM_ASSIGNMENT_DW_CREATED_DATE,LDG.DIM_ASSIGNMENT_DW_MODIFIED_DATE FROM ${SNFLDWHDB}.${SNFLDWHSCH}.FACT_ASSIGNMENT_INVOICE FCT FULL OUTER JOIN ( SELECT DISTINCT DIM_ASSIGNMENT.ASSIGNMENTID,DIM_INVOICE.INVOICEOBJID,DIM_INVOICE.INVOICENUMBER,DIM_BRAND.BRANDID,DIM_CUSTOMER.CUSTOMERID,DIM_CUSTOMER.CUSTOMERNUMBER,DIM_EMPLOYEE.EMPLOYEEID,DIM_EMPLOYEE.EMPLOYEENUMBER,DIM_ASSIGNMENT.PONUMBER,DIM_TRANSACTION.ACCTUNITID,DIM_BRANCH.BRANCH_NUMBER,DIM_INVOICE.INVOICEPROCESSLEVEL,DIM_ASSIGNMENT.SHIFTID,DIM_ASSIGNMENT.JOBTITLE,DIM_ASSIGNMENT.DEPARTMENTID,DIM_INVOICE.INVOICEDATE,DIM_ASSIGNMENT.BADGENUMBER,DIM_INVOICE.INVOICEPOSTINGDATE,DIM_ASSIGNMENT.APPROVERID,DIM_LOCATION.LOCATIONID AS WORKSITELOCATIONID,DIM_LOCATION.LOCATIONNAME AS WORKSITENAME,DIM_LOCATION.ADDRESS_LINE1 AS WORKSITEADDRESS1,DIM_LOCATION.ADDRESS_LINE2 AS WORKSITEADDRESS2,DIM_LOCATION.CITY AS WORKSITECITY,DIM_LOCATION.STATE_DW_LABELID AS WORKSITESTATE,DIM_LOCATION.ZIP AS WORKSITEZIP,DIM_JOBORDER.BILLTOLOCATIONID,DIM_LOCATION.LOCATIONNAME AS BILLTOLOCATIONNAME,DIM_LOCATION.ADDRESS_LINE1 AS BILLTOADDRESS1,DIM_LOCATION.ADDRESS_LINE2 AS BILLTOADDRESS2,DIM_LOCATION.CITY AS BILLTOCITY,DIM_LOCATION.STATE_DW_LABELID AS BILLTOSTATE,DIM_LOCATION.ZIP AS BILLTOZIP,temp1.DEPT,temp1.JOB_TITLE,temp1.SUPERVISOR,temp1.AS_DEPT_USE,temp1.BADGE_NUMBER,temp1.DEPT_ORDERING,temp1.JOB_NUMBER,temp1.PO_NUMBER,temp1.SHIFT,DIM_TRANSACTION.WAGECODEID,DIV0(DIM_TRANSACTION.BILLABLEAMOUNT, DIM_TRANSACTION.BILLABLEUNIT) AS BILLRATE,DIM_TRANSACTION.BILLABLEAMOUNT,DIM_TRANSACTION.BILLABLEUNIT,DIM_TRANSACTION.SALESTAXAMOUNT,DIM_TRANSACTION.TAXABLEAMOUNT,DIM_PAYBILLCODE.HOURGROUPTYPE,DIM_ASSIGNMENT.ASSIGNMENTTYPE,DIM_ASSIGNMENT.JOBCODEID,DIM_CUSTOMER.CREDITSTATUS,DIM_FINANCE_HIERARCHY.BUDGETAREANAME,DIM_FINANCE_HIERARCHY.REGIONNAME,DIM_CUSTOMER_HIERARCHY.CRMPARENTCUSTOMERID,DIM_CUSTOMER_HIERARCHY.LAWSONPARENTCUSTOMERID,DIM_CUSTOMER.INVOICEFORMNAME,DIM_INVOICE.DUEDATE,DIM_CUSTOMER.WEEKENDINGDATE,DIM_TRANSACTION.TRANSACTIONDATE,case when ltrim(rtrim(DIM_ASSIGNMENTRATE.PAYTYPE)) IS NOT NULL THEN DIM_ASSIGNMENTRATE.PAYTYPE end as DEFAULTPAYTYPE,DIM_ASSIGNMENT.DW_CREATED_DATE DIM_ASSIGNMENT_DW_CREATED_DATE,DIM_ASSIGNMENT.DW_MODIFIED_DATE DIM_ASSIGNMENT_DW_MODIFIED_DATE FROM ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_ASSIGNMENT DIM_ASSIGNMENT JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.temp1 temp1 ON DIM_ASSIGNMENT.ASSIGNMENTID = temp1.ASSIGNMENTID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_ASSIGNMENTRATE DIM_ASSIGNMENTRATE ON DIM_ASSIGNMENT.ASSIGNMENTID = DIM_ASSIGNMENTRATE.ASSIGNMENTID AND DIM_ASSIGNMENTRATE.STATECODE = 1 JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_BRANCH DIM_BRANCH ON DIM_ASSIGNMENT.BRANCHID = DIM_BRANCH.BRANCHID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_BRAND DIM_BRAND ON DIM_BRANCH.CRMBRANDID = DIM_BRAND.CRMBRANDID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_CUSTOMER DIM_CUSTOMER ON DIM_ASSIGNMENT.CUSTOMERID = DIM_CUSTOMER.CUSTOMERID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_CUSTOMER_HIERARCHY DIM_CUSTOMER_HIERARCHY ON DIM_CUSTOMER.CUSTOMERID = DIM_CUSTOMER_HIERARCHY.CUSTOMERID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_JOBORDER DIM_JOBORDER ON DIM_JOBORDER.JOBORDERID = DIM_ASSIGNMENT.JOBORDERID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_LOCATION DIM_LOCATION ON DIM_LOCATION.LOCATIONID = DIM_JOBORDER.WORKLOCATIONID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_INVOICE DIM_INVOICE ON DIM_CUSTOMER.CUSTOMERNUMBER = DIM_INVOICE.CUSTOMERID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_TRANSACTION DIM_TRANSACTION ON DIM_ASSIGNMENT.ASSIGNMENTID = DIM_TRANSACTION.ASSIGNMENTID AND DIM_INVOICE.INVOICENUMBER = DIM_TRANSACTION.INVOICENUMBER JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_FINANCE_HIERARCHY DIM_FINANCE_HIERARCHY ON DIM_TRANSACTION.ACCTUNITID = DIM_FINANCE_HIERARCHY.ACCTUNITID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_PAYBILLCODE DIM_PAYBILLCODE ON DIM_TRANSACTION.ACCTCATEGORY = COALESCE(CAST(DIM_PAYBILLCODE.BILLCODEID AS VARCHAR),CAST(DIM_PAYBILLCODE.PAYCODEID AS VARCHAR)) JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_EMPLOYEE DIM_EMPLOYEE ON DIM_ASSIGNMENT.EMPLOYEEID = DIM_EMPLOYEE.EMPLOYEEID) AS LDG ON LDG.ASSIGNMENTID = FCT.ASSIGNMENTID WHERE (DATE_TRUNC('DAY',LDG.DIM_ASSIGNMENT_DW_CREATED_DATE)>= (SELECT NVL(MAX(DATE_TRUNC('DAY',DW_CREATED_DATE)), '2020-06-01') FROM ${SNFLDWHDB}.${SNFLDWHSCH}.FACT_ASSIGNMENT_INVOICE) OR DATE_TRUNC('DAY',LDG.DIM_ASSIGNMENT_DW_MODIFIED_DATE)>= (SELECT NVL(MAX(DATE_TRUNC('DAY',DW_CREATED_DATE)), '2020-06-01')FROM ${SNFLDWHDB}.${SNFLDWHSCH}.FACT_ASSIGNMENT_INVOICE)))COMB ON MGE.ASSIGNMENTID = COMB.COMB_ID WHEN NOT MATCHED THEN INSERT(ASSIGNMENTID,INVOICEOBJID,INVOICENUMBER,BRANDID,CUSTOMERID,CUSTOMERNUMBER,EMPLOYEEID,EMPLOYEENUMBER,PONUMBER,ACCOUNTINGUNIT,BRANCHNUMBER,PROCESSLEVEL,SHIFTID,JOBTITLE,DEPARTMENTID,INVOICEDATE,BADGENUMBER,INVOICEPOSTINGDATE,APPROVERID,WORKSITELOCATIONID,WORKSITENAME,WORKSITEADDRESS1,WORKSITEADDRESS2,WORKSITECITY,WORKSITESTATE,WORKSITEZIP,BILLTOLOCATIONID,BILLTOLOCATIONNAME,BILLTOADDRESS1,BILLTOADDRESS2,BILLTOCITY,BILLTOSTATE,BILLTOZIP,CUSTFIELDVALUE1,CUSTFIELDVALUE2,CUSTFIELDVALUE3,CUSTFIELDVALUE4,CUSTFIELDVALUE5,CUSTFIELDVALUE6,CUSTFIELDVALUE7,CUSTFIELDVALUE8,CUSTFIELDVALUE9,WAGECODE,BILLRATE,BILLAMOUNT,BILLHOURS,SALESTAXAMOUNT,SALESTAXABLEAMOUNT,HOURSTYPEGROUP,POSITION,JOBCODE,CREDITTERMS,FINANCEAREA,FINANCEREGION,CRPMPARENTNUMBER,LAWSONPARENTNUMBER,INVOICECUSTOMERNAME,DUEDATE,CUSTOMERWEEKENDINGDATE,INVOICETRANSDATE,DEFAULTREGPAYRATE,DW_CREATED_DATE,DW_MODIFIED_DATE)VALUES (ASSIGNMENTID,INVOICEOBJID,INVOICENUMBER,BRANDID,CUSTOMERID,CUSTOMERNUMBER,EMPLOYEEID,EMPLOYEENUMBER,PONUMBER,ACCTUNITID,BRANCH_NUMBER,INVOICEPROCESSLEVEL,SHIFTID,JOBTITLE,DEPARTMENTID,INVOICEDATE,BADGENUMBER,INVOICEPOSTINGDATE,APPROVERID,WORKSITELOCATIONID,WORKSITENAME,WORKSITEADDRESS1,WORKSITEADDRESS2,WORKSITECITY,WORKSITESTATE,WORKSITEZIP,BILLTOLOCATIONID,BILLTOLOCATIONNAME,BILLTOADDRESS1,BILLTOADDRESS2,BILLTOCITY,BILLTOSTATE,BILLTOZIP,DEPT,JOB_TITLE,SUPERVISOR,AS_DEPT_USE,BADGE_NUMBER,DEPT_ORDERING,JOB_NUMBER,PO_NUMBER,SHIFT,WAGECODEID,BILLRATE,BILLABLEAMOUNT,BILLABLEUNIT,SALESTAXAMOUNT,TAXABLEAMOUNT,HOURGROUPTYPE,ASSIGNMENTTYPE,JOBCODEID,CREDITSTATUS,BUDGETAREANAME,REGIONNAME,CRMPARENTCUSTOMERID,LAWSONPARENTCUSTOMERID,INVOICEFORMNAME,DUEDATE,WEEKENDINGDATE,TRANSACTIONDATE,DEFAULTPAYTYPE,CURRENT_TIMESTAMP,CURRENT_TIMESTAMP) WHEN MATCHED AND MGE.ASSIGNMENTID = COMB.COMB_ID OR MGE.ASSIGNMENTID <> COMB.ASSIGNMENTID OR MGE.INVOICEOBJID <> COMB.INVOICEOBJID OR MGE.INVOICENUMBER <> COMB.INVOICENUMBER OR MGE.BRANDID <> COMB.BRANDID OR MGE.CUSTOMERID <> COMB.CUSTOMERID OR MGE.CUSTOMERNUMBER <> COMB.CUSTOMERNUMBER OR MGE.EMPLOYEEID <> COMB.EMPLOYEEID OR MGE.EMPLOYEENUMBER <> COMB.EMPLOYEENUMBER OR MGE.PONUMBER <> COMB.PONUMBER OR MGE.ACCOUNTINGUNIT <> COMB.ACCTUNITID OR MGE.BRANCHNUMBER <> COMB.BRANCH_NUMBER OR MGE.PROCESSLEVEL <> COMB.INVOICEPROCESSLEVEL OR MGE.SHIFTID <> COMB.SHIFTID OR MGE.JOBTITLE <> COMB.JOBTITLE OR MGE.DEPARTMENTID <> COMB.DEPARTMENTID OR MGE.INVOICEDATE <> COMB.INVOICEDATE OR MGE.BADGENUMBER <> COMB.BADGENUMBER OR MGE.INVOICEPOSTINGDATE <> COMB.INVOICEPOSTINGDATE OR MGE.APPROVERID <> COMB.APPROVERID OR MGE.WORKSITELOCATIONID <> COMB.WORKSITELOCATIONID OR MGE.WORKSITENAME <> COMB.WORKSITENAME OR MGE.WORKSITEADDRESS1 <> COMB.WORKSITEADDRESS1 OR MGE.WORKSITEADDRESS2 <> COMB.WORKSITEADDRESS2 OR MGE.WORKSITECITY <> COMB.WORKSITECITY OR MGE.WORKSITESTATE <> COMB.WORKSITESTATE OR MGE.WORKSITEZIP <> COMB.WORKSITEZIP OR MGE.BILLTOLOCATIONID <> COMB.BILLTOLOCATIONID OR MGE.BILLTOLOCATIONNAME <> COMB.BILLTOLOCATIONNAME OR MGE.BILLTOADDRESS1 <> COMB.BILLTOADDRESS1 OR MGE.BILLTOADDRESS2 <> COMB.BILLTOADDRESS2 OR MGE.BILLTOCITY <> COMB.BILLTOCITY OR MGE.BILLTOSTATE <> COMB.BILLTOSTATE OR MGE.BILLTOZIP <> COMB.BILLTOZIP OR MGE.WAGECODE <> COMB.WAGECODEID OR MGE.BILLRATE <> COMB.BILLRATE OR MGE.BILLAMOUNT <> COMB.BILLABLEAMOUNT OR MGE.BILLHOURS <> COMB.BILLABLEUNIT OR MGE.SALESTAXAMOUNT <> COMB.SALESTAXAMOUNT OR MGE.SALESTAXABLEAMOUNT <> COMB.TAXABLEAMOUNT OR MGE.HOURSTYPEGROUP <> COMB.HOURGROUPTYPE OR MGE.POSITION <> COMB.ASSIGNMENTTYPE OR MGE.JOBCODE <> COMB.JOBCODEID OR MGE.CREDITTERMS <> COMB.CREDITSTATUS OR MGE.FINANCEAREA <> COMB.BUDGETAREANAME OR MGE.FINANCEREGION <> COMB.REGIONNAME OR MGE.CRPMPARENTNUMBER <> COMB.CRMPARENTCUSTOMERID OR MGE.LAWSONPARENTNUMBER <> COMB.LAWSONPARENTCUSTOMERID OR MGE.INVOICECUSTOMERNAME <> COMB.INVOICEFORMNAME OR MGE.DUEDATE <> COMB.DUEDATE OR MGE.CUSTOMERWEEKENDINGDATE <> COMB.WEEKENDINGDATE OR MGE.INVOICETRANSDATE <> COMB.TRANSACTIONDATE OR MGE.DEFAULTREGPAYRATE <> COMB.DEFAULTPAYTYPE THEN UPDATE SET ASSIGNMENTID = COMB.ASSIGNMENTID,INVOICEOBJID = COMB.INVOICEOBJID,INVOICENUMBER = COMB.INVOICENUMBER,BRANDID = COMB.BRANDID,CUSTOMERID = COMB.CUSTOMERID,CUSTOMERNUMBER = COMB.CUSTOMERNUMBER,EMPLOYEEID = COMB.EMPLOYEEID,EMPLOYEENUMBER = COMB.EMPLOYEENUMBER,PONUMBER = COMB.PONUMBER,ACCOUNTINGUNIT = COMB.ACCTUNITID,BRANCHNUMBER = COMB.BRANCH_NUMBER,PROCESSLEVEL = COMB.INVOICEPROCESSLEVEL,SHIFTID = COMB.SHIFTID,JOBTITLE = COMB.JOBTITLE,DEPARTMENTID = COMB.DEPARTMENTID,INVOICEDATE = COMB.INVOICEDATE,BADGENUMBER = COMB.BADGENUMBER,INVOICEPOSTINGDATE = COMB.INVOICEPOSTINGDATE,APPROVERID = COMB.APPROVERID,WORKSITELOCATIONID = COMB.WORKSITELOCATIONID,WORKSITENAME = COMB.WORKSITENAME,WORKSITEADDRESS1 = COMB.WORKSITEADDRESS1,WORKSITEADDRESS2 = COMB.WORKSITEADDRESS2,WORKSITECITY = COMB.WORKSITECITY,WORKSITESTATE = COMB.WORKSITESTATE,WORKSITEZIP = COMB.WORKSITEZIP,BILLTOLOCATIONID = COMB.BILLTOLOCATIONID,BILLTOLOCATIONNAME = COMB.BILLTOLOCATIONNAME,BILLTOADDRESS1 = COMB.BILLTOADDRESS1,BILLTOADDRESS2 = COMB.BILLTOADDRESS2,BILLTOCITY = COMB.BILLTOCITY,BILLTOSTATE = COMB.BILLTOSTATE,BILLTOZIP = COMB.BILLTOZIP,WAGECODE = COMB.WAGECODEID,BILLRATE = COMB.BILLRATE,BILLAMOUNT = COMB.BILLABLEAMOUNT,BILLHOURS = COMB.BILLABLEUNIT,SALESTAXAMOUNT = COMB.SALESTAXAMOUNT,SALESTAXABLEAMOUNT = COMB.TAXABLEAMOUNT,HOURSTYPEGROUP = COMB.HOURGROUPTYPE,POSITION = COMB.ASSIGNMENTTYPE,JOBCODE = COMB.JOBCODEID,CREDITTERMS = COMB.CREDITSTATUS,FINANCEAREA = COMB.BUDGETAREANAME,FINANCEREGION = COMB.REGIONNAME,CRPMPARENTNUMBER = COMB.CRMPARENTCUSTOMERID,LAWSONPARENTNUMBER = COMB.LAWSONPARENTCUSTOMERID,INVOICECUSTOMERNAME = COMB.INVOICEFORMNAME,DUEDATE = COMB.DUEDATE,CUSTOMERWEEKENDINGDATE = COMB.WEEKENDINGDATE,INVOICETRANSDATE = COMB.TRANSACTIONDATE,DEFAULTREGPAYRATE = COMB.DEFAULTPAYTYPE;\")\n\n\ncursor.execute(\"INSERT INTO ${SNFLDWHDB}.${SNFLDWHSCH}.AUDIT_METRICS (JOB_NAME,USER_NAME,SOURCEDB_NAME,SOURCESCHEMA_NAME,DESTINATIONDB_NAME,DESTINATIONSCHEMA_NAME,ROWS_INSERTED, ROWS_UPDATED, START_DATE, END_DATE,JOB_STATUS) WITH CTE (Rows_Inserted,Rows_Updated) AS (SELECT * FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()))) select '%s' AS JOB_NAME ,CURRENT_USER() AS USER_NAME ,'${SNFLDWHDB}' AS SOURCEDB_NAME ,'${SNFLDWHSCH}' AS SOURCESCHEMA_NAME ,'${SNFLDWHDB}' AS DESTINATIONDB_NAME ,'${SNFLDWHSCH}' AS DESTINATIONSCHEMA_NAME ,CTE.Rows_Inserted AS ROWS_INSERTED ,CTE.Rows_Updated AS ROWS_UPDATED ,'%s' AS START_DATE ,CURRENT_TIMESTAMP() AS END_DATE ,'SUCCESS' AS JOB_STATUS FROM CTE\" % (job_name,Job_StartTimeStamp))\t\n\n\ncursor.execute(\"alter warehouse ${SNFLKWH_FACT} set warehouse_size='SMALL';\")\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6336676":{"id":6336676,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-240,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6336678],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"FACT_ASSIGNMENT_INVOICE_Failure"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"from datetime import datetime\nfrom pytz import timezone\n\njob_name = 'DW_FACT_ASSIGNMENT_INVOICE'\ncontext.updateVariable(\"Job_Name\",job_name)\n\nfmt = \"%Y-%m-%d %H:%M:%S\"\nCurrentTime = datetime.now(timezone(snowflake_timezone))\ncontext.updateVariable(\"Job_StartTimeStamp\",CurrentTime.strftime(fmt))\n\n\ncursor = context.cursor()\ncursor.execute(\"INSERT INTO ${SNFLDWHDB}.${SNFLDWHSCH}.AUDIT_METRICS(JOB_NAME,USER_NAME,SOURCEDB_NAME,SOURCESCHEMA_NAME,DESTINATIONDB_NAME,DESTINATIONSCHEMA_NAME,ROWS_INSERTED, ROWS_UPDATED, START_DATE, END_DATE,JOB_STATUS)  select '%s' AS JOB_NAME ,CURRENT_USER() AS USER_NAME ,'${SNFLKDB}' AS SOURCEDB_NAME ,'${SNFLKSCH}' AS SOURCESCHEMA_NAME ,'${SNFLDWHDB}' AS DESTINATIONDB_NAME ,'${SNFLDWHSCH}' AS DESTINATIONSCHEMA_NAME ,0 AS ROWS_INSERTED ,0 AS ROWS_UPDATED ,'%s' AS START_DATE ,CURRENT_TIMESTAMP() AS END_DATE ,'FAILURE' AS JOB_STATUS\" % (job_name,Job_StartTimeStamp))\t\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{"6336678":{"id":6336678,"sourceID":6336675,"targetID":6336676}},"unconditionalConnectors":{"6336677":{"id":6336677,"sourceID":6336674,"targetID":6336675}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"jb_DW_FACT_ASSIGNMENT_INVOICE","description":"","type":"ORCHESTRATION","tag":"c0f728e3-5e85-4bac-a60b-ca888556cbfb"}}