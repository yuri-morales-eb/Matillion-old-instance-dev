{"job":{"components":{"6336641":{"id":6336641,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-624,"y":-80,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[6336644],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6336642":{"id":6336642,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-432,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6336644],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[6336645],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Status","mapTo":"audit_status"},"2":{"slot":2,"fromId":null,"fromName":"Component","mapTo":"audit_component"},"3":{"slot":3,"fromId":null,"fromName":"Started At","mapTo":"audit_started"},"4":{"slot":4,"fromId":null,"fromName":"Duration","mapTo":"audit_duration"},"5":{"slot":5,"fromId":null,"fromName":"Completed At","mapTo":"audit_completed"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"FACT_ASSIGNMENT_SALES"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"from datetime import datetime\nfrom pytz import timezone\n\n\njob_name = 'DW_FACT_ASSIGNMENT_SALES'\ncontext.updateVariable(\"Job_Name\",job_name)\n\nfmt = \"%Y-%m-%d %H:%M:%S\"\nCurrentTime = datetime.now(timezone(snowflake_timezone))\ncontext.updateVariable(\"Job_StartTimeStamp\",CurrentTime.strftime(fmt))\n\ncursor = context.cursor()\ncursor.execute(\"use warehouse ${SNFLKWH_FACT};\")\ncursor.execute(\"alter warehouse ${SNFLKWH_FACT} resume if suspended;\")\ncursor.execute(\"alter warehouse ${SNFLKWH_FACT} set warehouse_size='X-LARGE';\")\ncursor.execute(\"TRUNCATE TABLE ${SNFLDWHDB}.${SNFLDWHSCH}.FACT_ASSIGNMENT_SALES;\")\ncursor.execute(\"MERGE INTO ${SNFLDWHDB}.${SNFLDWHSCH}.FACT_ASSIGNMENT_SALES MGE USING ( SELECT DISTINCT NVL(LDG.ASSIGNMENTID,FCT.ASSIGNMENTID) COMB_ID ,LDG.ASSIGNMENTID ,LDG.CUSTOMERID ,LDG.DEPARTMENTID ,LDG.EMPLOYEEID ,LDG.CRMBRANDID ,LDG.BRANCHID ,LDG.POSTINGDATE ,LDG.ACCTUNITID ,LDG.ACCTUNITNAME ,LDG.LOCATIONID ,LDG.CUSTOMERNUMBER ,LDG.NAME ,LDG.WORKSTATE ,LDG.FIRSTNAME ,LDG.LASTNAME ,LDG.NORMPOSTINGDATE ,LDG.TRANSACTIONDATE ,LDG.WAGECODEID ,LDG.WAGECODENAME ,LDG.BILLABLEUNIT ,LDG.BILLRATE ,LDG.BILLABLEAMOUNT ,LDG.PAYHOURS ,CASE WHEN LDG.PAYHOURS = 0 THEN 0 ELSE (LDG.PAYAMOUNT/LDG.PAYHOURS) END AS PAYRATE ,LDG.PAYAMOUNT ,LDG.FIRSTBILLDATE ,LDG.LASTBILLDATE ,LDG.FICAAMOUNT ,LDG.FUTAAMOUNT ,LDG.SUIAMOUNT ,LDG.WORKCOMPAMOUNT ,LDG.FRANCHISETAXAMOUNT ,LDG.ACAAMOUNT ,LDG.OTHERCOSTAMOUNT ,(LDG.REVENUEAMOUNT-LDG.COSTAMOUNT) AS GROSSPROFITAMOUNT ,LDG.BRANDLEVEL_NAME ,LDG.AcctUnitBrand ,LDG.REVENUEAMOUNT ,LDG.COSTAMOUNT ,LDG.PAYMENT_METHOD ,LDG.DIM_ASSIGNMENT_DW_CREATED_DATE ,LDG.DIM_ASSIGNMENT_DW_MODIFIED_DATE FROM ${SNFLDWHDB}.${SNFLDWHSCH}.FACT_ASSIGNMENT_SALES FCT FULL OUTER JOIN ( SELECT DISTINCT DIM_ASSIGNMENT.ASSIGNMENTID ,DIM_ASSIGNMENT.CUSTOMERID ,DIM_ASSIGNMENT.DEPARTMENTID ,DIM_ASSIGNMENT.EMPLOYEEID ,DIM_BRANCH.CRMBRANDID ,DIM_ASSIGNMENT.BRANCHID ,DIM_TRANSACTION.POSTINGDATE ,DIM_TRANSACTION.ACCTUNITID ,DIM_ACCT_UNIT.ACCTUNITNAME ,DIM_LOCATION.LOCATIONID ,DIM_CUSTOMER.CUSTOMERNUMBER ,DIM_CUSTOMER.NAME ,DIM_LABEL.LABELVALUE AS WORKSTATE ,DIM_EMPLOYEE.FIRSTNAME ,DIM_EMPLOYEE.LASTNAME ,DIM_TRANSACTION.NORMPOSTINGDATE ,DIM_TRANSACTION.TRANSACTIONDATE ,DIM_TRANSACTION.WAGECODEID ,DIM_TRANSACTION.WAGECODENAME ,DIM_TRANSACTION.BILLABLEUNIT AS BILLABLEUNIT ,DIV0(DIM_TRANSACTION.BILLABLEAMOUNT,DIM_TRANSACTION.BILLABLEUNIT) AS BILLRATE ,DIM_TRANSACTION.BILLABLEAMOUNT AS BILLABLEAMOUNT ,CASE WHEN DIM_GLACCOUNTTYPE.WAGES = TRUE THEN DIM_TRANSACTION.UNITSAMOUNT ELSE 0 END AS PAYHOURS ,CASE WHEN DIM_GLACCOUNTTYPE.WAGES = TRUE THEN DIM_TRANSACTION.TRANSACTIONAMOUNT ELSE 0 END AS PAYAMOUNT ,MIN(DIM_TRANSACTION.POSTINGDATE) as FIRSTBILLDATE ,MAX(DIM_TRANSACTION.POSTINGDATE) as LASTBILLDATE ,CASE WHEN DIM_GLACCOUNTTYPE.GLACCOUNTID = '5310' THEN DIM_TRANSACTION.TRANSACTIONAMOUNT ELSE 0 END AS FICAAMOUNT ,CASE WHEN DIM_GLACCOUNTTYPE.GLACCOUNTID = '5320' THEN DIM_TRANSACTION.TRANSACTIONAMOUNT ELSE 0 END AS FUTAAMOUNT ,CASE WHEN DIM_GLACCOUNTTYPE.GLACCOUNTID = '5330' THEN DIM_TRANSACTION.TRANSACTIONAMOUNT ELSE 0 END AS SUIAMOUNT ,CASE WHEN DIM_GLACCOUNTTYPE.GLACCOUNTID = '5400' THEN DIM_TRANSACTION.TRANSACTIONAMOUNT ELSE 0 END AS WORKCOMPAMOUNT ,CASE WHEN DIM_GLACCOUNTTYPE.GLACCOUNTID IN ('6811','6812') THEN DIM_TRANSACTION.TRANSACTIONAMOUNT ELSE 0 END AS FRANCHISETAXAMOUNT ,CASE WHEN DIM_GLACCOUNTTYPE.GLACCOUNTID = '5800' THEN DIM_TRANSACTION.TRANSACTIONAMOUNT ELSE 0 END AS ACAAMOUNT ,CASE WHEN DIM_GLACCOUNTTYPE.GLACCOUNTID NOT IN ('5310','5320','5330','5400','5900','6811','6812') THEN DIM_TRANSACTION.TRANSACTIONAMOUNT ELSE 0 END AS OTHERCOSTAMOUNT ,DIM_CUSTOMER.BRANDLEVEL_NAME ,DIM_BRANCH.CRMBRANDID AS AcctUnitBrand ,CASE WHEN DIM_GLACCOUNTTYPE.TOTALCOSTOFSALES = TRUE THEN DIM_TRANSACTION.TRANSACTIONAMOUNT ELSE 0 END AS REVENUEAMOUNT ,CASE WHEN DIM_GLACCOUNTTYPE.TOTALCOSTOFSALES = TRUE THEN DIM_TRANSACTION.TRANSACTIONAMOUNT ELSE 0 END AS COSTAMOUNT ,DIM_TIMECARD.PAYMENT_METHOD ,DIM_ASSIGNMENT.DW_CREATED_DATE AS DIM_ASSIGNMENT_DW_CREATED_DATE ,DIM_ASSIGNMENT.DW_MODIFIED_DATE AS DIM_ASSIGNMENT_DW_MODIFIED_DATE FROM ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_ASSIGNMENT DIM_ASSIGNMENT JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_TRANSACTION DIM_TRANSACTION ON DIM_ASSIGNMENT.ASSIGNMENTID = DIM_TRANSACTION.ASSIGNMENTID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_GLACCOUNTTYPE DIM_GLACCOUNTTYPE ON DIM_TRANSACTION.GLACCOUNTID = DIM_GLACCOUNTTYPE.GLACCOUNTID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_BRANCH DIM_BRANCH ON DIM_ASSIGNMENT.BRANCHID = DIM_BRANCH.BRANCHID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_ACCT_UNIT DIM_ACCT_UNIT ON DIM_TRANSACTION.ACCTUNITID = DIM_ACCT_UNIT.ACCTUNITID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_CUSTOMER DIM_CUSTOMER ON DIM_ASSIGNMENT.CUSTOMERID = DIM_CUSTOMER.CUSTOMERID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_EMPLOYEE DIM_EMPLOYEE ON DIM_ASSIGNMENT.EMPLOYEEID = DIM_EMPLOYEE.EMPLOYEEID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_TIMECARD DIM_TIMECARD ON DIM_ASSIGNMENT.ASSIGNMENTNUMBER = DIM_TIMECARD.TIMECARDID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_LABEL DIM_LABEL ON DIM_BRANCH.STATUSCODE_DW_LABELID = DIM_LABEL.DW_LABELID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_JOBORDER DIM_JOBORDER ON DIM_JOBORDER.JOBORDERID = DIM_ASSIGNMENT.JOBORDERID JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_LOCATION DIM_LOCATION ON DIM_LOCATION.LOCATIONID = DIM_JOBORDER.WORKLOCATIONID LEFT OUTER JOIN ${SNFLDWHDB}.${SNFLDWHSCH}.DIM_PAYBILLCODE DIM_PAYBILLCODE ON DIM_TRANSACTION.ACCTCATEGORY = IFNULL(DIM_PAYBILLCODE.BILLCODEID,DIM_PAYBILLCODE.PAYCODEID) and UPPER(UNITTYPE) = 'HOUR' GROUP BY DIM_ASSIGNMENT.ASSIGNMENTID ,DIM_ASSIGNMENT.CUSTOMERID ,DIM_ASSIGNMENT.DEPARTMENTID ,DIM_ASSIGNMENT.EMPLOYEEID ,DIM_BRANCH.CRMBRANDID ,DIM_ASSIGNMENT.BRANCHID ,DIM_TRANSACTION.POSTINGDATE ,DIM_TRANSACTION.ACCTUNITID ,DIM_ACCT_UNIT.ACCTUNITNAME ,DIM_LOCATION.LOCATIONID ,DIM_CUSTOMER.CUSTOMERNUMBER ,DIM_CUSTOMER.NAME ,DIM_TRANSACTION.NORMPOSTINGDATE ,DIM_TRANSACTION.TRANSACTIONDATE ,DIM_TRANSACTION.WAGECODEID ,DIM_TRANSACTION.WAGECODENAME ,DIM_TRANSACTION.BILLABLEUNIT ,DIM_TRANSACTION.BILLABLEAMOUNT ,DIM_GLACCOUNTTYPE.WAGES ,DIM_GLACCOUNTTYPE.GLACCOUNTID ,DIM_TRANSACTION.UNITSAMOUNT ,DIM_TRANSACTION.TRANSACTIONAMOUNT ,DIM_CUSTOMER.BRANDLEVEL_NAME ,DIM_EMPLOYEE.FIRSTNAME ,DIM_EMPLOYEE.LASTNAME ,DIM_GLACCOUNTTYPE.TOTALCOSTOFSALES ,DIM_TIMECARD.PAYMENT_METHOD ,DIM_LABEL.LABELVALUE ,DIM_ASSIGNMENT.DW_CREATED_DATE ,DIM_ASSIGNMENT.DW_MODIFIED_DATE )AS LDG ON LDG.ASSIGNMENTID = FCT.ASSIGNMENTID AND (DATE_TRUNC('DAY',LDG.DIM_ASSIGNMENT_DW_CREATED_DATE)>= (SELECT NVL(MAX(DATE_TRUNC('DAY',DW_CREATED_DATE)),'2000-01-01') FROM ${SNFLDWHDB}.${SNFLDWHSCH}.FACT_ASSIGNMENT_SALES) OR DATE_TRUNC('DAY',LDG.DIM_ASSIGNMENT_DW_MODIFIED_DATE)>= (SELECT NVL(MAX(DATE_TRUNC('DAY',DW_CREATED_DATE)),'2000-01-01') FROM ${SNFLDWHDB}.${SNFLDWHSCH}.FACT_ASSIGNMENT_SALES )) ) COMB ON MGE.ASSIGNMENTID = COMB.COMB_ID WHEN NOT MATCHED THEN INSERT(ASSIGNMENTID,CUSTOMERID,DEPARTMENTID,EMPLOYEEID,BRANDID,BRANCHID,POSTINGDATE,ACCTUNITID,ACCTUNITNAME,LOCATIONID, CUSTOMERNUMBER,CUSTOMERNAME,WORKSTATE,EMPLOYEEFIRSTNAME,EMPLOYEELASTNAME,NORMPOSTINGDATE,TRANSACTIONDATE,WAGECODEID,WAGECODENAME,BILLHOURS,BILLRATE,BILLAMOUNT, PAYHOURS,PAYRATE,PAYAMOUNT,FIRSTBILLDATE,LASTBILLDATE,FICAAMOUNT,FUTAAMOUNT,SUIAMOUNT,WORKCOMPAMOUNT,FRANCHISETAXAMOUNT, ACAAMOUNT,OTHERCOSTAMOUNT,GROSSPROFITAMOUNT,CLIENTBRAND,ACCTUNITBRAND,REVENUEAMOUNT,COSTAMOUNT,TIMECARDNOTE,DW_CREATED_DATE,DW_MODIFIED_DATE) VALUES (ASSIGNMENTID,CUSTOMERID,DEPARTMENTID,EMPLOYEEID,CRMBRANDID,BRANCHID,POSTINGDATE,ACCTUNITID,ACCTUNITNAME,LOCATIONID, CUSTOMERNUMBER,NAME,WORKSTATE,FIRSTNAME,LASTNAME,NORMPOSTINGDATE,TRANSACTIONDATE,WAGECODEID,WAGECODENAME,BILLABLEUNIT,BILLRATE,BILLABLEAMOUNT, PAYHOURS,PAYRATE,PAYAMOUNT,FIRSTBILLDATE,LASTBILLDATE,FICAAMOUNT,FUTAAMOUNT,SUIAMOUNT,WORKCOMPAMOUNT,FRANCHISETAXAMOUNT, ACAAMOUNT,OTHERCOSTAMOUNT,GROSSPROFITAMOUNT,BRANDLEVEL_NAME,AcctUnitBrand,REVENUEAMOUNT,COSTAMOUNT,PAYMENT_METHOD,current_timestamp,current_timestamp) WHEN MATCHED AND MGE.ASSIGNMENTID = COMB.COMB_ID OR MGE.ASSIGNMENTID <> COMB.ASSIGNMENTID OR MGE.CUSTOMERID <> COMB.CUSTOMERID OR MGE.DEPARTMENTID <> COMB.DEPARTMENTID OR MGE.EMPLOYEEID <> COMB.EMPLOYEEID OR MGE.BRANDID <> COMB.CRMBRANDID OR MGE.BRANCHID <> COMB.BRANCHID OR MGE.POSTINGDATE <> COMB.POSTINGDATE OR MGE.ACCTUNITID <> COMB.ACCTUNITID OR MGE.ACCTUNITNAME <> COMB.ACCTUNITNAME OR MGE.LOCATIONID <> COMB.LOCATIONID OR MGE.CUSTOMERNUMBER <> COMB.CUSTOMERNUMBER OR MGE.CUSTOMERNAME <> COMB.NAME OR MGE.WORKSTATE <> COMB.WORKSTATE OR MGE.EMPLOYEEFIRSTNAME <> COMB.FIRSTNAME OR MGE.EMPLOYEELASTNAME <> COMB.LASTNAME OR MGE.NORMPOSTINGDATE <> COMB.NORMPOSTINGDATE OR MGE.TRANSACTIONDATE <> COMB.TRANSACTIONDATE OR MGE.WAGECODEID <> COMB.WAGECODEID OR MGE.WAGECODENAME <> COMB.WAGECODENAME OR MGE.BILLHOURS <> COMB.BILLABLEUNIT OR MGE.BILLRATE <> COMB.BILLRATE OR MGE.BILLAMOUNT <> COMB.BILLABLEAMOUNT OR MGE.PAYHOURS <> COMB.PAYHOURS OR MGE.PAYRATE <> COMB.PAYRATE OR MGE.PAYAMOUNT <> COMB.PAYAMOUNT OR MGE.FIRSTBILLDATE <> COMB.FIRSTBILLDATE OR MGE.LASTBILLDATE <> COMB.LASTBILLDATE OR MGE.FICAAMOUNT <> COMB.FICAAMOUNT OR MGE.FUTAAMOUNT <> COMB.FUTAAMOUNT OR MGE.SUIAMOUNT <> COMB.SUIAMOUNT OR MGE.WORKCOMPAMOUNT <> COMB.WORKCOMPAMOUNT OR MGE.FRANCHISETAXAMOUNT <> COMB.FRANCHISETAXAMOUNT OR MGE.ACAAMOUNT <> COMB.ACAAMOUNT OR MGE.OTHERCOSTAMOUNT <> COMB.OTHERCOSTAMOUNT OR MGE.GROSSPROFITAMOUNT <> COMB.GROSSPROFITAMOUNT OR MGE.CLIENTBRAND <> COMB.BRANDLEVEL_NAME OR MGE.ACCTUNITBRAND <> COMB.AcctUnitBrand OR MGE.REVENUEAMOUNT <> COMB.REVENUEAMOUNT OR MGE.COSTAMOUNT <> COMB.COSTAMOUNT OR MGE.TIMECARDNOTE <> COMB.PAYMENT_METHOD THEN UPDATE SET ASSIGNMENTID = COMB.ASSIGNMENTID ,CUSTOMERID = COMB.CUSTOMERID ,DEPARTMENTID = COMB.DEPARTMENTID ,EMPLOYEEID = COMB.EMPLOYEEID ,BRANDID = COMB.CRMBRANDID ,BRANCHID = COMB.BRANCHID ,ACCTUNITID = COMB.ACCTUNITID ,LOCATIONID = COMB.LOCATIONID ,POSTINGDATE = COMB.POSTINGDATE ,ACCTUNITNAME = COMB.ACCTUNITNAME ,CUSTOMERNUMBER = COMB.CUSTOMERNUMBER ,CUSTOMERNAME = COMB.NAME ,WORKSTATE = COMB.WORKSTATE ,EMPLOYEEFIRSTNAME = COMB.FIRSTNAME ,EMPLOYEELASTNAME = COMB.LASTNAME ,NORMPOSTINGDATE = COMB.NORMPOSTINGDATE ,TRANSACTIONDATE = COMB.TRANSACTIONDATE ,WAGECODEID = COMB.WAGECODEID ,WAGECODENAME = COMB.WAGECODENAME ,BILLHOURS = COMB.BILLABLEUNIT ,BILLRATE = COMB.BILLRATE ,BILLAMOUNT = COMB.BILLABLEAMOUNT ,PAYHOURS = COMB.PAYHOURS ,PAYRATE = COMB.PAYRATE ,PAYAMOUNT = COMB.PAYAMOUNT ,FIRSTBILLDATE = COMB.FIRSTBILLDATE ,LASTBILLDATE = COMB.LASTBILLDATE ,FICAAMOUNT = COMB.FICAAMOUNT ,FUTAAMOUNT = COMB.FUTAAMOUNT ,SUIAMOUNT = COMB.SUIAMOUNT ,WORKCOMPAMOUNT = COMB.WORKCOMPAMOUNT ,FRANCHISETAXAMOUNT = COMB.FRANCHISETAXAMOUNT ,ACAAMOUNT = COMB.ACAAMOUNT ,OTHERCOSTAMOUNT = COMB.OTHERCOSTAMOUNT ,GROSSPROFITAMOUNT = COMB.GROSSPROFITAMOUNT ,CLIENTBRAND = COMB.BRANDLEVEL_NAME ,ACCTUNITBRAND = COMB.AcctUnitBrand ,REVENUEAMOUNT = COMB.REVENUEAMOUNT ,COSTAMOUNT = COMB.COSTAMOUNT ,TIMECARDNOTE = COMB.PAYMENT_METHOD;\")\ncursor.execute(\"INSERT INTO ${SNFLDWHDB}.${SNFLDWHSCH}.AUDIT_METRICS (JOB_NAME,USER_NAME,SOURCEDB_NAME,SOURCESCHEMA_NAME,DESTINATIONDB_NAME,DESTINATIONSCHEMA_NAME,ROWS_INSERTED, ROWS_UPDATED, START_DATE, END_DATE,JOB_STATUS) WITH CTE (Rows_Inserted,Rows_Updated) AS (SELECT * FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()))) select '%s' AS JOB_NAME ,CURRENT_USER() AS USER_NAME ,'${SNFLDWHDB}' AS SOURCEDB_NAME ,'${SNFLDWHSCH}' AS SOURCESCHEMA_NAME ,'${SNFLDWHDB}' AS DESTINATIONDB_NAME ,'${SNFLDWHSCH}' AS DESTINATIONSCHEMA_NAME ,CTE.Rows_Inserted AS ROWS_INSERTED ,CTE.Rows_Updated AS ROWS_UPDATED ,'%s' AS START_DATE ,CURRENT_TIMESTAMP() AS END_DATE ,'SUCCESS' AS JOB_STATUS FROM CTE\" % (job_name,Job_StartTimeStamp))\t\ncursor.execute(\"alter warehouse ${SNFLKWH_FACT} set warehouse_size='SMALL';\")"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"6336643":{"id":6336643,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-240,"y":-80,"width":32,"height":32,"inputConnectorIDs":[6336645],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"FACT_ASSIGNMENT_SALES_Failure"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"from datetime import datetime\nfrom pytz import timezone\n\njob_name = 'DW_FACT_ASSIGNMENT_SALES'\ncontext.updateVariable(\"Job_Name\",job_name)\n\nfmt = \"%Y-%m-%d %H:%M:%S\"\nCurrentTime = datetime.now(timezone(snowflake_timezone))\ncontext.updateVariable(\"Job_StartTimeStamp\",CurrentTime.strftime(fmt))\n\n\ncursor = context.cursor()\ncursor.execute(\"INSERT INTO ${SNFLDWHDB}.${SNFLDWHSCH}.AUDIT_METRICS(JOB_NAME,USER_NAME,SOURCEDB_NAME,SOURCESCHEMA_NAME,DESTINATIONDB_NAME,DESTINATIONSCHEMA_NAME,ROWS_INSERTED, ROWS_UPDATED, START_DATE, END_DATE,JOB_STATUS)  select '%s' AS JOB_NAME ,CURRENT_USER() AS USER_NAME ,'${SNFLDWHDB}' AS SOURCEDB_NAME ,'${SNFLDWHSCH}' AS SOURCESCHEMA_NAME ,'${SNFLDWHDB}' AS DESTINATIONDB_NAME ,'${SNFLDWHSCH}' AS DESTINATIONSCHEMA_NAME ,0 AS ROWS_INSERTED ,0 AS ROWS_UPDATED ,'%s' AS START_DATE ,CURRENT_TIMESTAMP() AS END_DATE ,'FAILURE' AS JOB_STATUS\" % (job_name,Job_StartTimeStamp))\t\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{"6336645":{"id":6336645,"sourceID":6336642,"targetID":6336643}},"unconditionalConnectors":{"6336644":{"id":6336644,"sourceID":6336641,"targetID":6336642}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{},"grids":{}},"info":{"name":"jb_DW_FACT_ASSIGNMENT_SALES","description":"","type":"ORCHESTRATION","tag":"5aeb086b-b6f3-44d2-98a0-2510020a29a1"}}