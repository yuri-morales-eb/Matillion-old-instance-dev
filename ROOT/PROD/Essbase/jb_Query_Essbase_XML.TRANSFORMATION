{"job":{"components":{"6339366":{"id":6339366,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":400,"y":320,"width":32,"height":32,"inputConnectorIDs":[6339370],"outputConnectorIDs":[6339369],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Add Job Variables"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"'${run_history_id}'"},"2":{"slot":2,"type":"STRING","value":"run_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_TIMESTAMP()"},"2":{"slot":2,"type":"STRING","value":"run_timestamp"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"current_user()"},"2":{"slot":2,"type":"STRING","value":"run_user"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6339367":{"id":6339367,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":560,"y":320,"width":32,"height":32,"inputConnectorIDs":[6339369],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"REPORTING HIERARCHY"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"REPORTING_HIERARCHY"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ID"},"2":{"slot":2,"type":"STRING","value":"ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"PARENT_ID"},"2":{"slot":2,"type":"STRING","value":"PARENT_ID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"MEMBER_NAME"},"2":{"slot":2,"type":"STRING","value":"MEMBER_NAME"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"MEMBER_ALIAS"},"2":{"slot":2,"type":"STRING","value":"MEMBER_ALIAS"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"MEMBER_CATEGORY"},"2":{"slot":2,"type":"STRING","value":"MEMBER_CATEGORY"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"SHARED_MEMBER"},"2":{"slot":2,"type":"STRING","value":"SHARED_MEMBER"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"run_timestamp"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_DATE"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"run_user"},"2":{"slot":2,"type":"STRING","value":"DL_CREATED_BY"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"run_id"},"2":{"slot":2,"type":"STRING","value":"DL_JOBID"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"XML_INFO"},"2":{"slot":2,"type":"STRING","value":"XML_INFO"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"SHORT_PATH"},"2":{"slot":2,"type":"STRING","value":"SHORT_PATH"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"PARENT_PATH"},"2":{"slot":2,"type":"STRING","value":"PARENT_PATH"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${Sch_Essbase}"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB_Datalake}"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"204":{"slot":204,"name":"Order By","elements":{},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6339368":{"id":6339368,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":244,"y":320,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[6339370],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"LDG_REPORTING_HIERARCHY"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"WITH cte_all_members AS (\n        SELECT get(f.value, '@name')::varchar AS member_name\n            , replace(xmlget(parse_xml(f.value), 'Alias'):\"$\"::varchar, '\"', '')::varchar AS member_alias\n            , replace(xmlget(parse_xml(f.value), 'AttributeMember'):\"@name\"::varchar, '\"', '')::varchar as member_category\n            , get(f.value, '@SharedMember')::varchar as shared_member\n            , f.path\n            , regexp_instr(f.path, '[\\[][^\\[]*$') as pos\n            , translate(substr(path, pos), '[]', '') as rank\n            , f.value AS member_info\n        FROM ${DB_Datalake}.${Sch_Essbase}.ldg_reporting_hierarchy\n            , TABLE (flatten(input => get(xmldata, '$'), recursive => true)) f\n        WHERE get(f.value, '@') = 'Member'\n        ),\n    cte_reporting_members AS (\n        SELECT row_number() OVER (ORDER BY a.pos, a.rank) AS id, a.*\n        FROM cte_all_members a\n        JOIN cte_all_members b on b.member_name = 'Reporting'\n            and b.path = left(a.path, len(b.path))\n        )\nSELECT child.id\n    , parent.id AS parent_id\n    , child.member_name\n    , child.member_alias\n    , child.member_category\n    , coalesce(child.shared_member, 'N') as shared_member\n    , child.path as short_path\n    , parent.path as parent_path\n    , child.rank\n    , child.member_info as xml_info\nFROM cte_reporting_members child\nLEFT JOIN cte_reporting_members parent ON parent.path = left(child.path, len(parent.path))\nqualify row_number() over (partition by child.id order by len(parent.path) desc) = 2"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"6339369":{"id":6339369,"sourceID":6339366,"targetID":6339367},"6339370":{"id":6339370,"sourceID":6339368,"targetID":6339366}},"notes":{},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"jb_Query_Essbase_XML","description":"","type":"TRANSFORMATION","tag":"450774c9-ef4d-4108-8728-9ff8a8d5b147"}}