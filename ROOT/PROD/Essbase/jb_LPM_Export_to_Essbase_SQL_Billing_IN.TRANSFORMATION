{"job":{"components":{"6339511":{"id":6339511,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":14,"y":325,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[6339513],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Billing IN Query"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"WITH CTE_BILLING_IN AS (\n    select\n        DATEADD(DAY, -DATE_PART(DAYOFWEEK, v.created_at), v.created_at)::date AS CREATED_AT_SUNDAY\n        , v.customer_id as CUSTOMER\n        , round(sum(v.pay_amount),2) as GROSS_PROFIT\n    from  ${DB_Enterprise}.${SNFLFINSCH}.vw_lpm_export v\n    where v.pay_code like '51%'\n        OR v.pay_code like '59%'\n        OR v.pay_code like '99%'\n    group by 1,2\n    order by CREATED_AT_SUNDAY\n),\nCTE_BILLING_IN_51 AS (\n    select\n        DATEADD(DAY, -DATE_PART(DAYOFWEEK, v.created_at), v.created_at)::date AS CREATED_AT_SUNDAY\n        , v.customer_id as CUSTOMER\n        , round(sum(v.pay_amount),2) as GROSS_PROFIT\n    from  ${DB_Enterprise}.${SNFLFINSCH}.vw_lpm_export v\n    where v.pay_code like '51%'\n    group by 1,2\n    order by CREATED_AT_SUNDAY\n),\nCTE_BILLING_IN_59 AS (\n    select\n        DATEADD(DAY, -DATE_PART(DAYOFWEEK, v.created_at), v.created_at)::date AS CREATED_AT_SUNDAY\n        , v.customer_id as CUSTOMER\n        , round(sum(v.pay_amount),2) as GROSS_PROFIT\n    from  ${DB_Enterprise}.${SNFLFINSCH}.vw_lpm_export v\n    where v.pay_code like '59%'\n    group by 1,2\n    order by CREATED_AT_SUNDAY\n),\nCTE_BILLING_IN_99 AS (\n    select\n        DATEADD(DAY, -DATE_PART(DAYOFWEEK, v.created_at), v.created_at)::date AS CREATED_AT_SUNDAY\n        , v.customer_id as CUSTOMER\n        , round(sum(v.pay_amount),2) as GROSS_PROFIT\n    from  ${DB_Enterprise}.${SNFLFINSCH}.vw_lpm_export v\n    where v.pay_code like '99%'\n    group by 1,2\n    order by CREATED_AT_SUNDAY\n)\n\nSELECT\n\tB.CREATED_AT_SUNDAY,\n\tB.CUSTOMER,\n\tB.GROSS_PROFIT,\n\tCOALESCE(B51.GROSS_PROFIT, 0) AS GROSS_PROFIT_51,\n\tCOALESCE(B59.GROSS_PROFIT, 0) AS GROSS_PROFIT_59,\n\tCOALESCE(B99.GROSS_PROFIT, 0) AS GROSS_PROFIT_99\nFROM CTE_BILLING_IN AS B\nLEFT JOIN CTE_BILLING_IN_51 AS B51 ON B.CUSTOMER = B51.CUSTOMER AND B.CREATED_AT_SUNDAY = B51.CREATED_AT_SUNDAY\nLEFT JOIN CTE_BILLING_IN_59 AS B59 ON B.CUSTOMER = B59.CUSTOMER AND B.CREATED_AT_SUNDAY = B59.CREATED_AT_SUNDAY\nLEFT JOIN CTE_BILLING_IN_99 AS B99 ON B.CUSTOMER = B99.CUSTOMER AND B.CREATED_AT_SUNDAY = B99.CREATED_AT_SUNDAY"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6339512":{"id":6339512,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":416,"y":320,"width":32,"height":32,"inputConnectorIDs":[6339513],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BILLING_IN"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BILLING_IN"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATED_AT_SUNDAY"},"2":{"slot":2,"type":"STRING","value":"CREATED_AT_SUNDAY"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"CUSTOMER"},"2":{"slot":2,"type":"STRING","value":"CUSTOMER"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"GROSS_PROFIT"},"2":{"slot":2,"type":"STRING","value":"GROSS_PROFIT"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"GROSS_PROFIT_51"},"2":{"slot":2,"type":"STRING","value":"GROSS_PROFIT_51"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"GROSS_PROFIT_59"},"2":{"slot":2,"type":"STRING","value":"GROSS_PROFIT_59"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"GROSS_PROFIT_99"},"2":{"slot":2,"type":"STRING","value":"GROSS_PROFIT_99"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${SNFLFINSCH}"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${DB_Enterprise}"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"204":{"slot":204,"name":"Order By","elements":{},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"6339513":{"id":6339513,"sourceID":6339511,"targetID":6339512}},"notes":{},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"jb_LPM_Export_to_Essbase_SQL_Billing_IN","description":"","type":"TRANSFORMATION","tag":"9f4a8fb8-6b41-425a-841e-2c2f2ab259b5"}}